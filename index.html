<!DOCTYPE html>
<html>
  <head>
	<title>Penelope warpweighted loom 2.0</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="css/style.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="css/flickity.css">
  </head>
  <body>
	<div class="container">
	  <div class="top-row">		
		<div class="controls">

		  <div class="warp-container">
			<div class="dropdown">
			  <span>?</span>
			  <div class="dropdown-content">
				Here you can choose warp (vertical) thread colours
				and add and remove threads to change the warp colour
				sequence.
			  </div>
			</div>
			<div id="warp-colours"></div>
			<div class="col">
			  <button class="yarn-button" onclick="add_colour('warp');">+</button>
			  <button class="yarn-button" onclick="remove_colour('warp');">-</button>
			</div>
		  </div>

		  <div class="draft-container">
			<div class="dropdown">
			  <span>?</span>
			  <div class="dropdown-content">
				This pattern (known as the draft pattern) describes
				the structure of the weave. Black indicates warp
				(vertical) threads will go over weft (horizontal)
				threads, white is the inverse.
			  </div>
			</div>
			<div id="draft"></div>
			<div class="controls">
			  <input type="number" id="warp-threads" value='4' onchange="update_draft();" style="width:3em;"/> x
			  <input type="number" id="weft-threads" value='4' onchange="update_draft();" style="width:3em;"/>
			</div>
		  </div>

		  <div class="weft-container">
			<div class="dropdown">
			  <span>?</span>
			  <div class="dropdown-content">
				Here you can choose weft (horizontal) thread colours
				and add and remove threads to change the weft colour
				sequence.
			  </div>
			</div>
			<div id="weft-colours"></div>
			<div class="row">
			  <button class="yarn-button" onclick="add_colour('weft');">+</button>
			  <button class="yarn-button" onclick="remove_colour('weft');">-</button>
			</div>
		  </div>

		  <h1>=</h1>

		</div> <!-- controls -->


		<!--
			<button id="invert" onclick="invert_draft();">Invert</button>
			<button id="clear" onclick="clear_draft();">Clear</button>
			-->

		<div class="sim-container">
		  <canvas class="canvas" id="webgl-canvas" width="509" height="400"></canvas>
		</div>
		
	  </div> <!-- row -->


	  <button type="button" class="collapsible" style="display:none">+ fine tune</button>
	  <div class="collapsible-content" style="display:none">
		<table>	  
		  <tr><td>Thread width</td><td><input type="number" id="thread-width" value='0.8' onchange="update_look();" style="width:5em;"/></td></tr>
		  <tr><td>Weave depth</td><td><input type="number" id="weave-depth" value='0.2' onchange="update_look();" style="width:5em;"/></td></tr>
		  <tr><td>Fabric warp size</td><td><input type="number" id="fabric-warp-size" value='20' onchange="update();" style="width:5em;"/></td></tr>
		  <tr><td>Fabric weft size</td><td><input type="number" id="fabric-weft-size" value='12' onchange="update();" style="width:5em;"/></td></tr>
		  <tr><td>Texture</td><td><input type="checkbox" checked id="render-texture" onchange="update_look();" style="width:5em;"/></td></tr>
		  <tr><td>Flat</td><td><input type="checkbox" checked id="render-flat" onchange="update_look();" style="width:5em;"/></td></tr>
		  <tr><td>Contrast</td><td><input type="number" id="render-contrast" value="0.5" onchange="update_look();" style="width:5em;"/></td></tr>
		</table>
		
		<table>
		  <tr><td>Loom speed</td><td><input type="number" id="loom-speed" value='0.001' onchange="update_speed();" style="width:5em;"/></td></tr>
		  <tr><td>X rotation</td><td><input type="number" id="camera-rot-x" value='0' onchange="update_view();" style="width:5em;"/></td></tr>
		  <tr><td>Y rotation</td><td><input type="number" id="camera-rot-y" value='-20' onchange="update_view();" style="width:5em;"/></td></tr>
		  <tr><td>Distance</td><td><input type="number" id="camera-distance" value='49' onchange="update_view();" style="width:5em;"/></td></tr>
		</table>
	  </div>
  
	  	  
	  <div class="carousel" data-flickity='{ "cellAlign": "left", "contain": true, "wrapAround": true }' >		

		<div class="carousel-cell">
		  <div class="carousel-contents">

			<div class="carousel-left">
			  <h2>PENELOPE warp weighted loom simulation</h2>
			  <p>
				Warp weighted looms were used by the ancient Greeks.
				This explorable explanation demonstrates how weavers
				in ancient times calculated complex algorithmic
				pattern manipulation which shows that digital
				thinking has a long history.
			  </p>
			  <p>
				This is a small collection of weaving patterns for you
				to explore - can you figure them all out? 
			  </p>
			</div>
			<div class="carousel-right">
			  <img src="images/example.jpg">
			</div>

		  </div>
		</div>


		<div class="carousel-cell">
		  <div class="carousel-contents">
			<div class="carousel-left">
			  <h2>Plain weave</h2>
			  <p>
				The default checkerboard pattern being woven above is
				plain weave (also known as tabby) and is the simplest,
				and strongest weave.
			  </p>
			  <p>
				Can you click on the light brown squares to change the
				warp and weft colours to create these horizontal
				stripes? Click on the ? button if you want to see the
				answer.
			  </p>
			</div>
			<div class="carousel-right">
			  <button type="button" class="collapsible">?</button>
			  <div class="collapsible-content" style="display:none;">
				<img src="images/tabby-ans.png">
			  </div>
			  <div class="uncollapsible-content"  style="display:flex;">
				<img src="images/tabby-pat.png">
			  </div>			  
			</div>	
		  </div>
		</div>

		<div class="carousel-cell">
		  <div class="carousel-contents">
			<div class="carousel-left">
			  <h2>Plain weave 2</h2>
			  <p>
				This is a example of how an interference between
				colour and structure create visual patterns in
				weaving. Can you work out how to change the colour
				order to make the stripes go in the other direction
				like this?
			  </p>
			</div>
			<div class="carousel-right">
			  <button type="button" class="collapsible">?</button>
			  <div class="collapsible-content" style="display:none;">
				<img src="images/tabby2-ans.png">
			  </div>
			  <div class="uncollapsible-content"  style="display:flex;">
				<img src="images/tabby2-pat.png" class="pat-image">
			  </div>			  
			</div>	
			
		  </div>
		</div>

		<div class="carousel-cell">
		  <div class="carousel-contents">
			<div class="carousel-left">
			  <h2>Gingham</h2>
			  <p>
				Gingham is a type of plaid pattern made with plain
				weave which is used all around the world in different
				cultures. 
			  </p>
			  <p>
				Can you decypher this mystery and replicate it for
				yourself?
			  </p>
			</div>

			<div class="carousel-right">
			  <button type="button" class="collapsible">?</button>
			  <div class="collapsible-content" style="display:none;">
				<img src="images/gingham-ans.png">
			  </div>
			  <div class="uncollapsible-content"  style="display:flex;">
				<img src="images/gingham-pat.png">
			  </div>			  
			</div>	

		  </div>
		</div>


		<div class="carousel-cell">
		  <div class="carousel-contents">
			<div class="carousel-left">
			  <h2>Basket weave</h2>
			  <p>
				Lets try changing the weave 'draft pattern' in the
				middle. The pattern on the right shows a development
				of plan weave known as basket weave.
			  </p>
			  <p>
				Can you work out how it's made?
			  </p>
			</div>

			<div class="carousel-right">
			  <button type="button" class="collapsible">?</button>
			  <div class="collapsible-content" style="display:none;">
				<img src="images/basket-ans.png">
			  </div>
			  <div class="uncollapsible-content"  style="display:flex;">
				<img src="images/basket-pat.png">
			  </div>			  
			</div>	

		  </div>
		</div>

		<div class="carousel-cell">
		  <div class="carousel-contents">
			<div class="carousel-left">
			  <h2>Basket weave 2</h2>
			  <p>
				Interestingly, basket weave often creates diagonal
				patterns when you alternate the colour threads, can
				you replicate the one on the right?
			  </p>
			</div>

			<div class="carousel-right">
			  <button type="button" class="collapsible">?</button>
			  <div class="collapsible-content" style="display:none;">
				<img src="images/basket2-ans.png">
			  </div>
			  <div class="uncollapsible-content"  style="display:flex;">
				<img src="images/basket2-pat.png">
			  </div>			  
			</div>	

		  </div>
		</div>
		
		<div class="carousel-cell">
		  <div class="carousel-contents">
			<div class="carousel-left">
			  <h2>Houndstooth</h2>
			  <p>
				This famous pattern is called Houndstooth (also
				dogstooth, dogtooth, dog's tooth, or pied-de-poule) and
				is often used in fashion. 
			  </p>
			</div>

			<div class="carousel-right">
			  <button type="button" class="collapsible">?</button>
			  <div class="collapsible-content" style="display:none;">
				<img src="images/houndstooth-ans.png">
			  </div>
			  <div class="uncollapsible-content"  style="display:flex;">
				<img src="images/houndstooth-pat.png">
			  </div>			  
			</div>	
		  </div>
		</div>

		


	  </div> <!-- carousel -->

	  <div class="code-container" style="display: none;">
		<textarea id="code"></textarea>
		output
		<pre><div id="output"></div></pre>
	  </div>
	  
	</div> <!-- container --> 
	
  </body>
  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/colourselect.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="flx/js/glMatrix.js"></script>
  <script src="flx/js/glObjLoader.js"></script>
  <script src="flx/js/glPlyLoader.js"></script>
  <script src="flx/js/ditto.js"></script>
  <script src="js/flickity.pkgd.min.js"></script>
  <script>
    $( document ).ready(function() {
	init_resources({"flx/scm/texture.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define textures ())\n(define textures-load-outstanding 0)\n(define textures-total-load 0)\n\n(define (get-texture name)\n  (foldl\n   (lambda (t r)\n     (if (and (not r) (eq? (car t) name))\n         (cadr t) r))\n   #f\n   textures))\n\n(define (textures-loaded?)\n  (eq? textures-load-outstanding 0))\n\n(define (load-texture-impl! gl name)\n  (if (assoc name textures)\n      name\n      (let ((texture (gl.createTexture)))\n\t(set! textures-load-outstanding (+ textures-load-outstanding 1))\n\t(set! textures-total-load (+ textures-total-load 1))\n        (set! texture.image \n\t      (load-resource-img \n\t       name\n\t       (lambda (image)\n\t\t ;;(msg (list \"loaded\" name))\n\t\t (set! textures-load-outstanding (- textures-load-outstanding 1))\n\t\t (gl.bindTexture gl.TEXTURE_2D texture)\n\t\t (gl.pixelStorei gl.UNPACK_FLIP_Y_WEBGL true)\n\t\t (gl.texImage2D gl.TEXTURE_2D 0 gl.RGBA gl.RGBA gl.UNSIGNED_BYTE image)\n\t\t (gl.generateMipmap gl.TEXTURE_2D)\n;\t\t (gl.texParameteri gl.TEXTURE_2D gl.TEXTURE_MAG_FILTER gl.LINEAR)\n\t\t (gl.texParameteri gl.TEXTURE_2D gl.TEXTURE_MIN_FILTER gl.LINEAR_MIPMAP_LINEAR)\n\t\t (gl.texParameteri gl.TEXTURE_2D gl.TEXTURE_MAG_FILTER gl.LINEAR)\n;\t\t (gl.texParameteri gl.TEXTURE_2D gl.TEXTURE_MIN_FILTER gl.LINEAR)\n\t\t (gl.texParameteri gl.TEXTURE_2D gl.TEXTURE_WRAP_S gl.CLAMP_TO_EDGE)\n \t\t (gl.texParameteri gl.TEXTURE_2D gl.TEXTURE_WRAP_T gl.CLAMP_TO_EDGE)\n\t\t (gl.bindTexture gl.TEXTURE_2D null)\n\t\t (set! textures (cons (list name texture) textures)))))\n        ;; (console.log (+ \"loading \" name))\n        name)))\n\n(define (bind-texture gl shader name)\n  (let ((texture (get-texture name)))\n    ;; may not have loaded yet\n    (when texture\n          (gl.activeTexture gl.TEXTURE0)\n          (gl.bindTexture gl.TEXTURE_2D texture)\n          (gl.uniform1i shader.texture 0))))\n", "scm/constructor.jscm": ";; -*- mode: scheme; -*-\n\n;; Penelope Project Software Copyright (C) 2020 FoAM Kernow\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(load \"flx/scm/fluxus.jscm\")\n\n(define (constructor code pc tx col prims)\n  (list code pc tx col prims))\n\n(define (constructor-code p) (list-ref p 0))\n(define (constructor-modify-code p v) (list-replace p 0 v))\n(define (constructor-pc p) (list-ref p 1))\n(define (constructor-tx p) (list-ref p 2))\n(define (constructor-col p) (list-ref p 3))\n(define (constructor-prims p) (list-ref p 4))\n(define (constructor-modify-prims p v) (list-replace p 4 v))\n\n(define (constructor-update-tx tx token)  \n  (cond\n   ((or (eq? token \"r\")\n\t\t(eq? token \"dr\")\n\t\t(eq? token \"ur\")\n\t\t(eq? token \"rd\")\n\t\t(eq? token \"ru\"))\n\t(mrotate tx (vector 0 0 1) (* -90 rad-conv)))\n   ((or (eq? token \"l\")\n\t\t(eq? token \"dl\")\n\t\t(eq? token \"ul\")\n\t\t(eq? token \"ld\")\n\t\t(eq? token \"lu\"))\n\t(mtranslate\n\t (mrotate tx (vector 0 0 1) (* 90 rad-conv))\n\t (vector 1 -1 0)))\n   (else\n\t(mtranslate tx (vector 1 0 0)))))\n\n(define debug-components #t)\n\n(define (constructor-build-part c token parts)\n  (with-state\n   (colour (constructor-col c))\n   (concat (constructor-tx c))\n   (cond\n    ((eq? token \"f\") (build-instance (list-ref parts 0)))\n    ((eq? token \"fu\") (build-instance (list-ref parts 1)))\n    ((eq? token \"fd\") (build-instance (list-ref parts 2)))\n    ((eq? token \"r\") (build-instance (list-ref parts 3)))\n    ((eq? token \"l\") (build-instance (list-ref parts 4)))\n    ((eq? token \"ur\") (build-instance (list-ref parts 5)))\n    ((eq? token \"ul\") (build-instance (list-ref parts 6)))\n    ((eq? token \"dr\") (build-instance (list-ref parts 7)))\n    ((eq? token \"dl\") (build-instance (list-ref parts 8)))\n    ((eq? token \"ru\") (build-instance (list-ref parts 9)))\n    ((eq? token \"lu\") (build-instance (list-ref parts 10)))\n    ((eq? token \"rd\") (build-instance (list-ref parts 11)))\n    ((eq? token \"ld\") (build-instance (list-ref parts 12)))\n    ((eq? token \"u\") (build-instance (list-ref parts 13)))\n    ((eq? token \"d\") (build-instance (list-ref parts 14)))\n    (else (msg (+ \"unknown token \" token)) 0))))\n\n(define (constructor-update c parts)\n  (if (< (constructor-pc c) (length (constructor-code c)))\n      (let ((instr (list-ref (constructor-code c)\n\t\t\t\t\t\t\t (constructor-pc c))))\n\t\t;; build the prim before (mutably??!) altering tx \n\t\t(let ((prim (constructor-build-part c instr parts)))\n\t\t  (constructor\n\t\t   (constructor-code c)\n\t\t   (+ (constructor-pc c) 1)\n\t\t   (constructor-update-tx (constructor-tx c) instr)\n\t\t   (constructor-col c)\n\t\t   (append (constructor-prims c) prim))))\n      c))\n\n(define (constructor-next-instr c)\n  (list-ref (constructor-code c)\n\t    (constructor-pc c)))\n\n(define (constructor-recycle c)\n  (cond\n   ((> (length (constructor-prims c))\n       ;; we assume every code has a shape associated with it here\n       (* (length (constructor-code c)) 2))\n    (destroy (car (constructor-prims c)))\n    (constructor-modify-prims c (cdr (constructor-prims c))))\n   (else c)))\n\n(define (constructor-step c parts)\n  (let ((instr (list-ref (constructor-code c)\n\t\t\t\t\t\t (constructor-pc c))))\n\t(when (eq? instr undefined)\n\t\t  (msg (length (constructor-code c)))\n\t\t  (msg (constructor-code c))\n\t\t  (msg (constructor-pc c)))\n\n    ;; build the prim before (mutably??!) altering tx \n    (let ((prim (constructor-build-part c instr parts)))\n      (constructor-recycle\n       (constructor\n\t\t(constructor-code c)\n\t\t(modulo (+ (constructor-pc c) 1)\n\t\t\t\t(length (constructor-code c)))\n\t\t(constructor-update-tx (constructor-tx c) instr)\n\t\t(constructor-col c)\n\t\t(append (constructor-prims c) prim))))))\n", "flx/scm/canvas-widgets.jscm": ";; -*- mode: scheme; -*-\n;; Viruscraft Copyright (C) 2018 FoAM Kernow\n\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(load \"flx/scm/canvas.jscm\")\n\n(define (inside-box? px py x y w h)\n  (and (and (> px x) (< px (+ x w)))\n       (and (> py y) (< py (+ y h)))))\n\n(define (draw-circle x y radius)\n  (ctx.beginPath)\n  (ctx.arc x y radius 0 (* Math.PI 2))\n  (ctx.stroke))\n\n(define (draw-line x y x2 y2)\n  (ctx.beginPath)\n  (ctx.moveTo x y)\n  (ctx.lineTo x2 y2)\n  (ctx.stroke))\n\n;; unholy mix of 3d and 2d\n(define (make-mesh-button pos mesh size text fn) \n  (let ((prim (with-state\n\t       (translate pos)\n\t       (load-primitive mesh))))\n    (list pos text size fn \n\t  prim (primitive-screen-pos prim))))\n\n(define (mesh-button-pos b) (list-ref b 0))\n(define (mesh-button-text b) (list-ref b 1))\n(define (mesh-button-size b) (list-ref b 2))\n(define (mesh-button-fn b) (list-ref b 3))\n(define (mesh-button-prim b) (list-ref b 4))\n(define (mesh-button-canvas-pos b) (list-ref b 5))\n\n(define (mesh-button-update b m)\n  (cond\n   ((inside-box?\n     canvas-mouse-x canvas-mouse-y\n     (- (vx (mesh-button-canvas-pos b)) (mesh-button-size b)) \n     (- (vy (mesh-button-canvas-pos b)) (mesh-button-size b))\n     (* (mesh-button-size b) 2)\n     (* (mesh-button-size b) 2))\n    (if canvas-mouse-clicked\n\t(let ((fn (mesh-button-fn b))) \n\t  (set! canvas-event-occurred #t)\n\t  (set! canvas-mouse-clicked #f)\n\t  (fn m))\n\t(with-primitive \n\t (mesh-button-prim b)\n\t (colour (rndvec))\n\t m)))\n   (else m)))\n\n(define (mesh-button-render! b)\n  (let ((m (ctx.measureText (mesh-button-text b))))\n    (ctx.fillText \n     (mesh-button-text b) \n     (- (vx (mesh-button-canvas-pos b)) (/ m.width 2)) \n     (+ (vy (mesh-button-canvas-pos b)) 20)))\n  (with-primitive \n   (mesh-button-prim b)\n   (rotate (vector 1 1 0.5))))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define (make-text-button pos size text fn) \n  (list pos text size fn text))\n\n(define (text-button-pos b) (list-ref b 0))\n(define (text-button-text b) (list-ref b 1))\n(define (text-button-size b) (list-ref b 2))\n(define (text-button-fn b) (list-ref b 3))\n\n(define (text-button-update b m)\n  (cond\n   ((inside-box?\n     canvas-mouse-x canvas-mouse-y\n     (- (vx (text-button-pos b)) (text-button-size b)) \n     (- (vy (text-button-pos b)) (text-button-size b))\n     (* (text-button-size b) 2) \n     (* (text-button-size b) 2))\n    (if canvas-mouse-clicked\n\t(let ((fn (text-button-fn b))) \n\t  (set! canvas-event-occurred #t)\n\t  (set! canvas-mouse-clicked #f)\n\t  (fn m))\n\tm))\n   (else m)))\n\n(define (text-button-render! b)\n  (let ((m (ctx.measureText (text-button-text b))))\n    (ctx.fillText \n     (text-button-text b) \n     (- (vx (text-button-pos b)) (/ m.width 2)) \n     (+ (vy (text-button-pos b)) 20))))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define (make-image-button x y image-name text y-shift anim fn) \n  (let ((image (find-image image-name image-lib)))\n    (list x y image text y-shift anim fn (/ image.width 2) (/ image.height 2))))\n\n(define (image-button-x b) (list-ref b 0))\n(define (image-button-y b) (list-ref b 1))\n(define (image-button-image b) (list-ref b 2))\n(define (image-button-text b) (list-ref b 3))\n(define (image-button-y-shift b) (list-ref b 4))\n(define (image-button-anim b) (list-ref b 5))\n(define (image-button-fn b) (list-ref b 6))\n(define (image-button-width b) (list-ref b 7))\n(define (image-button-height b) (list-ref b 8))\n\n(define (image-button-update b m)\n  (cond\n   ((inside-box?\n     canvas-mouse-x canvas-mouse-y\n     (- (image-button-x b) (image-button-width b)) \n     (- (image-button-y b) (image-button-height b))\n     (* (image-button-width b) 2) \n     (* (image-button-height b) 2))\n    (if canvas-mouse-clicked\n\t(let ((fn (image-button-fn b))) \n\t  (set! canvas-event-occurred #t)\n\t  (set! canvas-mouse-clicked #f)\n\t  (play-sound \"button.wav\")\n\t  (fn m))\n\tm))\n   (else m)))\n\n(define (image-button-render! b)\n  (ctx.save)\n  (ctx.translate \n   (image-button-x b)\n   (image-button-y b))\n  (when (eq? (image-button-anim b) \"twist\")\n\t(ctx.rotate \n\t (* 0.25 (sin (* (+ (modulo (image-button-x b) 109) (time)) 3)))))\n  (when (eq? (image-button-anim b) \"spin\")\n\t(ctx.rotate (+ (modulo (image-button-x b) 109) (* (time) 1))))\n  (when (eq? (image-button-anim b) \"zoom\")\n\t(let ((sc (* 0.1 (sin (* (modulo (image-button-x b) 23) 0.5 (time))))))\n\t  (ctx.scale (+ 1 sc) (+ 1 sc))))\n  \n  (ctx.translate \n   (- (image-button-width b))\n   (- (image-button-height b)))\n\n  (ctx.drawImage (image-button-image b) 0 0)\n  (ctx.restore)\n\n  (wrap-centred-text\n   ctx\n   (image-button-text b) \n   (+ (image-button-x b) 3) ;; is this my eyes??\n   (+ (image-button-y b) 10 (image-button-y-shift b))\n   150 40))\n\n\n  ;; (let ((m (ctx.measureText (image-button-text b))))\n  ;;   (ctx.fillText \n  ;;    (image-button-text b) \n  ;;    (- (image-button-x b) (/ m.width 2)) \n  ;;    (+ (image-button-y b) 10))))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define (make-rect-button x y w h fn) \n  (list x y w h fn))\n\n(define (rect-button-x b) (list-ref b 0))\n(define (rect-button-y b) (list-ref b 1))\n(define (rect-button-width b) (list-ref b 2))\n(define (rect-button-height b) (list-ref b 3))\n(define (rect-button-fn b) (list-ref b 4))\n\n(define (rect-button-update b m)\n  (cond\n   ((inside-box?\n     canvas-mouse-x canvas-mouse-y\n     (rect-button-x b)\n     (rect-button-y b)\n     (rect-button-width b) \n     (rect-button-height b))\n    (if canvas-mouse-clicked\n\t(let ((fn (rect-button-fn b))) \n\t  (set! canvas-event-occurred #t)\n\t  (set! canvas-mouse-clicked #f)\n\t  (fn m))\n\tm))\n   (else m)))\n  \n(define (rect-button-render! b)\n  (ctx.strokeRect\n   (rect-button-x b)\n   (rect-button-y b)\n   (rect-button-width b)\n   (rect-button-height b)))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define (make-toggle-button x y image-name image-name2 text state) \n  (let ((image (find-image image-name image-lib))\n\t(image2 (find-image image-name2 image-lib)))\n    (list x y image image2 text state (/ image.width 2) (/ image.height 2))))\n\n(define (toggle-button-x b) (list-ref b 0))\n(define (toggle-button-y b) (list-ref b 1))\n(define (toggle-button-image b) (list-ref b 2))\n(define (toggle-button-image2 b) (list-ref b 3))\n(define (toggle-button-text b) (list-ref b 4))\n(define (toggle-button-state b) (list-ref b 5))\n(define (toggle-button-modify-state b v) (list-replace b 5 v))\n(define (toggle-button-width b) (list-ref b 6))\n(define (toggle-button-height b) (list-ref b 7))\n\n(define (toggle-button-update b)\n  (cond\n   ((inside-box?\n     canvas-mouse-x canvas-mouse-y\n     (- (toggle-button-x b) (toggle-button-width b)) \n     (- (toggle-button-y b) (toggle-button-height b))\n     (* (toggle-button-width b) 2) \n     (* (toggle-button-height b) 2))\n    (cond (canvas-mouse-clicked\n\t   (set! canvas-event-occurred #t)\n\t   (set! canvas-mouse-clicked #f)\n\t   (toggle-button-modify-state b (not (toggle-button-state b))))\n\t  (else b)))\n   (else b)))\n\n(define (toggle-button-render! b)\n  (ctx.save)\n  (ctx.translate \n   (toggle-button-x b)\n   (toggle-button-y b))\n  (ctx.translate \n   (- (toggle-button-width b))\n   (- (toggle-button-height b)))\n  (ctx.drawImage (toggle-button-image b) 0 0)\n  (when (toggle-button-state b)\n\t(ctx.drawImage (toggle-button-image2 b) 0 0))\n  (ctx.restore)\n  \n  (let ((m (ctx.measureText (toggle-button-text b))))\n    (ctx.fillText \n     (toggle-button-text b) \n     (- (toggle-button-x b) (/ m.width 2)) \n     (- (toggle-button-y b) 30))))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; two images, one that animates when clicked\n\n(define (make-animated-button x y image-name image2-name fn) \n  (let ((image (find-image image-name image-lib))\n\t(image2 (find-image image2-name image-lib)))\n    (list x y image image2 fn (/ image.width 2) (/ image.height 2) -1 \"opening\")))\n\n(define (animated-button-x b) (list-ref b 0))\n(define (animated-button-y b) (list-ref b 1))\n(define (animated-button-image b) (list-ref b 2))\n(define (animated-button-image2 b) (list-ref b 3))\n(define (animated-button-fn b) (list-ref b 4))\n(define (animated-button-width b) (list-ref b 5))\n(define (animated-button-height b) (list-ref b 6))\n(define (animated-button-time b) (list-ref b 7))\n(define (animated-button-modify-time b v) (list-replace b 7 v))\n(define (animated-button-state b) (list-ref b 8))\n(define (animated-button-modify-state b v) (list-replace b 8 v))\n\n(define (animated-button-update b m)\n  (if (eq? (animated-button-state b) \"filling\")\n      (set! b (animated-button-modify-time \n\t       b (+ (animated-button-time b) 2)))  \n      (set! b (animated-button-modify-time \n\t       b (+ (animated-button-time b) 2))))\n  (cond\n   ((inside-box?\n     canvas-mouse-x canvas-mouse-y\n     (- (animated-button-x b) (animated-button-width b)) \n     (- (animated-button-y b) (animated-button-height b))\n     (* (animated-button-width b) 2) \n     (* (animated-button-height b) 2))\n    (if canvas-mouse-clicked\n\t(let ((fn (animated-button-fn b))) \n\t  (set! canvas-event-occurred #t)\n\t  (set! canvas-mouse-clicked #f)\n\t  (fn m))\n\tm))\n   (else m)))\n\n(define (animated-button-render! b)\n  (ctx.save)\n  (ctx.translate \n   (animated-button-x b)\n   (animated-button-y b))\n  (ctx.translate \n   (- (animated-button-width b))\n   (- (animated-button-height b)))\n  (ctx.drawImage (animated-button-image b) 0 0)\n  (ctx.drawImage (animated-button-image2 b) 0 \n\t\t (if (eq? (animated-button-state b) \"filling\")\n\t\t     (- (min 75 (animated-button-time b)) 75)\n\t\t     (- (min 75 (animated-button-time b)))))\n  (ctx.restore))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; 3d version...\n\n;; (define (make-animated-button x y px py image-name image2-name fn) \n;;   (let ((image (with-state \n;; \t\t(translate (vector x y 0))\n;; \t\t(scale (vmul (vector 1 4.6 1) 6))\n;; \t\t(texture (load-texture image-name))\n;; \t\t(load-primitive \"models/plane.obj\")))\n;; \t(image2 (with-state \n;; \t\t (translate (vector x y 0))\n;; \t\t (scale (vmul (vector 1 4.6 1) 6))\n;; \t\t (texture (load-texture image2-name))\n;; \t\t (load-primitive \"models/plane.obj\"))))\n;;     (list px py image image2 fn 61 280 -1 \"opening\")))\n\n;; (define (animated-button-x b) (list-ref b 0))\n;; (define (animated-button-y b) (list-ref b 1))\n;; (define (animated-button-px b) (list-ref b 2))\n;; (define (animated-button-py b) (list-ref b 3))\n;; (define (animated-button-image b) (list-ref b 4))\n;; (define (animated-button-image2 b) (list-ref b 5))\n;; (define (animated-button-fn b) (list-ref b 6))\n;; (define (animated-button-width b) (list-ref b 7))\n;; (define (animated-button-height b) (list-ref b 8))\n;; (define (animated-button-time b) (list-ref b 9))\n;; (define (animated-button-modify-time b v) (list-replace b 9 v))\n;; (define (animated-button-state b) (list-ref b 10))\n;; (define (animated-button-modify-state b v) (list-replace b 10 v))\n\n;; (define (animated-button-update b m)\n;;   (set! b (animated-button-modify-time \n;; \t   b (+ (animated-button-time b) 2)))  \n;;   (cond\n;;    ((inside-box?\n;;      canvas-mouse-x canvas-mouse-y\n;;      (- (animated-button-px b) (animated-button-width b)) \n;;      (- (animated-button-py b) (animated-button-height b))\n;;      (* (animated-button-width b) 2) \n;;      (* (animated-button-height b) 2))\n;;     (msg \"clicked\")\n;;     (if canvas-mouse-clicked\n;; \t(let ((fn (animated-button-fn b))) \n;; \t  (set! canvas-event-occurred #t)\n;; \t  (set! canvas-mouse-clicked #f)\n;; \t  (fn m))\n;; \tm))\n;;    (else m)))\n\n;; (define (animated-button-render! b)\n;;   (with-primitive\n;;    (animated-button-image2 b)\n;;    (identity)\n;;    (translate (vector (animated-button-x b) \n;; \t\t      (animated-button-y b) 0))\n\n;;    (translate (vector 0\n;; \t\t      (* \n;; \t\t       (if (eq? (animated-button-state b) \"filling\")\n;; \t\t\t   (- (min 75 (animated-button-time b)) 75)\n;; \t\t\t   (- (min 75 (animated-button-time b))))\n;; \t\t       3)\n;; \t\t      0))  \n\n;;    (scale (vmul (vector 1 4.6 1) 6))))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define (make-textbox x y style gap just text) (list x y style gap just text))\n\n(define (textbox-x t) (list-ref t 0))\n(define (textbox-y t) (list-ref t 1))\n(define (textbox-style t) (list-ref t 2))\n(define (textbox-gap t) (list-ref t 3))\n(define (textbox-just t) (list-ref t 4))\n(define (textbox-text t) (list-ref t 5))\n\n(define (centre-text ctx text x y)\n  (let ((m (ctx.measureText text)))\n    (ctx.fillText text (- x (/ m.width 2)) y)))\n\n(define (textbox-render! s)\n  (set! ctx.font (string-append (textbox-style s) \" \" canvas-font))\n  (index-for-each\n   (lambda (i text)\n     (let ((m (ctx.measureText text)))\n       (ctx.fillText \n\ttext\n\t(- (textbox-x s) (/ m.width 2)) \n\t(+ (textbox-y s) (* i (textbox-gap s))))))\n   (textbox-text s))\n  (canvas-init-defaults))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define (make-slider x y w p fn) (list x y w p fn))\n(define (slider-x s) (list-ref s 0))\n(define (slider-y s) (list-ref s 1))\n(define (slider-w s) (list-ref s 2))\n(define (slider-p s) (list-ref s 3))\n(define (slider-update-p s v) (list-replace s 3 v))\n(define (slider-fn s) (list-ref s 4))\n\n(define (slider-update s)\n  (cond\n   ((and (or canvas-is-dragging (or (eq? canvas-mouse-state \"down\") (eq? canvas-mouse-state \"clicked\")))\n\t (inside-box?\n\t  canvas-mouse-x canvas-mouse-y\n\t  (slider-x s) (- (slider-y s) 20)\n\t  (slider-w s) 40))\n    (set! canvas-event-occurred #t)\n    (let ((fn (slider-fn s))) (fn (- canvas-mouse-x (slider-x s))))\n    (slider-update-p s (- canvas-mouse-x (slider-x s))))\n   (else s)))\n\n(define (slider-render! s)\n  (ctx.beginPath)\n  (ctx.moveTo (slider-x s) (slider-y s))\n  (ctx.lineTo (+ (slider-x s) (slider-w s)) (slider-y s))\n  (ctx.stroke)\n  (set! ctx.fillStyle \"#81eae3\")\n  (ctx.beginPath)\n  (ctx.moveTo (+ (slider-x s) (slider-p s)) (slider-y s))\n  (ctx.arc (+ (slider-x s) (slider-p s)) (slider-y s) 15 0 (* Math.PI 2))\n  (ctx.fill)\n  (set! ctx.fillStyle \"#000\"))\n\n\n(define (make-window x y w h) (list x y w h))\n\n(define (window-x w) (list-ref w 0))\n(define (window-y w) (list-ref w 1))\n(define (window-w w) (list-ref w 2))\n(define (window-h w) (list-ref w 3))\n\n(define (window-render! w)\n  (let ((grd (ctx.createLinearGradient \n\t      (window-x w) (window-y w) \n\t      (+ (window-x w) (window-w w)) 0)))\n    (set! ctx.globalAlpha 0.2)\n    (grd.addColorStop 0 \"#00ff00\")\n    (grd.addColorStop 1 \"#ffffff\")\n    (set! ctx.fillStyle grd)\n    (ctx.fillRect (window-x w) (window-y w) \n\t\t  (window-w w) (window-h w))\n    (set! ctx.globalAlpha 1)\n    (canvas-init-defaults)))\n\n(define (make-progress-bar x y w h text style p) (list x y w h text style p))\n\n(define (progress-bar-x w) (list-ref w 0))\n(define (progress-bar-y w) (list-ref w 1))\n(define (progress-bar-w w) (list-ref w 2))\n(define (progress-bar-h w) (list-ref w 3))\n(define (progress-bar-text w) (list-ref w 4))\n(define (progress-bar-style w) (list-ref w 5))\n(define (progress-bar-p w) (list-ref w 6))\n(define (progress-bar-update-p w v) (list-replace w 6 v))\n\n(define (progress-bar-render! w)\n  (let ((grd (ctx.createLinearGradient \n\t      (progress-bar-x w) (progress-bar-y w) \n\t      (+ (progress-bar-x w) (progress-bar-w w)) 0)))\n    (set! ctx.strokeStyle \"#000\")\n    (ctx.strokeRect (progress-bar-x w) (progress-bar-y w) \n\t\t    (progress-bar-w w) (progress-bar-h w))\n    (set! ctx.globalAlpha 0.5)\n    (grd.addColorStop 0 \"#00ff00\")\n    (grd.addColorStop 1 \"#ffffff\")\n    (set! ctx.fillStyle grd)\n    (ctx.fillRect (progress-bar-x w) (progress-bar-y w) \n\t\t  (* (progress-bar-w w)\n\t\t     (/ (clamp (progress-bar-p w) 0 100) 100))\n\t\t  (progress-bar-h w))\n    (set! ctx.globalAlpha 1)\n    (set! ctx.font (progress-bar-style w))\n    (set! ctx.fillStyle \"#000\")\n    (let ((txt (string-append (progress-bar-text w) \" \" \n\t\t\t      (clamp (floor (progress-bar-p w)) 0 100) \"%\")))\n      (let ((m (ctx.measureText txt)))\n\t(ctx.fillText \n\t txt \n\t (- (+ (progress-bar-x w) (/ (progress-bar-w w) 2)) (/ m.width 2)) \n\t (+ (progress-bar-y w) 25))))\n    \n    (canvas-init-defaults)))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define random-offsets (build-list 100 (lambda (_) (rndf))))\n\n(define (make-coin-stack x y image-name text count) \n  (let ((image (find-image image-name image-lib)))\n    (list x y image text count (random 1000))))\n\n(define (coin-stack-x b) (list-ref b 0))\n(define (coin-stack-y b) (list-ref b 1))\n(define (coin-stack-image b) (list-ref b 2))\n(define (coin-stack-text b) (list-ref b 3))\n(define (coin-stack-count b) (list-ref b 4))\n(define (coin-stack-modify-count b v) (list-replace b 4 v))\n(define (coin-stack-seed b) (list-ref b 5))\n  \n(define (coin-stack-render! b)\n  (js \"for (i=0; i<coin_stack_count(b); i++) {\")\n  (ctx.drawImage (coin-stack-image b) \n\t\t (+ (coin-stack-x b)\n\t\t    (* 10 (- (list-ref random-offsets (modulo (+ i (coin-stack-seed b)) 100)) \n\t\t\t     0.5)))\n\t\t (- (coin-stack-y b) (* i 10)))\n  (js \"}\")  \n  (let ((m (ctx.measureText (coin-stack-text b))))\n    (ctx.fillText \n     (coin-stack-text b) \n     (+ (- (coin-stack-x b) (/ m.width 2)) 25) \n     (+ (coin-stack-y b) 75))))\n\n(define (wrap-text ctx text x y max-width line-height)\n  (define (wrap-text-inner words line y)\n    (cond\n     ((null? words)\n      (ctx.fillText line x y))\n     (else\n      (let ((test-line (+ line (car words) \" \")))\n        (let ((metrics (ctx.measureText test-line)))\n          (cond ((> metrics.width max-width)\n                 (ctx.fillText line x y)\n                 (wrap-text-inner (cdr words)\n                                  (+ (car words) \" \")\n                                  (+ y line-height)))\n                (else\n                 (wrap-text-inner\n                  (cdr words) test-line y))))))))\n  (wrap-text-inner (text.split \" \") \"\" y))\n\n(define (centred-text ctx text x y)\n  (let ((m (ctx.measureText text)))\n    (ctx.fillText text (- x (/ m.width 2)) y)))\n\n(define (wrap-centred-text ctx text x y max-width line-height)\n  (define (wrap-text-inner words line y)\n    (cond\n     ((null? words)\n      (centred-text ctx line x y))\n     (else\n      (let ((test-line (+ line (car words) \" \")))\n        (let ((metrics (ctx.measureText test-line)))\n          (cond ((> metrics.width max-width)\n                 (centred-text ctx line x y)\n                 (wrap-text-inner (cdr words)\n                                  (+ (car words) \" \")\n                                  (+ y line-height)))\n                (else\n                 (wrap-text-inner\n                  (cdr words) test-line y))))))))\n  (wrap-text-inner (text.split \" \") \"\" y))\n\n", "flx/scm/glsl.jscm": ";; -*- mode: scheme; -*-\n;; Viruscraft (C) 2017 FoAM Kernow\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define (compile-shader gl type code)\n  (let ((shader (gl.createShader type)))\n    (gl.shaderSource shader code)\n    (gl.compileShader shader)\n    (if (not (gl.getShaderParameter shader gl.COMPILE_STATUS))\n\t(begin\n\t  (alert (gl.getShaderInfoLog shader))\n\t  #f)\n\tshader)))\n\n;; can\'t call this before link time - so can\'t use it to automatically\n;; bind locations to names :( so we need to pass in expected attrib-names\n(define (get-attrib-info-list gl program)\n  (define (_ i c)\n    (if (>= i c)\n\t\'()\n\t(cons (gl.getActiveAttrib program i) (_ (+ i 1) c))))\n  (_ 0 (gl.getProgramParameter program gl.ACTIVE_ATTRIBUTES)))\n\n      ;; (let ((attrib-list (get-attrib-info-list gl shader-program)))\n      ;; \t(msg attrib-list)\n      ;; \t(index-for-each\n      ;; \t (lambda (index info)\n      ;; \t   (msg (+ index \" \" info.name))\n      ;; \t   (gl.bindAttribLocation shader-program index info.name))\n      ;; \t attrib-list)\n\n\n      ;; \t(index-for-each\n      ;; \t (lambda (index info)\n      ;; \t   (gl.enableVertexAttribArray index))\n      ;; \t attrib-list))\n\n;; this version is useful, however...\n(define (get-uniform-info-list gl program)\n  (define (_ i c)\n    (if (>= i c)\n\t\'()\n\t(cons (gl.getActiveUniform program i) (_ (+ i 1) c))))\n  (_ 0 (gl.getProgramParameter program gl.ACTIVE_UNIFORMS)))\n\n(define (build-shader gl attrib-names vert frag)\n  (let ((fragment-shader (compile-shader gl gl.FRAGMENT_SHADER frag))\n\t(vertex-shader (compile-shader gl gl.VERTEX_SHADER vert)))\n    (let ((shader-program (gl.createProgram)))\n      (gl.attachShader shader-program vertex-shader)\n      (gl.attachShader shader-program fragment-shader)\n      \n      (index-for-each\n       (lambda (index attrib-name)\n\t (gl.bindAttribLocation shader-program index attrib-name))\n       attrib-names)\n      \n      (gl.linkProgram shader-program)\n      (when (not (gl.getProgramParameter shader-program gl.LINK_STATUS))\n            (alert (gl.getShaderInfoLog shader)))\n\n      (gl.useProgram shader-program)\n\n;      (index-for-each\n;       (lambda (index attrib-name)\n;\t (if (not (eq? (gl.getAttribLocation shader-program attrib-name) -1))\n;\t     (gl.enableVertexAttribArray index)\n;\t     (msg (+ \"asked for \" attrib-name \" but not in shader (maybe optimised away)\"))))\n ;      attrib-names)\n      \n      ;; expose all the uniform variables  \n      (for-each\n       (lambda (info)\n\t (set! (js \"shader_program[info.name]\") (gl.getUniformLocation shader-program info.name)))\n       (get-uniform-info-list gl shader_program))\n\n      shader-program)))\n\n;; should presumably replace this stuff with uniform buffer objects?\n(define (make-uniform-item name type value) (list name type value))\n(define (uniform-item-name u) (list-ref u 0))\n(define (uniform-item-type u) (list-ref u 1))\n(define (uniform-item-value u) (list-ref u 2))\n\n(define (apply-uniform-items! gl shader ui)\n  (for-each \n   (lambda (u)\n     (internal-uniform! \n      gl \n      shader\n      (uniform-item-name u) \n      (uniform-item-type u)\n      (uniform-item-value u)))\n   ui))\n\n(define (set-uniform-item ui l)\n  (cond\n   ((null? l) (list ui))\n   ((eq? (uniform-item-name (car l)) (uniform-item-name ui))\n    (cons ui (cdr l)))\n   (else\n    (cons (car l) (set-uniform-item ui (cdr l))))))\n\n;; todo: add matrices\n(define (internal-uniform! gl shader name type value)\n  (cond\n   ((number? value)\n    (if (eq? type \"f\")\n\t(gl.uniform1f (js \"shader[name]\") value)\n\t(gl.uniform1i (js \"shader[name]\") value)))\n   (else\n    (cond\n     ((eq? (length value) 1)\n      (if (eq? type \"f\")\n\t  (gl.uniform1fv (js \"shader[name]\") value)\n\t  (gl.uniform1iv (js \"shader[name]\") value)))\n     ((eq? (length value) 2)\n      (if (eq? type \"f\")\n\t  (gl.uniform2fv (js \"shader[name]\") value)\n\t  (gl.uniform2iv (js \"shader[name]\") value)))\n     ((eq? (length value) 3)\n      (if (eq? type \"f\")\n\t  (gl.uniform3fv (js \"shader[name]\") value)\n\t  (gl.uniform3iv (js \"shader[name]\") value)))\n     ((eq? (length value) 4)\n      (if (eq? type \"f\")\n\t  (gl.uniform4fv (js \"shader[name]\") value)\n\t  (gl.uniform4iv (js \"shader[name]\") value)))\n     (else\n      (msg (+ \"internal-shader-set: unhandled type: \" value)))))))\n \n", "scm/interface.jscm": ";; -*- mode: scheme; -*-\n\n;; Penelope Project Software Copyright (C) 2020 FoAM Kernow\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define (read-number id)\n  (let ((w ($ (string-append \"#\" id))))\n    (parseFloat (js \"w[0].value\"))))\n\n(define (read-checked id)\n  (let ((w ($ (string-append \"#\" id))))\n    (if (js \"w[0].checked\") 1 0)))\n\n(define (write-checked id v)\n  (let ((w ($ (string-append \"#\" id))))\n    (if (zero? v)\n\t(js \"w[0].checked=false\")\n\t(js \"w[0].checked=true\"))))\n\n(define (is-checked? id)\n  (not (zero? (read-checked id))))\n\n(define (read-selected id)\n  (let ((w ($ (string-append \"#\" id))))\n    (js \"w[0].value\")))\n\n(define (draft-row y x)\n  (if (< x 0)\n      \"\"\n      (string-append\n\t   \"<label class=\'draft-check\'>\"\n       \"<input id=\'draft-\" x \"-\" y \"\' type=\'checkbox\' \"\n       (if (if (zero? (modulo y 2))\n\t       (zero? (modulo x 2))\n\t       (zero? (modulo (+ x 1) 2))) \"checked\" \"\")\n       \" ><span class=\'checkmark\'></span></input></label> \"\n       (draft-row y (- x 1)))))\n\n(define (setup-draft-interface w h)\n  (define (_ c y)\n    (if (< y 0)\n\t\"\"\n\t(string-append\n\t (string-append\n\t  \"<div class=\'draft-row\'>\"\n\t  (draft-row y (- w 1))\n\t  \"</div>\")\n\t (_ c (- y 1)))))\n  (let ((c ($ \"#draft\")))\n    (c.html (_ c (- h 1)))))\n\n(define (read-draft-interface)\n  (define (read-row x y)\n    (if (< x 0)\n\t\'()\n\t(cons (read-checked (string-append \"draft-\" x \"-\" y))\n\t      (read-row (- x 1) y))))\n  (define (read-col y)\n    (if (< y 0)\n\t\'()\n\t(cons (read-row (- (read-number \"warp-threads\") 1) y)\n\t      (read-col (- y 1)))))\n  (read-col (- (read-number \"weft-threads\") 1)))\n\n(define (write-draft-interface draft)\n  (define (write-row x y)\n    (when (>= x 0)\n\t\t  (write-checked (string-append \"draft-\" x \"-\" y)\n\t\t\t\t\t\t (list-ref (list-ref draft y) x))\n\t  (write-row (- x 1) y)))\n  (define (write-col y)\n    (when (>= y 0)\n\t  (write-row (- (read-number \"warp-threads\") 1) y)\n\t  (write-col (- y 1))))\n  (write-col (- (read-number \"weft-threads\") 1)))\n\n;; colours\n(define (hex->colour hex)\n  (let ((bigint (parseInt (hex.substring 1) 16)))\n    (list (/ (bitwise-and (bitwise-rshift bigint 16) 255) 255)\n\t\t  (/ (bitwise-and (bitwise-rshift bigint 8) 255) 255)\n\t\t  (/ (bitwise-and bigint 255) 255))))\n\n(define (colour->hex c)\n  (define (_ n)\n\t(let ((v (trunc (* n 255))))\n\t  (let ((v2 (v.toString 16)))\n\t\t(v2.padStart 2 \"0\"))))\n  (string-append\n   \"#\"\n   (_ (vx c))\n   (_ (vy c)) \n   (_ (vz c))))\n\n(define (colour-selector id)\n  (string-append\n  \"<div id=\'\" id \"-div\' class=\'custom-select\'>\n\t\t  <select id=\'\" id \"\'>\n\t\t\t<option value=\'#c5b799\'>undyed cotton</option>\n\t\t\t<option value=\'#c5b799\'>undyed cotton</option>\n\t\t\t<option value=\'#637a8f\'>light woad</option>\n\t\t\t<option value=\'#445a8a\'>dark woad</option>\n\t\t\t<option value=\'#574e5e\'>oak gall</option>\n\t\t\t<option value=\'#a11939\'>dark madder</option>\n\t\t\t<option value=\'#de9170\'>light madder</option>\n\t\t\t<option value=\'#eae82b\'>light weld</option>\n\t\t\t<option value=\'#929240\'>dark weld</option>\n\t\t  </select>\n\t\t</div>\"))\n\n;; can\'t \'store\' the colours in the input fields so \'for now\'\n;; store them globally here...\n\n;; actually, now we are using a select we are so retrofitting badly\n\n(define warp-colours \n  (list (hex->colour \"#c5b799\") (hex->colour \"#c5b799\")))\n(define weft-colours\n  (list (hex->colour \"#c5b799\") (hex->colour \"#c5b799\")))\n\n(define (build-colour-selectors type cols n)\n  (if (null? cols)\n      \"\"\n      (string-append\n       (colour-selector (string-append \"colour-\" type \"-\" n))\n       (build-colour-selectors type (cdr cols) (+ n 1)))))\n\n(define (setup-colour-interface)\n  (let ((c ($ \"#warp-colours\")))\n    (c.html (build-colour-selectors \"warp\" warp-colours 0)))\n  (let ((c ($ \"#weft-colours\")))\n    (c.html (build-colour-selectors \"weft\" weft-colours 0)))\n\n  (initOneColourSelect (string-append \"colour-warp-0-div\"))\n  (initOneColourSelect (string-append \"colour-warp-1-div\"))\n  (initOneColourSelect (string-append \"colour-weft-0-div\"))\n  (initOneColourSelect (string-append \"colour-weft-1-div\")))\n\n(define (add-colour type)\n  (cond\n   ((eq? type \"warp\")\n\t(let ((c ($ \"#warp-colours\")))\n\t  (c.append (colour-selector (string-append \"colour-\" type \"-\" (length warp-colours))))\n\t  (initOneColourSelect (string-append \"colour-\" type \"-\" (length warp-colours) \"-div\"))\n\t  (set! warp-colours (append warp-colours (list (hex->colour \"#c5b799\"))))))\n   (else\n\t(let ((c ($ \"#weft-colours\")))\n\t  (c.append (colour-selector (string-append \"colour-\" type \"-\" (length weft-colours))))\n\t  (initOneColourSelect (string-append \"colour-\" type \"-\" (length weft-colours) \"-div\"))\n\t  (set! weft-colours (append weft-colours (list (hex->colour \"#c5b799\")))))))\n  (update))\n\n(define (remove-colour type)\n  (cond\n   ((eq? type \"warp\")\n\t(when (> (length warp-colours) 1) \n\t\t  (let ((el ($ (dbg (string-append \"#colour-\" type \"-\" (- (length warp-colours) 1) \"-div\")))))\n\t\t\t(el.remove)\n\t\t\t(set! warp-colours (reverse (cdr (reverse warp-colours)))))))\n   (else\n\t(when (> (length weft-colours) 1) \n\t\t  (let ((el ($ (string-append \"#colour-\" type \"-\" (- (length weft-colours) 1) \"-div\"))))\n\t\t\t(el.remove)\n\t\t\t(set! weft-colours (reverse (cdr (reverse weft-colours))))))))\n  (update))\n\n(define (update-colour c)\n  (let ((ss (c.id.split \"-\")))\n\t(let ((type (list-ref ss 1))\n\t\t  (id (string->number (list-ref ss 2))))\n\t  ;;(msg c.value)\n\t  ;;(msg (hex->colour c.value))\n\n\t  (if (eq? type \"warp\")\n\t\t  (set! warp-colours\n\t\t\t\t(list-replace\n\t\t\t\t warp-colours id\n\t\t\t\t (hex->colour c.value)))\n\t\t  (set! weft-colours\n\t\t\t\t(list-replace\n\t\t\t\t weft-colours id\n\t\t\t\t (hex->colour c.value))))\n\t  (update)\n\t  )))\n\t\t \n\n", "shaders/default.vert": "precision highp float;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 C;\nvarying vec3 N;\nvarying vec3 L;\nuniform mat4 ModelViewMatrix;\nuniform mat4 NormalMatrix;\nuniform vec3 CameraPos;\nattribute vec3 p;\nattribute vec3 t;\nattribute vec3 n;\nattribute vec3 c;\n\nvoid main()\n{\n    P = p.xyz;\n    T = t;\n    C = c;\n    L = vec3(0,1,0); /* vec3(ModelViewMatrix*vec4((vec3(0,10,0)-p),1)); */\n    N = normalize(vec3(NormalMatrix*vec4(n,1)));\t\n    gl_Position = ModelViewMatrix * vec4(p,1);\n}\n", "scm/loom.jscm": ";; -*- mode: scheme; -*-\n\n;; Penelope Project Software Copyright (C) 2020 FoAM Kernow\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(load \"flx/scm/fluxus.jscm\")\n(load \"scm/symbolic.jscm\")\n(load \"scm/constructor.jscm\")\n(load \"scm/components.jscm\")\n\n(define (make-loom draft warp weft state t root weft-count)\n  (list draft warp weft state t root weft-count))\n\n(define (loom-draft l) (list-ref l 0))\n(define (loom-modify-draft l v) (list-replace l 0 v))\n(define (loom-warp l) (list-ref l 1))\n(define (loom-modify-warp l v) (list-replace l 1 v))\n(define (loom-weft l) (list-ref l 2))\n(define (loom-modify-weft l v) (list-replace l 2 v))\n(define (loom-state l) (list-ref l 3))\n(define (loom-modify-state l v) (list-replace l 3 v))\n(define (loom-t l) (list-ref l 4))\n(define (loom-modify-t l v) (list-replace l 4 v))\n(define (loom-root l) (list-ref l 5))\n(define (loom-weft-count l) (list-ref l 6))\n(define (loom-modify-weft-count l v) (list-replace l 6 v))\n\n;; ----------------------------------------------------------\n\n(define (build-loom draft warp-threads weft-threads warp-colours weft-colours)\n  (let ((root (build-locator))\n\t\t(weft-threads (make-divisible-by-wefts weft-threads (length weft-colours))))\n    (with-state\n     (shader-assign-compiled \"default\")  \n     (parent root)\n     (make-loom\n      draft\n      (build-list\n       warp-threads\n       (lambda (i)\n\t\t (constructor\n\t\t  (kernel->warp-thread draft i weft-threads)\n\t\t  0\n\t\t  (mrotate\n\t\t   (mtranslate (midentity) (vector (+ i 0.5) 1.5 0))\n\t\t   (vector 0 0 1)\n\t\t   (* -90 rad-conv))\n\t\t  (vmul (list-ref warp-colours (modulo i (length warp-colours))) 2)\n\t\t  \'())))\n      (build-list\n       (length weft-colours)\n\t   (lambda (i)\n\t\t (constructor\n\t\t  (kernel->weft-thread\n\t\t   draft i warp-threads weft-threads (length weft-colours))\n\t\t  i\n\t\t  (mtranslate (midentity) (vector i (- i) (* i 0.01))) ;; prevent z fighting\n\t\t  (vmul (list-ref weft-colours (modulo i (length weft-colours))) 2)\t\t\n\t\t  \'())))\n      \"filling-warp\"\n      0\n      root\n\t  0))))\n\n(define (loom-step-warp l components)\n  (loom-modify-warp\n   l (map\n      (lambda (e)\n\t\t(with-state\n\t\t (parent (loom-root l))\n\t\t (constructor-step e components)))\n      (loom-warp l))))\n\n(define (loom-step-weft-all l components)\n  (loom-modify-weft\n   l (map\n      (lambda (e)\n\t\t(with-state\n\t\t (parent (loom-root l))\n\t\t (constructor-step e components)))\n      (loom-weft l))))\n\n(define (loom-step-weft l components)\n  (loom-modify-weft\n   l (list-replace\n\t  (loom-weft l)\n\t  (loom-weft-count l) \n\t  (with-state\n\t   (parent (loom-root l))\n\t   (constructor-step\n\t\t(list-ref (loom-weft l) (loom-weft-count l))\n\t\tcomponents)))))\n\n(define (loom-step-weft-n l components n)\n  (if (zero? n)\n\t  l\n\t  (loom-step-weft-n \n\t   (loom-modify-weft\n\t\tl (list-replace\n\t\t   (loom-weft l)\n\t\t   (loom-weft-count l) \n\t\t   (with-state\n\t\t\t(parent (loom-root l))\n\t\t\t(constructor-step\n\t\t\t (list-ref (loom-weft l) (loom-weft-count l))\n\t\t\t components))))\n\t   components (- n 1))))\n\n(define move-time 1)\n(define weave-time 0.05)\n\n;;(define (loom-selvedge-step? step)\n;;  (or (eq? step \"l\") (eq? step \"r\")\n;;\t  (eq? step \"lu\") (eq? step \"ru\")\n;;\t  (eq? step \"ld\") (eq? step \"rd\")\n;;\t  (eq? step \"dl\") (eq? step \"dr\")\n;;\t  (eq? step \"ul\") (eq? step \"ur\")))\n\n(define (loom-selvedge-step? step)\n  (or\n   (eq? step \"l\") (eq? step \"r\")\n   (eq? step \"dl\") (eq? step \"dr\")\n   (eq? step \"ul\") (eq? step \"ur\")))\n\n(define (loom-not-selvedge-step? step)\n  (or (eq? step \"u\") (eq? step \"d\")\n\t  (eq? step \"fu\") (eq? step \"fd\")))\n\n(define (loom-update l d components)\n  (let ((state (loom-state l)))\n    (cond\n     ((eq? state \"filling-warp\")\n      (if (and (not (null? (loom-warp l)))\n\t\t\t   (< (constructor-pc (car (loom-warp l)))\n\t\t\t\t  (- (length (constructor-code (car (loom-warp l)))) 1)))\n\t\t  (loom-step-warp l components)\n\t\t  (loom-modify-state\n\t\t   ;; step the warp a few extra times to bring\n\t\t   ;; it under the weaving pos\n\t\t   (loom-step-warp \n\t\t\t(loom-step-warp l components)\n\t\t\tcomponents)\n\t\t   \"filling-weft\")))\n\n     ((eq? state \"filling-weft\")\n      (if (< (constructor-pc (car (loom-weft l)))\n\t\t\t (- (length (constructor-code (car (loom-weft l)))) 1))\n\t\t  (loom-step-weft-all l components)\n\t\t  (loom-modify-state l \"warping\")))\n\t \n\t ((eq? state \"warping\")\n      (if (> (loom-t l) weave-time)\t\t  \n\t\t  (loom-modify-t\n\t\t   (if (< (loom-weft-count l) (length (loom-weft l)))\n\t\t\t   (loom-modify-weft-count \n\t\t\t\t(loom-step-warp l components)\n\t\t\t\t(+ (loom-weft-count l) 1))\t\t\t   \n\t\t\t   (loom-modify-weft-count\n\t\t\t\t(loom-modify-state l \"weaving\")\n\t\t\t\t0))    \n\t\t   0)\n\t\t  (loom-modify-t l (+ (loom-t l) d))))\t  \n\n\t ((eq? state \"weaving\")\n      (if (> (loom-t l) weave-time)\n\t\t  (loom-step-weft-n \n\t\t   (loom-modify-t\n\t\t\t(let ((step (constructor-next-instr (list-ref (loom-weft l) (loom-weft-count l)))))\n\t\t\t  ;;(msg (list \"w\" (loom-weft-count l) step (constructor-pc (list-ref (loom-weft l) (loom-weft-count l)))))\n\t\t\t  (if (loom-selvedge-step? step)\n\t\t\t\t  (if (< (loom-weft-count l) (- (length (loom-weft l)) 1))\n\t\t\t\t\t  (loom-modify-weft-count\n\t\t\t\t\t   l (+ (loom-weft-count l) 1))\n\t\t\t\t\t  (loom-modify-weft-count\n\t\t\t\t\t   (loom-modify-state l \"selvedge\") 0))\n\t\t\t\t  l))   \n\t\t\t0)\n\t\t   components 1)\n\t\t  (loom-modify-t l (+ (loom-t l) d))))\n\n\t ((eq? state \"selvedge\")\n      (if (> (loom-t l) weave-time)\n\t\t  (loom-step-weft \n\t\t   (loom-modify-t\n\t\t\t(let ((step (constructor-next-instr (list-ref (loom-weft l) (loom-weft-count l)))))\n\t\t\t  ;;(msg (list \"s\" (loom-weft-count l) step (constructor-pc (list-ref (loom-weft l) (loom-weft-count l)))))\n\t\t\t  ;;(msg (loom-weft l))\n\t\t\t  (if (loom-not-selvedge-step? step)\n\t\t\t\t  (if (< (loom-weft-count l) (- (length (loom-weft l)) 1))\n\t\t\t\t\t  (loom-modify-weft-count\n\t\t\t\t\t   l (+ (loom-weft-count l) 1))\n\t\t\t\t\t  (loom-modify-weft-count\n\t\t\t\t\t   (loom-modify-state l \"read\") 0))\n\t\t\t\t  l))   \n\t\t\t0)\n\t\t   components)\n\t\t  (loom-modify-t l (+ (loom-t l) d))))\n\n\t ((eq? state \"read\")\n\t  (msg \"read\")\n\t  (loom-modify-state\n\t   (loom-update-draft \n\t\tl (read-draft-interface)\n\t\t(read-number \"fabric-warp-size\")\n\t\t(make-divisible-by-wefts\n\t\t (read-number \"fabric-weft-size\")\n\t\t (length (loom-weft l))))\n\t   \"moving\"))\n\t \n\t ((eq? state \"moving\")\n      (with-primitive\n       (loom-root l)\n       (translate (vector 0 (* d (length (loom-weft l))) 0)) ;; one unit per second\n       (if (> (loom-t l) move-time)\n\t\t   (loom-modify-state l \"warping\")\n\t\t   (loom-modify-t l (+ (loom-t l) d)))))\n     (else l))))\n\n\n(define (loom-update-draft l draft warp-threads weft-threads)\n  (loom-modify-draft\n   (loom-modify-weft\n    (loom-modify-warp\n     l (index-map\n\t\t(lambda (i e)\n\t\t  (constructor-modify-code\n\t\t   e (kernel->warp-thread draft i weft-threads)))\n\t\t(loom-warp l)))\n    (index-map\n     (lambda (i e)\n       (constructor-modify-code\n\t\te (kernel->weft-thread\n\t\t   draft i warp-threads weft-threads\n\t\t   (length (loom-weft l)))))\n\t (loom-weft l)))\n   draft))\n\n\n", "scm/components.jscm": ";; -*- mode: scheme; -*-\n\n;; Penelope Project Software Copyright (C) 2020 FoAM Kernow\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(load \"flx/scm/fluxus.jscm\")\n\n(define comp-points 10)\n(define comp-segments (- (/ comp-points 2) 1))\n\n(define (auto-strip-normals flat)\n  (pdata-index-map!\n   (lambda (i n)\n     (if (< i 2)\n\t\t (vcross\n\t\t  (vnormalise (vsub (pdata-ref \"p\" 1) (pdata-ref \"p\" (+ i 2))))\n\t\t  (if flat\n\t\t\t  (vector 0 1 0)\n\t\t\t  (if (zero? (modulo i 2))\n\t\t\t\t  (vnormalise (vector 0 0.5 0.5))\n\t\t\t\t  (vnormalise (vector 0 0.5 -0.5)))))\n\t\t (vcross\n\t\t  (vnormalise (vsub (pdata-ref \"p\" (- i 2)) (pdata-ref \"p\" i)))\n\t\t  (if flat\n\t\t\t  (vector 0 1 0)\n\t\t\t  (if (zero? (modulo i 2))\n\t\t\t\t  (vnormalise (vector 0 0.5 0.5))\n\t\t\t\t  (vnormalise (vector 0 0.5 -0.5)))))))\n   \"n\"))\n\n(define (auto-strip-tex)\n  (pdata-index-map!\n   (lambda (i t)\n     (if (zero? (modulo i 2))\n\t\t (vector (/ (quotient i 2) comp-segments) 0 0)\n\t\t (vector (/ (quotient i 2) comp-segments) 1 0)))\n   \"t\"))\n\n\n(define (init-components)\n  (list\n   ;; forward\n   (build-polygons \'triangles 6)\n   ;; forward up\n   (build-polygons \'triangles 6)\n   ;; forward down\n   (build-polygons \'triangles 6)  \n   ;; right\n   (build-polygons \'triangle-strip comp-points)\n   ;; left\n   (build-polygons \'triangle-strip comp-points)\n   ;; up-right\n   (build-polygons \'triangle-strip comp-points)\n   ;; up-left\n   (build-polygons \'triangle-strip comp-points)\n   ;; down-right\n   (build-polygons \'triangle-strip comp-points)\n   ;; down-left\n   (build-polygons \'triangle-strip comp-points)\n   ;; right-up\n   (build-polygons \'triangle-strip comp-points)\n   ;; left-up\n   (build-polygons \'triangle-strip comp-points)\n   ;; right-down\n   (build-polygons \'triangle-strip comp-points)\n   ;; left-down\n   (build-polygons \'triangle-strip comp-points)\n   ;; up\n   (build-polygons \'triangle-strip comp-points)\n   ;; down\n   (build-polygons \'triangle-strip comp-points)))\n\n(define (build-forward p thread-width use-texture flat z-offset)\n  (define thread-start (/ (- 1 thread-width) 2))\n  (define thread-end (- 1 thread-start))\n  (with-primitive\n   p\n   (hide 1)\n   (texture (load-texture (if use-texture \"thread.png\" \"white.png\")))\n   (pdata-set! \"p\" 0 (vector 0 thread-start z-offset))\n   (pdata-set! \"p\" 1 (vector 1 thread-start z-offset))\n   (pdata-set! \"p\" 2 (vector 1 thread-end z-offset))\n   (pdata-set! \"p\" 3 (vector 0 thread-start z-offset))\n   (pdata-set! \"p\" 4 (vector 0 thread-end z-offset))\n   (pdata-set! \"p\" 5 (vector 1 thread-end z-offset))\n\n   (cond\n\t(flat\n\t (pdata-map! (lambda (n) (vector 0 0 -1)) \"n\"))\n\t(else\n\t (pdata-set! \"n\" 0 (vector 0 0.5 -0.5))\n\t (pdata-set! \"n\" 1 (vector 0 0.5 -0.5))\n\t (pdata-set! \"n\" 2 (vector 0 -0.5 -0.5))\n\t (pdata-set! \"n\" 3 (vector 0 0.5 -0.5))\n\t (pdata-set! \"n\" 4 (vector 0 -0.5 -0.5))\n\t (pdata-set! \"n\" 5 (vector 0 -0.5 -0.5))))\n   \n   (pdata-set! \"t\" 0 (vector 0 0 0))\n   (pdata-set! \"t\" 1 (vector 1 0 0))\n   (pdata-set! \"t\" 2 (vector 1 1 0))\n   (pdata-set! \"t\" 3 (vector 0 0 0))\n   (pdata-set! \"t\" 4 (vector 0 1 0))\n   (pdata-set! \"t\" 5 (vector 1 1 0))\n   (pdata-map! (lambda (c) (vector 1 1 1)) \"c\")\n\n   (pdata-upload!))\n  p)\n\n(define (build-right p thread-width use-texture flat z-offset-start z-offset-end)\n  (define thread-start (/ (- 1 thread-width) 2))\n  (define thread-end (- 1 thread-start))\n  (with-primitive\n   p\n   (hide 1)\n   (texture (load-texture (if use-texture \"thread.png\" \"white.png\")))\n   (pdata-index-map!\n\t(lambda (i p)  \n\t  (let ((r (if (zero? (modulo i 2)) thread-start thread-end)))\n\t\t(let ((t (/ (quotient i 2) comp-segments)))\n\t\t  (let ((a (* t 0.5 pi)))\n\t\t\t(vadd (vmul (vector (cos a) (sin a) 0) r)\n\t\t\t\t  (vector 0 0 (lerp z-offset-start z-offset-end t)))))))\n\t\"p\")\n   (pdata-map! (lambda (c) (vector 1 1 1)) \"c\")\n   (auto-strip-tex)\n   (cond\n\t(flat\n\t (pdata-map! (lambda (n) (vector 0 0 -1)) \"n\"))\n\t(else\n\t (auto-strip-normals #f)\n\t (pdata-map! (lambda (n) (vmul n -1)) \"n\")))\n   (pdata-upload!))\n  p)\n\n(define (build-left p thread-width use-texture flat z-offset-start z-offset-end)\n  (define thread-start (/ (- 1 thread-width) 2))\n  (define thread-end (- 1 thread-start))\n  (with-primitive\n   p\n   (hide 1)\n   (pdata-index-map!\n\t(lambda (i p)  \n\t  (let ((r (if (zero? (modulo i 2)) thread-end thread-start)))\n\t\t(let ((t (/ (quotient i 2) comp-segments)))\n\t\t  (let ((a (* t 0.5 pi)))\n\t\t\t(vadd (vmul (vector (cos a) (- (sin a)) 0) r)\n\t\t\t\t  (vector 0 1 (lerp z-offset-start z-offset-end t)))))))\n\t\"p\")\n   (auto-strip-tex)\n   (cond\n\t(flat\n\t (pdata-map! (lambda (n) (vector 0 0 -1)) \"n\"))\n\t(else\n\t (auto-strip-normals #f)\n\t (pdata-map! (lambda (n) (vmul n -1)) \"n\")))\n   (pdata-map! (lambda (c) (vector 1 1 1)) \"c\")\n   \n   (pdata-upload!))\n  p)\n\n(define (build-components components weave-height thread-width use-texture flat)\n  (define thread-start (/ (- 1 thread-width) 2))\n  (define thread-end (- 1 thread-start))\n\n  ;; todo: instances don\'t seem to inherit texture state...\n  \n  (list\n   ;; forward \n   (build-forward (list-ref components 0) thread-width use-texture flat 0)\n   ;; forward up\t\n   (build-forward (list-ref components 1) thread-width use-texture flat weave-height)\n   ;; forward down\n   (build-forward (list-ref components 2) thread-width use-texture flat -weave-height)\n   ;; right\n   (build-right (list-ref components 3) thread-width use-texture flat 0 0)\n   ;; left\n   (build-left (list-ref components 4) thread-width use-texture flat 0 0)\n\n   ;; up-right\n   (build-right (list-ref components 5) thread-width use-texture flat 0 weave-height)\n   ;; up-left\n   (build-left (list-ref components 6) thread-width use-texture flat 0 0)\n   ;; down-right \n   (build-right (list-ref components 7) thread-width use-texture flat 0 -weave-height)\n   ;; down-left\n   (build-left (list-ref components 8) thread-width use-texture flat 0 -weave-height)\n   ;; right-up\n   (build-right (list-ref components 9) thread-width use-texture flat weave-height 0)\n   ;; left-up\n   (build-left (list-ref components 10) thread-width use-texture flat weave-height 0)\n   ;; right-down \n   (build-right (list-ref components 11) thread-width use-texture flat 0 0)\n   ;; left-down\n   (build-left (list-ref components 12) thread-width use-texture flat -weave-height 0)\n   \n   ;; up (down - up)\n   (let ((p (list-ref components 13)))\n     (with-primitive\n      p\n      (hide 1)\n      (texture (load-texture (if use-texture \"thread.png\" \"white.png\")))\n      (rotate (vector 45 0 0))\n      (pdata-index-map!\n       (lambda (i p)\n\t\t (vector\n\t\t  (/ (quotient i 2) comp-segments)\n\t\t  (if (zero? (modulo i 2)) thread-start thread-end)\n\t\t  (* (cos (* pi (/ (quotient i 2) comp-segments))) -weave-height)))\n       \"p\")\n\n      (auto-strip-tex)\n      (pdata-map! (lambda (c) (vector 1 1 1)) \"c\")\n\n      (auto-strip-normals flat)\n\n      (when (not flat)\n\t\t\t(pdata-set! \"n\" 0 (vector 0 0.5 -0.5))\n\t\t\t(pdata-set! \"n\" 1 (vector 0 -0.5 -0.5)))\n      \n      (pdata-upload!))\n     p)\n   \n   ;; down (up - down)\n   (let ((p (list-ref components 14))) \n     (with-primitive\n      p\n      (hide 1)\n      (texture (load-texture (if use-texture \"thread.png\" \"white.png\")))\n      (rotate (vector 45 0 0))\n      (pdata-index-map!\n       (lambda (i p)\n\t\t (vector\n\t\t  (/ (quotient i 2) comp-segments)\n\t\t  (if (zero? (modulo i 2)) thread-start thread-end)\n\t\t  (* (cos (* pi (/ (quotient i 2) comp-segments))) weave-height)))\n\t   \"p\")\n\t  \n\t  (auto-strip-tex)\n      (pdata-map! (lambda (c) (vector 1 1 1)) \"c\")\n      (auto-strip-normals flat)\n\n      (when (not flat)\n\t\t\t(pdata-set! \"n\" 0 (vector 0 0.5 -0.5))\n\t\t\t(pdata-set! \"n\" 1 (vector 0 -0.5 -0.5)))\n      \n      (pdata-upload!))\n     p)\n\n\n   ))\n\n\n", "flx/scm/instanceprim.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define (instanceprim polyref)\n  (list polyref))\n\n(define (instanceprim-polyref p) (list-ref p 0))\n\n(define (instanceprim-render p gl view-camera camera-pos state tx)\n  (pdata-render \n   (polyprim-pdata (instanceprim-polyref p))\n   (polyprim-type (instanceprim-polyref p))\n   gl view-camera camera-pos state tx))\n", "models/receptor-donut.obj": "# Blender v2.69 (sub 0) OBJ File: \'builder.blend\'\n# www.blender.org\no donut2_Circle.005\nv -0.757098 1.969384 -0.995156\nv -0.699468 2.259113 -0.995157\nv -0.699468 2.259113 0.995282\nv -0.757098 1.969384 0.995282\nv -0.553655 2.477337 0.995282\nv -0.553655 2.477337 -0.995157\nv -0.535349 2.504733 -0.995157\nv -0.535349 2.504733 0.995282\nv -0.705895 1.711970 -0.995156\nv -0.705895 1.711970 0.995282\nv -0.699468 1.679655 0.995282\nv -0.699468 1.679655 -0.995156\nv -0.289729 2.668851 -0.995157\nv -0.289729 2.668851 0.995282\nv -0.535349 1.434034 -0.995156\nv -0.535349 1.434035 0.995282\nv 0.000000 2.726482 -0.995157\nv 0.000000 2.726482 0.995282\nv -0.289729 1.269916 -0.995156\nv -0.289729 1.269916 0.995282\nv 0.289729 2.668851 -0.995157\nv 0.289729 2.668852 0.995282\nv -0.000000 1.212286 -0.995156\nv -0.000000 1.212286 0.995282\nv 0.535349 2.504733 -0.995157\nv 0.535349 2.504733 0.995282\nv 0.289729 1.269916 -0.995156\nv 0.289729 1.269916 0.995282\nv 0.699468 2.259113 -0.995157\nv 0.699468 2.259113 0.995282\nv 0.535349 1.434034 -0.995156\nv 0.535349 1.434034 0.995282\nv 0.705896 2.226797 -0.995157\nv 0.757098 1.969384 -0.995156\nv 0.757098 1.969384 0.995282\nv 0.705896 2.226797 0.995282\nv 0.553654 1.461430 0.995282\nv 0.699468 1.679655 0.995282\nv 0.699468 1.679655 -0.995156\nv 0.553654 1.461430 -0.995156\nv -0.765367 3.817143 0.995282\nv 0.765366 3.817143 0.995282\nv 0.000000 3.969384 0.995282\nv 1.414213 3.383598 0.995282\nv 0.000000 3.969384 -0.995157\nv -0.765367 3.817143 -0.995157\nv 0.765366 3.817143 -0.995157\nv -1.414214 3.383597 0.995282\nv 1.414213 3.383598 -0.995157\nv -1.414214 3.383597 -0.995157\nv 1.847759 2.734751 0.995282\nv 1.847759 2.734751 -0.995157\nv -1.847759 2.734751 -0.995157\nv -1.847759 2.734751 0.995282\nv 2.000000 1.969384 -0.995156\nv 2.000000 1.969384 0.995282\nv -2.000000 1.969384 -0.995156\nv -2.000000 1.969384 0.995282\nv 1.847759 1.204017 -0.995156\nv 1.847759 1.204017 0.995282\nv -1.847759 1.204017 -0.995156\nv -1.847759 1.204017 0.995282\nv 1.414213 0.555170 -0.995156\nv 1.414213 0.555170 0.995282\nv -1.414214 0.555170 -0.995156\nv -1.414214 0.555170 0.995282\nv 0.765366 0.121625 -0.995156\nv 0.765366 0.121625 0.995283\nv -0.765367 0.121625 -0.995156\nv -0.765367 0.121625 0.995283\nv -1.000000 -3.860563 1.000000\nv -1.000000 -3.860563 -1.000000\nv 1.000000 -3.860563 -1.000000\nv 1.000000 -3.860563 1.000000\nv -1.000000 0.310364 1.000000\nv -1.000000 0.310364 -1.000000\nv 1.000000 0.310364 -1.000000\nv 1.000000 0.310364 1.000000\nvt 0.274823 1.052786\nvt 0.274823 1.081284\nvt 0.077634 1.081284\nvt 0.967037 0.000000\nvt 0.967037 0.024333\nvt 0.769848 0.024333\nvt 0.967037 0.081739\nvt 0.967037 0.106072\nvt 0.769848 0.106072\nvt 0.668712 1.067670\nvt 0.471523 1.070891\nvt 0.471523 1.067670\nvt 0.668712 1.070891\nvt 0.471523 1.042015\nvt 0.668712 1.042015\nvt 0.668712 0.989734\nvt 0.668712 0.992386\nvt 0.471523 0.992386\nvt 0.668712 1.013517\nvt 0.471523 1.013517\nvt 0.254439 0.585847\nvt 0.225174 0.585847\nvt 0.225174 0.388658\nvt 0.302170 0.585847\nvt 0.281476 0.585847\nvt 0.281476 0.388658\nvt 0.077634 1.027130\nvt 0.274823 1.023910\nvt 0.274823 1.027130\nvt 0.077634 1.023910\nvt 0.077634 1.052786\nvt 0.967037 0.053036\nvt 0.769848 0.053036\nvt 0.077634 1.105067\nvt 0.077634 1.102414\nvt 0.274823 1.102414\nvt 0.668712 1.095748\nvt 0.471523 1.095748\nvt 0.769848 0.081739\nvt 0.198136 0.585847\nvt 0.198136 0.388658\nvt 0.254439 0.388658\nvt 0.077634 0.999053\nvt 0.274823 0.999053\nvt 0.155675 0.388658\nvt 0.304408 0.359073\nvt 0.232983 0.388658\nvt 0.359073 0.304408\nvt 0.084250 0.359073\nvt 0.388658 0.232984\nvt 0.029585 0.304408\nvt 0.235999 0.256693\nvt 0.256693 0.235999\nvt 0.208962 0.267892\nvt 0.179696 0.267892\nvt 0.152659 0.256693\nvt 0.267892 0.208962\nvt 0.150351 0.254385\nvt 0.267892 0.205698\nvt 0.388658 0.155675\nvt 0.267892 0.179696\nvt 0.131965 0.235999\nvt 0.000000 0.232984\nvt 0.120766 0.208962\nvt 0.120766 0.182961\nvt 0.256693 0.152659\nvt 0.238307 0.134273\nvt 0.359073 0.084250\nvt 0.152659 0.131965\nvt 0.131965 0.152659\nvt 0.000000 0.155675\nvt 0.179696 0.120766\nvt 0.208962 0.120766\nvt 0.235999 0.131965\nvt 0.120766 0.179696\nvt 0.029585 0.084250\nvt 0.304408 0.029585\nvt 0.084250 0.029585\nvt 0.232983 0.000000\nvt 0.530602 0.792545\nvt 0.605886 0.792545\nvt 0.605886 0.989734\nvt 0.054666 0.999053\nvt 0.000000 0.999053\nvt 0.000000 0.801864\nvt 0.203399 0.999053\nvt 0.274823 0.801864\nvt 0.769848 0.330609\nvt 0.769848 0.254329\nvt 0.967037 0.254329\nvt 0.769848 0.179045\nvt 0.769848 0.116218\nvt 0.967037 0.116218\nvt 0.366450 0.585847\nvt 0.302170 0.783036\nvt 0.454321 0.792545\nvt 0.530602 0.989734\nvt 0.126090 0.999053\nvt 0.054666 0.801864\nvt 0.668712 0.792545\nvt 0.769848 0.396272\nvt 0.967037 0.330609\nvt 0.126090 0.801864\nvt 0.324378 0.388658\nvt 0.388658 0.388658\nvt 0.388658 0.585847\nvt 0.388658 0.792545\nvt 0.454321 0.989734\nvt 0.403740 0.122313\nvt 0.403740 0.273960\nvt 0.388658 0.198136\nvt 0.446691 0.058033\nvt 0.446691 0.338240\nvt 0.510971 0.015082\nvt 0.510971 0.381190\nvt 0.511790 0.198136\nvt 0.517499 0.226839\nvt 0.517499 0.169433\nvt 0.533758 0.145100\nvt 0.533758 0.251172\nvt 0.558091 0.128841\nvt 0.536472 0.252986\nvt 0.586794 0.000000\nvt 0.561293 0.128204\nvt 0.586794 0.123132\nvt 0.558091 0.267431\nvt 0.586794 0.273140\nvt 0.586794 0.396272\nvt 0.612296 0.268068\nvt 0.637116 0.143287\nvt 0.615497 0.128841\nvt 0.662618 0.015082\nvt 0.661798 0.198136\nvt 0.656089 0.169433\nvt 0.662618 0.381190\nvt 0.656089 0.226839\nvt 0.639830 0.251172\nvt 0.639830 0.145100\nvt 0.615497 0.267431\nvt 0.726898 0.338240\nvt 0.726898 0.058033\nvt 0.769848 0.273960\nvt 0.769848 0.122313\nvt 1.000000 0.809253\nvt 0.801864 0.809253\nvt 0.801864 0.396272\nvt 0.198136 0.801864\nvt 0.000000 0.388658\nvt 0.801638 0.594409\nvt 0.801638 0.792545\nvt 0.388658 0.594408\nvt 0.388658 0.396272\nvt 1.000000 1.007389\nvt 0.801864 1.007389\nvt 0.769848 0.000000\nvt 0.471523 0.989734\nvt 0.302170 0.388658\nvt 0.274823 1.105067\nvt 0.967037 0.179045\nvt 0.203399 0.801864\nvt 0.967037 0.396272\nvt 0.366450 0.783036\nvt 0.324378 0.585847\nvt 0.388658 0.989734\nvt 1.000000 0.396272\nvt 0.388658 0.594409\nvt 0.801864 0.594408\nvn 0.980785 -0.195091 0.000000\nvn -0.555570 -0.831470 0.000000\nvn 0.555570 -0.831470 0.000000\nvn -0.980785 -0.195090 0.000000\nvn -0.831469 0.555572 -0.000000\nvn -0.831470 0.555570 -0.000000\nvn -0.195090 0.980785 -0.000000\nvn 0.555570 0.831470 0.000000\nvn 0.980786 0.195088 0.000000\nvn 0.980785 0.195091 -0.000000\nvn -0.195090 -0.980785 0.000000\nvn 0.831471 -0.555568 0.000000\nvn 0.831470 -0.555570 0.000000\nvn -0.831469 -0.555571 0.000000\nvn 0.195091 -0.980785 0.000000\nvn -0.980785 0.195090 -0.000000\nvn -0.555570 0.831470 -0.000000\nvn 0.195091 0.980785 0.000000\nvn 0.831470 0.555570 0.000000\nvn 0.000000 0.000000 1.000000\nvn 0.000000 0.000001 1.000000\nvn -0.980785 0.195091 0.000000\nvn -0.555570 0.831469 0.000000\nvn 0.195090 0.980785 0.000000\nvn 0.831469 0.555570 0.000000\nvn -0.195091 0.980785 -0.000000\nvn 0.980785 -0.195090 0.000000\nvn -0.831469 -0.555570 0.000000\nvn -0.000000 0.000000 -1.000000\nvn -1.000000 0.000000 0.000000\nvn 1.000000 0.000000 0.000000\nvn 0.000000 -1.000000 0.000000\nvn -0.555569 -0.831470 0.000000\nvn -0.980785 -0.195091 0.000000\nvn 0.831473 -0.555566 0.000000\nvn 0.195090 -0.980785 0.000000\nvn 0.831469 0.555571 -0.000000\nvn 0.831469 -0.555571 0.000000\nvn 0.831469 -0.555570 0.000000\nvn 0.195090 0.980785 -0.000001\nvn -0.831470 -0.555570 0.000000\ns off\nf 1/1/1 2/2/1 3/3/1\nf 26/4/2 22/5/2 21/6/2\nf 14/7/3 8/8/3 7/9/3\nf 36/10/4 29/11/4 33/12/4\nf 36/10/4 30/13/4 29/11/4\nf 33/12/4 34/14/4 35/15/4\nf 32/16/5 37/17/5 40/18/5\nf 37/17/6 38/19/6 39/20/6\nf 24/21/7 28/22/7 27/23/7\nf 16/24/8 20/25/8 19/26/8\nf 10/27/9 12/28/9 9/29/9\nf 10/27/10 11/30/10 12/28/10\nf 9/29/10 1/1/10 4/31/10\nf 22/5/11 18/32/11 17/33/11\nf 8/34/12 5/35/12 6/36/12\nf 5/35/13 3/3/13 6/36/13\nf 30/13/14 26/37/14 25/38/14\nf 18/32/15 14/7/15 13/39/15\nf 38/19/16 35/15/16 34/14/16\nf 28/22/17 32/40/17 31/41/17\nf 20/25/18 24/21/18 23/42/18\nf 11/30/19 16/43/19 15/44/19\nf 41/45/20 42/46/20 43/47/20\nf 41/45/21 44/48/21 42/46/21\nf 41/45/21 48/49/21 44/48/21\nf 44/48/20 48/49/20 51/50/20\nf 51/50/20 48/49/20 54/51/20\nf 51/50/20 22/52/20 26/53/20\nf 51/50/20 18/54/20 22/52/20\nf 51/50/20 54/51/20 18/54/20\nf 54/51/20 14/55/20 18/54/20\nf 54/51/20 8/56/20 14/55/20\nf 26/53/20 30/57/20 51/50/20\nf 54/51/20 5/58/20 8/56/20\nf 36/59/20 56/60/20 51/50/20\nf 56/60/20 36/59/20 35/61/20\nf 3/62/20 5/58/20 54/51/20\nf 54/51/20 58/63/20 4/64/20\nf 10/65/20 4/64/20 58/63/20\nf 38/66/20 37/67/20 60/68/20\nf 60/68/20 56/60/20 35/61/20\nf 20/69/20 16/70/20 62/71/20\nf 62/71/20 24/72/20 20/69/20\nf 62/71/20 60/68/20 24/72/20\nf 60/68/20 28/73/20 24/72/20\nf 60/68/20 32/74/20 28/73/20\nf 16/70/20 11/75/20 62/71/20\nf 60/68/20 37/67/20 32/74/20\nf 10/65/20 58/63/20 62/71/20\nf 60/68/20 62/71/20 66/76/20\nf 60/68/20 66/76/20 64/77/20\nf 64/77/21 66/76/21 70/78/21\nf 64/77/21 70/78/21 68/79/21\nf 58/80/22 54/81/22 53/82/22\nf 42/83/8 44/84/8 49/85/8\nf 48/44/23 41/86/23 50/87/23\nf 51/88/10 56/89/10 55/90/10\nf 60/91/13 64/92/13 63/93/13\nf 70/24/2 66/94/2 69/95/2\nf 62/96/4 58/80/4 57/97/4\nf 43/98/24 42/83/24 47/99/24\nf 54/81/6 48/100/6 53/82/6\nf 44/101/25 51/88/25 52/102/25\nf 41/86/26 43/98/26 45/103/26\nf 56/89/27 60/91/27 55/90/27\nf 64/104/3 68/105/3 67/106/3\nf 66/107/28 62/96/28 61/108/28\nf 47/109/29 46/110/29 45/111/29\nf 46/110/29 47/109/29 49/112/29\nf 46/110/29 49/112/29 50/113/29\nf 50/113/29 49/112/29 52/114/29\nf 50/113/29 52/114/29 53/115/29\nf 53/115/29 17/116/29 13/117/29\nf 53/115/29 52/114/29 17/116/29\nf 52/114/29 21/118/29 17/116/29\nf 52/114/29 25/119/29 21/118/29\nf 13/117/29 7/120/29 53/115/29\nf 52/114/29 29/121/29 25/119/29\nf 7/120/29 6/122/29 53/115/29\nf 52/114/29 55/123/29 33/124/29\nf 34/125/29 33/124/29 55/123/29\nf 53/115/29 6/122/29 2/126/29\nf 1/127/29 57/128/29 53/115/29\nf 57/128/29 1/127/29 9/129/29\nf 40/130/29 39/131/29 59/132/29\nf 34/125/29 55/123/29 59/132/29\nf 23/133/29 27/134/29 59/132/29\nf 59/132/29 61/135/29 23/133/29\nf 61/135/29 19/136/29 23/133/29\nf 61/135/29 15/137/29 19/136/29\nf 27/134/29 31/138/29 59/132/29\nf 61/135/29 12/139/29 15/137/29\nf 31/138/29 40/130/29 59/132/29\nf 61/135/29 57/128/29 9/129/29\nf 61/135/29 59/132/29 65/140/29\nf 65/140/29 59/132/29 63/141/29\nf 65/140/29 63/141/29 69/142/29\nf 69/142/29 63/141/29 67/143/29\nf 75/144/30 76/145/30 72/146/30\nf 76/147/29 77/85/29 73/148/29\nf 77/149/31 78/150/31 74/107/31\nf 78/151/20 75/152/20 71/146/20\nf 71/153/32 72/154/32 73/145/32\nf 4/31/27 1/1/27 3/3/27\nf 25/155/33 26/4/33 21/6/33\nf 13/39/3 14/7/3 7/9/3\nf 35/15/34 36/10/34 33/12/34\nf 31/156/6 32/16/6 40/18/6\nf 40/18/6 37/17/6 39/20/6\nf 23/42/7 24/21/7 27/23/7\nf 15/157/8 16/24/8 19/26/8\nf 4/31/10 10/27/10 9/29/10\nf 21/6/11 22/5/11 17/33/11\nf 7/158/35 8/34/35 6/36/35\nf 29/11/28 30/13/28 25/38/28\nf 17/33/36 18/32/36 13/39/36\nf 39/20/22 38/19/22 34/14/22\nf 27/23/17 28/22/17 31/41/17\nf 19/26/24 20/25/24 23/42/24\nf 12/28/37 11/30/37 15/44/37\nf 30/57/20 36/59/20 51/50/20\nf 3/62/20 54/51/20 4/64/20\nf 38/66/20 60/68/20 35/61/20\nf 11/75/20 10/65/20 62/71/20\nf 57/97/16 58/80/16 53/82/16\nf 47/99/8 42/83/8 49/85/8\nf 3/3/38 2/2/38 6/36/38\nf 52/102/10 51/88/10 55/90/10\nf 59/159/39 60/91/39 63/93/39\nf 48/100/6 50/16/6 53/82/6\nf 61/108/34 62/96/34 57/97/34\nf 45/103/40 43/98/40 47/99/40\nf 41/86/17 46/160/17 50/87/17\nf 49/161/25 44/101/25 52/102/25\nf 46/160/7 41/86/7 45/103/7\nf 66/94/2 65/162/2 69/95/2\nf 63/163/3 64/104/3 67/106/3\nf 65/164/41 66/107/41 61/108/41\nf 29/121/29 52/114/29 33/124/29\nf 2/126/29 1/127/29 53/115/29\nf 39/131/29 34/125/29 59/132/29\nf 12/139/29 61/135/29 9/129/29\nf 71/165/30 75/144/30 72/146/30\nf 72/41/29 76/147/29 73/148/29\nf 73/166/31 77/149/31 74/107/31\nf 74/167/20 78/151/20 71/146/20\nf 74/144/32 71/153/32 73/145/32\nf 60/91/27 59/159/27 55/90/27\n", "textures/white.png": "iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90FHQ4QIHPVuvAAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAACW0lEQVR42u3UMQEAAAjDMMC/52EAByQSerSTpICXRgIwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMADAAwAAAAwAMAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwAMADAAAADAAwADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAAwAMAAAAMADAC4LB6wBfy1zhUaAAAAAElFTkSuQmCC", "flx/scm/polyprim.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define (polyprim size type vb)\n  (list size type vb))\n\n(define (polyprim-size p) (list-ref p 0))\n(define (polyprim-type p) (list-ref p 1))\n(define (polyprim-pdata p) (list-ref p 2))\n(define (polyprim-modify-pdata p v) (list-replace p 2 v))\n\n(define (build-polyprim gl type pdata)\n  (let ((p (polyprim \n\t    (pdata-size-verts pdata) type \n\t    (pdata-build-vbo gl pdata))))\n    (pdata-update-vbo! gl pdata)\n    p))\n\n(define (build-empty-polyprim gl type size-verts)\n  ;; match load obj for the moment with points, \n  ;; normals and texturecoords \n  (build-polyprim \n   gl type (make-pdata \n\t    (list \"p\" \"n\" \"t\" \"c\")\n\t    size-verts\n\t    (build-list \n\t     (* (* size-verts 4) 3) \n\t     (lambda (i) 0)))))\n\n(define (polyprim-update-buffers! gl p)\n  (pdata-update-vbo! gl (polyprim-pdata p)))\n  \n(define (polyprim-render p gl view-camera camera-pos state tx)\n  (pdata-render\n   (polyprim-pdata p)\n   (polyprim-type p)\n   gl view-camera camera-pos state tx))\n\n", "textures/thread.png": "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", "flx/scm/meshcache.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define mesh-cache ())\n(define meshes-load-outstanding 0)\n(define meshes-total-load 0)\n\n(define (get-mesh name)\n  (foldl\n   (lambda (t r)\n     (if (and (not r) (eq? (car t) name))\n         (cadr t) r))\n   #f\n   mesh-cache))\n\n(define (meshes-loaded?)\n  (eq? meshes-load-outstanding 0))\n\n(define (load-mesh-cache name)\n  (let ((type (substring name (- (length name) 3) (length name))))\n    (set! meshes-load-outstanding (+ meshes-load-outstanding 1))\n    (set! meshes-total-load (+ meshes-total-load 1))\n    (cond\n     ((eq? type \"obj\")\n      (load-resource-txt \n       name \n       (lambda (data)\n\t (let ((data (inner-load-obj data)))\n\t   (set! meshes-load-outstanding (- meshes-load-outstanding 1))\n\t   (set! mesh-cache (cons (list name data) mesh-cache))))))\n     (else\n      (load-resource-txt \n       name \n       (lambda (data)\n\t (let ((data (inner-load-ply data)))\n\t   (set! meshes-load-outstanding (- meshes-load-outstanding 1))\n\t   (set! mesh-cache (cons (list name data) mesh-cache)))))))))\n\n(define (deep-copy a)\n  ($.extend #t (js \"{}\") a))\n\n(define (mesh-cache-search name)\n  (let ((mesh (assoc name mesh-cache)))\n    (cond \n     (mesh (deep-copy (cadr mesh)));; deep copy!?\n     (else \n      (msg (+ \"mesh not loaded into cache in preload: \" name))\n      (let ((type (substring name (- (length name) 3) (length name))))\n\t(if (eq? type \"obj\")\n\t    (force-load-obj name)\n\t    (force-load-ply name)))))))\n\n", "flx/scm/state.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define FLX_HINT_NONE           0x00000000)\n(define FLX_HINT_SOLID          0x00000001)\n(define FLX_HINT_WIRE           0x00000002)\n(define FLX_HINT_NORMAL         0x00000004)\n(define FLX_HINT_POINTS         0x00000008)\n(define FLX_HINT_AALIAS         0x00000010)\n(define FLX_HINT_BOUND          0x00000020)\n(define FLX_HINT_UNLIT          0x00000040)\n(define FLX_HINT_VERTCOLS       0x00000080)\n(define FLX_HINT_ORIGIN         0x00000100)\n(define FLX_HINT_CAST_SHADOW    0x00000200)\n(define FLX_HINT_IGNORE_DEPTH   0x00000400)\n(define FLX_HINT_DEPTH_SORT     0x00000800)\n(define FLX_HINT_LAZY_PARENT    0x00001000)\n(define FLX_HINT_CULL_FACE      0x00002000)\n(define FLX_HINT_CULL_CCW       0x00004000) ;; was something else\n(define FLX_HINT_SPHERE_MAP     0x00008000)\n(define FLX_HINT_FRUSTUM_CULL   0x00010000)\n(define FLX_HINT_NORMALISE      0x00020000)\n(define FLX_HINT_NOBLEND        0x00040000)\n(define FLX_HINT_NOZWRITE       0x00080000)\n\n(define (state gl)\n  (list\n   (mat4.identity (mat4.create))\n   (shader-cache-search \"main\")\n   (vector 1 1 1)\n   \"\"\n   FLX_HINT_SOLID\n   0\n   #f \n   \'()))\n\n(define (state-tx s) (list-ref s 0))\n(define (state-shader s) (list-ref s 1))\n(define (state-modify-shader s v) (list-replace s 1 v))\n(define (state-colour s) (list-ref s 2))\n(define (state-modify-colour s v) (list-replace s 2 v))\n(define (state-texture s) (list-ref s 3))\n(define (state-modify-texture s v) (list-replace s 3 v))\n(define (state-hints s) (list-ref s 4))\n(define (state-modify-hints s v) (list-replace s 4 v))\n(define (state-parent s) (list-ref s 5))\n(define (state-modify-parent s v) (list-replace s 5 v))\n(define (state-hidden s) (list-ref s 6))\n(define (state-modify-hidden s v) (list-replace s 6 v))\n(define (state-uniform-items s) (list-ref s 7))\n(define (state-modify-uniform-items s v) (list-replace s 7 v))\n\n(define (state-clone s)\n  (list\n   (mat4.create (state-tx s))\n   (state-shader s) ;; todo: shader clone\n   (vector-clone (state-colour s))\n   (state-texture s)\n   (state-hints s)\n   (state-parent s)\n   (state-hidden s)\n   (state-uniform-items s)))\n", "scm/symbolic.jscm": ";; -*- mode: scheme; -*-\n\n;; Penelope Project Software Copyright (C) 2020 FoAM Kernow\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(load \"flx/scm/fluxus.jscm\")\n\n;;------------------------------------------------------------\n;; produces lists of thread codes from kernels\n\n;; kernel  = ((1 0)(0 1))\n;; pattern = 0 1 0 1 0 1 0 1 \n;; thread  = u fu fu d fd fd u\n\n(define (make-even v)\n  (if (zero? (modulo v 2))\n      v (+ v 1)))\n\n;; increase size so it contains a whole number\n;; multiple of wefts*2 (forward and back)\n(define (make-divisible-by-wefts size wefts)\n  (if (zero? (modulo size (* wefts 2)))\n\t  size\n\t  (+ size (- (* wefts 2) (modulo size (* wefts 2))))))\n\n;(define (make-divisible-by-wefts size wefts)\n;  (+ size (modulo size (* wefts 2))))\n\n(define (pattern-extend c m p)\n  (cond\n    ((>= c m) \'())\n    (else\n     (cons\n      (list-ref p (modulo c (length p)))\n      (pattern-extend (+ c 1) m p)))))\n\n(define (pattern-invert p)\n  (map\n   (lambda (i)\n     (if (zero? i) 1 0))\n   p))\n\n(define (pattern->token kernel-code state)\n  (if (zero? kernel-code)\n      (if (eq? state \"d\") \"fd\" \"d\")  \n      (if (eq? state \"u\") \"fu\" \"u\"))) ;; 1 = warp up\n  \n(define (kernel-row k i)\n  (list-ref k (modulo i (length k))))\n\n(define (kernel-col k i)\n  (map\n   (lambda (row)\n     (kernel-row row i))\n   k))\n\n(define (kernel-invert k)\n  (map\n   (lambda (r)\n     (pattern-invert r))\n   k))\n\n(define (pattern->thread pattern state) \n  (cond\n    ((null? pattern) \'())\n    (else\n     (let ((token (pattern->token (car pattern) state)))\n       (cons\n        token\n        (pattern->thread\n         (cdr pattern)\n         (cond\n           ((eq? token \"u\") \"u\")\n           ((eq? token \"d\") \"d\")\n           (else state))))))))\n\n(define (kernel-final-state kernel warp-thread fabric-height)\n  (let ((thread (pattern->thread\n\t\t (pattern-extend 0 fabric-height (kernel-col kernel warp-thread))\n\t\t \"?\")))\n    ;; we need to run through the whole pattern to check the state\n    ;; at the end, to then plug in to recalculating it\n    (let ((token (list-ref thread (- (length thread) 1))))\n      (if (or (eq? token \"u\") (eq? token \"fu\"))\n\t  \"u\" \"d\"))))\n\n(define (kernel->warp-thread kernel warp-thread fabric-height)\n  (pattern->thread\n   (pattern-extend 0 fabric-height (kernel-col kernel warp-thread))\n   (kernel-final-state kernel warp-thread fabric-height)))\n\n(define (make-selvedge direction size)\n  (define (_ c)\n\t(cond\n\t ((eq? c 1) \'()) ;; one = loop right around\n\t (else\n\t  ;; selvedge forward is in the middle\n\t  (cons \"f\" (_ (- c 1))))))\n  (append\n   ;; these will be replaced by tensioning below\n   (list (if (zero? direction) \"r\" \"l\"))\n   (_ size)\n   (list (if (zero? direction) \"r\" \"l\"))))\n\n;; todo: make this into a general purpose processor\n(define (tension-selvedge weft)\n  (define (_ last cur next)\n\t(cond\n\t ((and (eq? last \"fu\") (eq? cur \"l\")) \"ul\")\n\t ((and (eq? last \"fu\") (eq? cur \"r\")) \"ur\")\n\t ((and (eq? last \"fd\") (eq? cur \"l\")) \"dl\")\n\t ((and (eq? last \"fd\") (eq? cur \"r\")) \"dr\")\n\t ((and (eq? cur \"l\") (eq? next \"fu\")) \"lu\")\n\t ((and (eq? cur \"r\") (eq? next \"fu\")) \"ru\")\n\t ((and (eq? cur \"l\") (eq? next \"fd\")) \"ld\")\n\t ((and (eq? cur \"r\") (eq? next \"fd\")) \"rd\")\n\t ((and (eq? last \"u\") (eq? cur \"l\")) \"ul\")\n\t ((and (eq? last \"u\") (eq? cur \"r\")) \"ur\")\n\t ((and (eq? last \"d\") (eq? cur \"l\")) \"dl\")\n\t ((and (eq? last \"d\") (eq? cur \"r\")) \"dr\")\n\t ((and (eq? cur \"l\") (eq? next \"u\")) \"ld\")\n\t ((and (eq? cur \"r\") (eq? next \"u\")) \"rd\")\n\t ((and (eq? cur \"l\") (eq? next \"d\")) \"lu\")\n\t ((and (eq? cur \"r\") (eq? next \"d\")) \"ru\")\n\n\t ;; tension forwards in selvedge\n\t ;; ((and (eq? last \"fu\") (eq? cur \"f\")) \"fu\")\n\t ;; ((and (eq? last \"fd\") (eq? cur \"f\")) \"fd\")\n\t ;; ((and (eq? last \"lu\") (eq? cur \"f\")) \"fu\")\n\t ;; ((and (eq? last \"ld\") (eq? cur \"f\")) \"fd\")\n\t ;; ((and (eq? last \"ru\") (eq? cur \"f\")) \"fu\")\n\t ;; ((and (eq? last \"rd\") (eq? cur \"f\")) \"fd\")\n\t ;; ((and (eq? last \"ul\") (eq? cur \"f\")) \"fu\")\n\t ;; ((and (eq? last \"dl\") (eq? cur \"f\")) \"fd\")\n\t ;; ((and (eq? last \"ur\") (eq? cur \"f\")) \"fu\")\n\t ;; ((and (eq? last \"dr\") (eq? cur \"f\")) \"fd\")\n\n\t (else cur)))\n  ;; cdr to chop off first \"?\"\n  (append\n   ;; process all the tokens in the middle\n   (cdr (list-ref\n\t\t (foldl\n\t\t  (lambda (next r)\n\t\t\t(let ((last (list-ref r 0))\n\t\t\t\t  (cur (list-ref r 1))\n\t\t\t\t  (out (list-ref r 2)))\n\t\t\t  (list cur next (append out (list (_ last cur next))))))\n\t\t  (list \"?\" \"?\" \'())\n\t\t  weft)\n\t\t 2))\n   ;; and sort the final token\n   (list\n\t(_ (list-ref weft (- (length weft) 2))\n\t   (list-ref weft (- (length weft) 1))\n\t   (list-ref weft 0)))))\n\n(define (_kernel->weft-thread kernel row fabric-width fabric-height selvedge-size)\n  (cond\n   ((>= row fabric-height) \'())\n   (else\n\t(let ((direction (modulo (quotient row selvedge-size) 2)))\n\t  (append\n\t   (pattern->thread\n\t\t(pattern-invert\n\t\t (if (zero? direction)\n\t\t\t (pattern-extend\n\t\t\t  0 (+ fabric-width 1) (kernel-row kernel row))\n\t\t\t (reverse\n\t\t\t  (pattern-extend\n\t\t\t   -1 fabric-width (kernel-row kernel row)))))\n\t\t\"?\")\t\t\n\t   (make-selvedge direction selvedge-size)\n\t   (_kernel->weft-thread\n\t\tkernel\n\t\t(+ row selvedge-size)\n\t\tfabric-width fabric-height selvedge-size))))))\n\n(define (kernel->weft-thread kernel row fabric-width fabric-height selvedge-size)\n  (tension-selvedge\n   (_kernel->weft-thread kernel row fabric-width fabric-height selvedge-size)))\n", "flx/scm/primitive.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define (primitive type inner)\n  (list type inner))\n\n(define (primitive-type p) (list-ref p 0))\n(define (primitive-inner p) (list-ref p 1))\n\n(define (primitive-render p gl view-camera camera-pos state tx)\n  ;; dispatch\n  (cond \n   ((eq? (primitive-type p) \'polyprim) \n    (polyprim-render (primitive-inner p) gl view-camera camera-pos state tx))\n   ((eq? (primitive-type p) \'instanceprim) \n    (instanceprim-render (primitive-inner p) gl view-camera camera-pos state tx))\n   ((eq? (primitive-type p) \'locatorprim)\n    ;; locator has no primitive (might want to change this for debugging)\n    0)\n   (else (msg \"unknown primitive\"))))\n", "flx/scm/scenegraph.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2017 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define (scenenode id state primitive children) (list id state primitive children (mat4.identity (mat4.create))))\n(define (scenenode-id p) (list-ref p 0))\n(define (scenenode-state p) (list-ref p 1))\n(define (scenenode-modify-state! p v) (set! p (list-replace p 1 v)))\n(define (scenenode-primitive p)  (list-ref p 2))\n(define (scenenode-children p)  (list-ref p 3))\n(define (scenenode-modify-children p v)  (list-replace p 3 v))\n(define (scenenode-global-tx p) (list-ref p 4))\n(define (scenenode-modify-global-tx! p v) (set! p (list-replace p 4 v)))\n;;(define (scenenode-modify-add-child p child) (list-replace p 3 (cons child (scenenode-children p))))\n\n(define (scenenode-print p)\n  (msg (+ (scenenode-id p) \" \" (state-tx (scenenode-state p)))))\n\n;; order children by id\n(define (scenenode-modify-add-child p child)\n  (define (_ l v)\n    (cond\n     ((null? l) (list v))\n     ((< (scenenode-id  v) (scenenode-id (car l))) (cons v l))\n     (else (cons (car l) (_ (cdr l) v)))))\n  (list-replace p 3 (_ (scenenode-children p) child)))\n\n;; binary search\n(define (scenenode-search-child l id)\n  (define (_ start end)\n    (cond\n     ;; no children\n     ((null? l) #f)\n     (else\n      (let ((mid (trunc (+ start (/ (- end start) 2)))))\n\t(cond\n\t ;; not found\n\t ((< (- end start) 2) #f)\n\t ;; found\n\t ((eq? id (car (list-ref l mid))) (list-ref l mid))\n\t ;; search down\n\t ((> (car (list-ref l mid)) id)\n\t  (_ start mid))\n\t ;; search up\n\t (else\n\t  (_ mid end)))))))\n  (_ 0 (length l)))\n\n(define (scenegraph-find sn id)\n  (cond\n   ((eq? (scenenode-id sn) id) sn)\n   (else \n    (let ((result (scenenode-search-child (scenenode-children sn) id)))\n      (if result result\n\t  (foldl\n\t   (lambda (sn r)\n\t     (if r r (scenegraph-find sn id)))\n\t   #f\n\t   (scenenode-children sn)))))))\n\n(define (scenegraph-remove sn id)\n  (scenenode-modify-children\n   sn\n   (filter (lambda (sn)\n\t     (not (eq? (scenenode-id sn) id)))\n\t   (map\n\t    (lambda (sn)\n\t      (scenegraph-remove sn id))\n\t    (scenenode-children sn)))))\n\n (define (scenegraph-add sn parent-id node)\n  (cond\n   ((eq? (scenenode-id sn) parent-id) \n    (scenenode-modify-add-child sn node))\n   (else \n    (scenenode-modify-children\n     sn\n     (map\n      (lambda (sn)\n\t(scenegraph-add sn parent-id node))\n      (scenenode-children sn))))))\n\n(define (scenegraph-render sn gl view-camera camera-pos tx)\n  (when (not (state-hidden (scenenode-state sn)))\n\t(when (not (zero? (scenenode-primitive sn)))\n\t      (let ((hints (state-hints (scenenode-state sn))))\n\t\t;; hints that affect all types of primitive\n\t\t(if (bitwise-and hints FLX_HINT_NOZWRITE)\n\t\t    (gl.depthMask false)\n\t\t    (gl.depthMask true))\n\t\t(if (bitwise-and hints FLX_HINT_CULL_FACE)\n\t\t    (gl.enable gl.CULL_FACE)\n\t\t    (gl.disable gl.CULL_FACE))\n\t\t(if (bitwise-and hints FLX_HINT_CULL_CCW) \n\t\t    (gl.frontFace gl.CW)\n\t\t    (gl.frontFace gl.CCW))\n\t\t(if (bitwise-and hints FLX_HINT_IGNORE_DEPTH) \n\t\t    (gl.disable gl.DEPTH_TEST)\n\t\t    (gl.enable gl.DEPTH_TEST))\n\t\t(primitive-render \n\t\t (scenenode-primitive sn) gl view-camera camera-pos \n\t\t (scenenode-state sn)\n\t\t tx)))\n\t\n\t(let ((child-tx (mat4.create)))\n\t  ;; pass the heirachical transform down\n\t  (mat4.multiply tx (state-tx (scenenode-state sn)) child-tx)    \n\t  ;; child-tx is actually the local transform for this object\n\t  (scenenode-modify-global-tx! sn child-tx)\n\t  (for-each \n\t   (lambda (child)\n\t     (scenegraph-render child gl view-camera camera-pos child-tx))\n\t   (scenenode-children sn)))))\n\n(define (scenegraph-print sn depth)\n  (scenenode-print sn)\n  (for-each \n   (lambda (child)\n     (scenegraph-print child (+ depth 1)))\n   (scenenode-children sn)))\n", "flx/scm/data.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define unit-cube-vertices\n  (list\n   -0.5  0.5 -0.5   0.5  0.5 -0.5  -0.5 -0.5 -0.5\n    0.5 -0.5 -0.5   0.5  0.5 -0.5  -0.5 -0.5 -0.5\n    0.5  0.5 -0.5   0.5  0.5  0.5   0.5 -0.5 -0.5\n    0.5 -0.5  0.5   0.5  0.5  0.5   0.5 -0.5 -0.5\n   -0.5  0.5  0.5   0.5  0.5  0.5  -0.5  0.5 -0.5\n    0.5  0.5 -0.5   0.5  0.5  0.5  -0.5  0.5 -0.5\n    0.5  0.5  0.5  -0.5  0.5  0.5   0.5 -0.5  0.5\n   -0.5 -0.5  0.5  -0.5  0.5  0.5   0.5 -0.5  0.5\n   -0.5  0.5  0.5  -0.5  0.5 -0.5  -0.5 -0.5  0.5\n   -0.5 -0.5 -0.5  -0.5  0.5 -0.5  -0.5 -0.5  0.5\n   -0.5 -0.5 -0.5   0.5 -0.5 -0.5  -0.5 -0.5  0.5\n    0.5 -0.5  0.5   0.5 -0.5 -0.5  -0.5 -0.5  0.5))\n\n(define unit-cube-normals\n  (list\n    0  0 -1   0  0 -1   0  0 -1\n    0  0 -1   0  0 -1   0  0 -1\n    1  0  0   1  0  0   1  0  0\n    1  0  0   1  0  0   1  0  0\n    0  1  0   0  1  0   0  1  0\n    0  1  0   0  1  0   0  1  0\n    0  0  1   0  0  1   0  0  1\n    0  0  1   0  0  1   0  0  1\n   -1  0  0  -1  0  0  -1  0  0\n   -1  0  0  -1  0  0  -1  0  0\n    0 -1  0   0 -1  0   0 -1  0\n    0 -1  0   0 -1  0   0 -1  0))\n\n(define unit-cube-texcoords\n  (list\n    0  1  0   1  1  0   0  0  0\n    1  0  0   1  1  0   0  0  0\n    0  1  0   1  1  0   0  0  0\n    1  0  0   1  1  0   0  0  0\n    0  1  0   1  1  0   0  0  0\n    1  0  0   1  1  0   0  0  0\n    0  1  0   1  1  0   0  0  0\n    1  0  0   1  1  0   0  0  0\n    0  1  0   1  1  0   0  0  0\n    1  0  0   1  1  0   0  0  0\n    0  1  0   1  1  0   0  0  0\n    1  0  0   1  1  0   0  0  0))\n\n\n(define sphere-vertices (js \"[0.0, 1.0, 0.0, 0.0, 0.866, 0.5, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.866, 0.5, 0.3536, 0.866, 0.3536, 0.0, 1.0, 0.0, 0.3536, 0.866, 0.3536, 0.0, 1.0, -0.0, 0.0, 1.0, -0.0, 0.3536, 0.866, 0.3536, 0.5, 0.866, -0.0, 0.0, 1.0, -0.0, 0.5, 0.866, -0.0, 0.0, 1.0, -0.0, 0.0, 1.0, -0.0, 0.5, 0.866, -0.0, 0.3536, 0.866, -0.3536, 0.0, 1.0, -0.0, 0.3536, 0.866, -0.3536, -0.0, 1.0, -0.0, -0.0, 1.0, -0.0, 0.3536, 0.866, -0.3536, -0.0, 0.866, -0.5, -0.0, 1.0, -0.0, -0.0, 0.866, -0.5, -0.0, 1.0, -0.0, -0.0, 1.0, -0.0, -0.0, 0.866, -0.5, -0.3536, 0.866, -0.3536, -0.0, 1.0, -0.0, -0.3536, 0.866, -0.3536, -0.0, 1.0, 0.0, -0.0, 1.0, 0.0, -0.3536, 0.866, -0.3536, -0.5, 0.866, 0.0, -0.0, 1.0, 0.0, -0.5, 0.866, 0.0, -0.0, 1.0, 0.0, -0.0, 1.0, 0.0, -0.5, 0.866, 0.0, -0.3536, 0.866, 0.3536, -0.0, 1.0, 0.0, -0.3536, 0.866, 0.3536, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, -0.3536, 0.866, 0.3536, 0.0, 0.866, 0.5, 0.0, 0.866, 0.5, 0.0, 0.5, 0.866, 0.3536, 0.866, 0.3536, 0.3536, 0.866, 0.3536, 0.0, 0.5, 0.866, 0.6124, 0.5, 0.6124, 0.3536, 0.866, 0.3536, 0.6124, 0.5, 0.6124, 0.5, 0.866, -0.0, 0.5, 0.866, -0.0, 0.6124, 0.5, 0.6124, 0.866, 0.5, -0.0, 0.5, 0.866, -0.0, 0.866, 0.5, -0.0, 0.3536, 0.866, -0.3536, 0.3536, 0.866, -0.3536, 0.866, 0.5, -0.0, 0.6124, 0.5, -0.6124, 0.3536, 0.866, -0.3536, 0.6124, 0.5, -0.6124, -0.0, 0.866, -0.5, -0.0, 0.866, -0.5, 0.6124, 0.5, -0.6124, -0.0, 0.5, -0.866, -0.0, 0.866, -0.5, -0.0, 0.5, -0.866, -0.3536, 0.866, -0.3536, -0.3536, 0.866, -0.3536, -0.0, 0.5, -0.866, -0.6124, 0.5, -0.6124, -0.3536, 0.866, -0.3536, -0.6124, 0.5, -0.6124, -0.5, 0.866, 0.0, -0.5, 0.866, 0.0, -0.6124, 0.5, -0.6124, -0.866, 0.5, 0.0, -0.5, 0.866, 0.0, -0.866, 0.5, 0.0, -0.3536, 0.866, 0.3536, -0.3536, 0.866, 0.3536, -0.866, 0.5, 0.0, -0.6124, 0.5, 0.6124, -0.3536, 0.866, 0.3536, -0.6124, 0.5, 0.6124, 0.0, 0.866, 0.5, 0.0, 0.866, 0.5, -0.6124, 0.5, 0.6124, 0.0, 0.5, 0.866, 0.0, 0.5, 0.866, 0.0, -0.0, 1.0, 0.6124, 0.5, 0.6124, 0.6124, 0.5, 0.6124, 0.0, -0.0, 1.0, 0.7071, -0.0, 0.7071, 0.6124, 0.5, 0.6124, 0.7071, -0.0, 0.7071, 0.866, 0.5, -0.0, 0.866, 0.5, -0.0, 0.7071, -0.0, 0.7071, 1.0, -0.0, -0.0, 0.866, 0.5, -0.0, 1.0, -0.0, -0.0, 0.6124, 0.5, -0.6124, 0.6124, 0.5, -0.6124, 1.0, -0.0, -0.0, 0.7071, -0.0, -0.7071, 0.6124, 0.5, -0.6124, 0.7071, -0.0, -0.7071, -0.0, 0.5, -0.866, -0.0, 0.5, -0.866, 0.7071, -0.0, -0.7071, -0.0, -0.0, -1.0, -0.0, 0.5, -0.866, -0.0, -0.0, -1.0, -0.6124, 0.5, -0.6124, -0.6124, 0.5, -0.6124, -0.0, -0.0, -1.0, -0.7071, -0.0, -0.7071, -0.6124, 0.5, -0.6124, -0.7071, -0.0, -0.7071, -0.866, 0.5, 0.0, -0.866, 0.5, 0.0, -0.7071, -0.0, -0.7071, -1.0, -0.0, 0.0, -0.866, 0.5, 0.0, -1.0, -0.0, 0.0, -0.6124, 0.5, 0.6124, -0.6124, 0.5, 0.6124, -1.0, -0.0, 0.0, -0.7071, -0.0, 0.7071, -0.6124, 0.5, 0.6124, -0.7071, -0.0, 0.7071, 0.0, 0.5, 0.866, 0.0, 0.5, 0.866, -0.7071, -0.0, 0.7071, 0.0, -0.0, 1.0, 0.0, -0.0, 1.0, 0.0, -0.5, 0.866, 0.7071, -0.0, 0.7071, 0.7071, -0.0, 0.7071, 0.0, -0.5, 0.866, 0.6124, -0.5, 0.6124, 0.7071, -0.0, 0.7071, 0.6124, -0.5, 0.6124, 1.0, -0.0, -0.0, 1.0, -0.0, -0.0, 0.6124, -0.5, 0.6124, 0.866, -0.5, -0.0, 1.0, -0.0, -0.0, 0.866, -0.5, -0.0, 0.7071, -0.0, -0.7071, 0.7071, -0.0, -0.7071, 0.866, -0.5, -0.0, 0.6124, -0.5, -0.6124, 0.7071, -0.0, -0.7071, 0.6124, -0.5, -0.6124, -0.0, -0.0, -1.0, -0.0, -0.0, -1.0, 0.6124, -0.5, -0.6124, -0.0, -0.5, -0.866, -0.0, -0.0, -1.0, -0.0, -0.5, -0.866, -0.7071, -0.0, -0.7071, -0.7071, -0.0, -0.7071, -0.0, -0.5, -0.866, -0.6124, -0.5, -0.6124, -0.7071, -0.0, -0.7071, -0.6124, -0.5, -0.6124, -1.0, -0.0, 0.0, -1.0, -0.0, 0.0, -0.6124, -0.5, -0.6124, -0.866, -0.5, 0.0, -1.0, -0.0, 0.0, -0.866, -0.5, 0.0, -0.7071, -0.0, 0.7071, -0.7071, -0.0, 0.7071, -0.866, -0.5, 0.0, -0.6124, -0.5, 0.6124, -0.7071, -0.0, 0.7071, -0.6124, -0.5, 0.6124, 0.0, -0.0, 1.0, 0.0, -0.0, 1.0, -0.6124, -0.5, 0.6124, 0.0, -0.5, 0.866, 0.0, -0.5, 0.866, 0.0, -0.866, 0.5, 0.6124, -0.5, 0.6124, 0.6124, -0.5, 0.6124, 0.0, -0.866, 0.5, 0.3536, -0.866, 0.3536, 0.6124, -0.5, 0.6124, 0.3536, -0.866, 0.3536, 0.866, -0.5, -0.0, 0.866, -0.5, -0.0, 0.3536, -0.866, 0.3536, 0.5, -0.866, -0.0, 0.866, -0.5, -0.0, 0.5, -0.866, -0.0, 0.6124, -0.5, -0.6124, 0.6124, -0.5, -0.6124, 0.5, -0.866, -0.0, 0.3536, -0.866, -0.3536, 0.6124, -0.5, -0.6124, 0.3536, -0.866, -0.3536, -0.0, -0.5, -0.866, -0.0, -0.5, -0.866, 0.3536, -0.866, -0.3536, -0.0, -0.866, -0.5, -0.0, -0.5, -0.866, -0.0, -0.866, -0.5, -0.6124, -0.5, -0.6124, -0.6124, -0.5, -0.6124, -0.0, -0.866, -0.5, -0.3536, -0.866, -0.3536, -0.6124, -0.5, -0.6124, -0.3536, -0.866, -0.3536, -0.866, -0.5, 0.0, -0.866, -0.5, 0.0, -0.3536, -0.866, -0.3536, -0.5, -0.866, 0.0, -0.866, -0.5, 0.0, -0.5, -0.866, 0.0, -0.6124, -0.5, 0.6124, -0.6124, -0.5, 0.6124, -0.5, -0.866, 0.0, -0.3536, -0.866, 0.3536, -0.6124, -0.5, 0.6124, -0.3536, -0.866, 0.3536, 0.0, -0.5, 0.866, 0.0, -0.5, 0.866, -0.3536, -0.866, 0.3536, 0.0, -0.866, 0.5, 0.0, -0.866, 0.5, -0.0, -1.0, -0.0, 0.3536, -0.866, 0.3536, 0.3536, -0.866, 0.3536, -0.0, -1.0, -0.0, -0.0, -1.0, -0.0, 0.3536, -0.866, 0.3536, -0.0, -1.0, -0.0, 0.5, -0.866, -0.0, 0.5, -0.866, -0.0, -0.0, -1.0, -0.0, -0.0, -1.0, 0.0, 0.5, -0.866, -0.0, -0.0, -1.0, 0.0, 0.3536, -0.866, -0.3536, 0.3536, -0.866, -0.3536, -0.0, -1.0, 0.0, -0.0, -1.0, 0.0, 0.3536, -0.866, -0.3536, -0.0, -1.0, 0.0, -0.0, -0.866, -0.5, -0.0, -0.866, -0.5, -0.0, -1.0, 0.0, 0.0, -1.0, 0.0, -0.0, -0.866, -0.5, 0.0, -1.0, 0.0, -0.3536, -0.866, -0.3536, -0.3536, -0.866, -0.3536, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, -0.3536, -0.866, -0.3536, 0.0, -1.0, 0.0, -0.5, -0.866, 0.0, -0.5, -0.866, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, -0.0, -0.5, -0.866, 0.0, 0.0, -1.0, -0.0, -0.3536, -0.866, 0.3536, -0.3536, -0.866, 0.3536, 0.0, -1.0, -0.0, 0.0, -1.0, -0.0, -0.3536, -0.866, 0.3536, 0.0, -1.0, -0.0, 0.0, -0.866, 0.5, 0.0, -0.866, 0.5, 0.0, -1.0, -0.0, -0.0, -1.0, -0.0]\"))\n(define sphere-normals (js \"[0.0, 1.0, 0.0, 0.0, 0.866, 0.5, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.866, 0.5, 0.3536, 0.866, 0.3536, 0.0, 1.0, 0.0, 0.3536, 0.866, 0.3536, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.3536, 0.866, 0.3536, 0.5, 0.866, -0.0, 0.0, 1.0, 0.0, 0.5, 0.866, -0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.5, 0.866, -0.0, 0.3536, 0.866, -0.3536, 0.0, 1.0, 0.0, 0.3536, 0.866, -0.3536, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.3536, 0.866, -0.3536, -0.0, 0.866, -0.5, 0.0, 1.0, 0.0, -0.0, 0.866, -0.5, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, -0.0, 0.866, -0.5, -0.3536, 0.866, -0.3536, 0.0, 1.0, 0.0, -0.3536, 0.866, -0.3536, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, -0.3536, 0.866, -0.3536, -0.5, 0.866, 0.0, 0.0, 1.0, 0.0, -0.5, 0.866, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, -0.5, 0.866, 0.0, -0.3536, 0.866, 0.3536, 0.0, 1.0, 0.0, -0.3536, 0.866, 0.3536, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, -0.3536, 0.866, 0.3536, 0.0, 0.866, 0.5, 0.0, 0.866, 0.5, 0.0, 0.5, 0.866, 0.3536, 0.866, 0.3536, 0.3536, 0.866, 0.3536, 0.0, 0.5, 0.866, 0.6124, 0.5, 0.6124, 0.3536, 0.866, 0.3536, 0.6124, 0.5, 0.6124, 0.5, 0.866, -0.0, 0.5, 0.866, -0.0, 0.6124, 0.5, 0.6124, 0.866, 0.5, -0.0, 0.5, 0.866, -0.0, 0.866, 0.5, -0.0, 0.3536, 0.866, -0.3536, 0.3536, 0.866, -0.3536, 0.866, 0.5, -0.0, 0.6124, 0.5, -0.6124, 0.3536, 0.866, -0.3536, 0.6124, 0.5, -0.6124, -0.0, 0.866, -0.5, -0.0, 0.866, -0.5, 0.6124, 0.5, -0.6124, -0.0, 0.5, -0.866, -0.0, 0.866, -0.5, -0.0, 0.5, -0.866, -0.3536, 0.866, -0.3536, -0.3536, 0.866, -0.3536, -0.0, 0.5, -0.866, -0.6124, 0.5, -0.6124, -0.3536, 0.866, -0.3536, -0.6124, 0.5, -0.6124, -0.5, 0.866, 0.0, -0.5, 0.866, 0.0, -0.6124, 0.5, -0.6124, -0.866, 0.5, 0.0, -0.5, 0.866, 0.0, -0.866, 0.5, 0.0, -0.3536, 0.866, 0.3536, -0.3536, 0.866, 0.3536, -0.866, 0.5, 0.0, -0.6124, 0.5, 0.6124, -0.3536, 0.866, 0.3536, -0.6124, 0.5, 0.6124, 0.0, 0.866, 0.5, 0.0, 0.866, 0.5, -0.6124, 0.5, 0.6124, 0.0, 0.5, 0.866, 0.0, 0.5, 0.866, 0.0, -0.0, 1.0, 0.6124, 0.5, 0.6124, 0.6124, 0.5, 0.6124, 0.0, -0.0, 1.0, 0.7071, -0.0, 0.7071, 0.6124, 0.5, 0.6124, 0.7071, -0.0, 0.7071, 0.866, 0.5, -0.0, 0.866, 0.5, -0.0, 0.7071, -0.0, 0.7071, 1.0, -0.0, -0.0, 0.866, 0.5, -0.0, 1.0, -0.0, -0.0, 0.6124, 0.5, -0.6124, 0.6124, 0.5, -0.6124, 1.0, -0.0, -0.0, 0.7071, -0.0, -0.7071, 0.6124, 0.5, -0.6124, 0.7071, -0.0, -0.7071, -0.0, 0.5, -0.866, -0.0, 0.5, -0.866, 0.7071, -0.0, -0.7071, -0.0, -0.0, -1.0, -0.0, 0.5, -0.866, -0.0, -0.0, -1.0, -0.6124, 0.5, -0.6124, -0.6124, 0.5, -0.6124, -0.0, -0.0, -1.0, -0.7071, -0.0, -0.7071, -0.6124, 0.5, -0.6124, -0.7071, -0.0, -0.7071, -0.866, 0.5, 0.0, -0.866, 0.5, 0.0, -0.7071, -0.0, -0.7071, -1.0, -0.0, 0.0, -0.866, 0.5, 0.0, -1.0, -0.0, 0.0, -0.6124, 0.5, 0.6124, -0.6124, 0.5, 0.6124, -1.0, -0.0, 0.0, -0.7071, -0.0, 0.7071, -0.6124, 0.5, 0.6124, -0.7071, -0.0, 0.7071, 0.0, 0.5, 0.866, 0.0, 0.5, 0.866, -0.7071, -0.0, 0.7071, 0.0, -0.0, 1.0, 0.0, -0.0, 1.0, 0.0, -0.5, 0.866, 0.7071, -0.0, 0.7071, 0.7071, -0.0, 0.7071, 0.0, -0.5, 0.866, 0.6124, -0.5, 0.6124, 0.7071, -0.0, 0.7071, 0.6124, -0.5, 0.6124, 1.0, -0.0, -0.0, 1.0, -0.0, -0.0, 0.6124, -0.5, 0.6124, 0.866, -0.5, -0.0, 1.0, -0.0, -0.0, 0.866, -0.5, -0.0, 0.7071, -0.0, -0.7071, 0.7071, -0.0, -0.7071, 0.866, -0.5, -0.0, 0.6124, -0.5, -0.6124, 0.7071, -0.0, -0.7071, 0.6124, -0.5, -0.6124, -0.0, -0.0, -1.0, -0.0, -0.0, -1.0, 0.6124, -0.5, -0.6124, -0.0, -0.5, -0.866, -0.0, -0.0, -1.0, -0.0, -0.5, -0.866, -0.7071, -0.0, -0.7071, -0.7071, -0.0, -0.7071, -0.0, -0.5, -0.866, -0.6124, -0.5, -0.6124, -0.7071, -0.0, -0.7071, -0.6124, -0.5, -0.6124, -1.0, -0.0, 0.0, -1.0, -0.0, 0.0, -0.6124, -0.5, -0.6124, -0.866, -0.5, 0.0, -1.0, -0.0, 0.0, -0.866, -0.5, 0.0, -0.7071, -0.0, 0.7071, -0.7071, -0.0, 0.7071, -0.866, -0.5, 0.0, -0.6124, -0.5, 0.6124, -0.7071, -0.0, 0.7071, -0.6124, -0.5, 0.6124, 0.0, -0.0, 1.0, 0.0, -0.0, 1.0, -0.6124, -0.5, 0.6124, 0.0, -0.5, 0.866, 0.0, -0.5, 0.866, 0.0, -0.866, 0.5, 0.6124, -0.5, 0.6124, 0.6124, -0.5, 0.6124, 0.0, -0.866, 0.5, 0.3536, -0.866, 0.3536, 0.6124, -0.5, 0.6124, 0.3536, -0.866, 0.3536, 0.866, -0.5, -0.0, 0.866, -0.5, -0.0, 0.3536, -0.866, 0.3536, 0.5, -0.866, -0.0, 0.866, -0.5, -0.0, 0.5, -0.866, -0.0, 0.6124, -0.5, -0.6124, 0.6124, -0.5, -0.6124, 0.5, -0.866, -0.0, 0.3536, -0.866, -0.3536, 0.6124, -0.5, -0.6124, 0.3536, -0.866, -0.3536, -0.0, -0.5, -0.866, -0.0, -0.5, -0.866, 0.3536, -0.866, -0.3536, -0.0, -0.866, -0.5, -0.0, -0.5, -0.866, -0.0, -0.866, -0.5, -0.6124, -0.5, -0.6124, -0.6124, -0.5, -0.6124, -0.0, -0.866, -0.5, -0.3536, -0.866, -0.3536, -0.6124, -0.5, -0.6124, -0.3536, -0.866, -0.3536, -0.866, -0.5, 0.0, -0.866, -0.5, 0.0, -0.3536, -0.866, -0.3536, -0.5, -0.866, 0.0, -0.866, -0.5, 0.0, -0.5, -0.866, 0.0, -0.6124, -0.5, 0.6124, -0.6124, -0.5, 0.6124, -0.5, -0.866, 0.0, -0.3536, -0.866, 0.3536, -0.6124, -0.5, 0.6124, -0.3536, -0.866, 0.3536, 0.0, -0.5, 0.866, 0.0, -0.5, 0.866, -0.3536, -0.866, 0.3536, 0.0, -0.866, 0.5, 0.0, -0.866, 0.5, 0.0, -1.0, -0.0, 0.3536, -0.866, 0.3536, 0.3536, -0.866, 0.3536, 0.0, -1.0, -0.0, -0.0, -1.0, -0.0, 0.3536, -0.866, 0.3536, -0.0, -1.0, -0.0, 0.5, -0.866, -0.0, 0.5, -0.866, -0.0, -0.0, -1.0, -0.0, -0.0, -1.0, 0.0, 0.5, -0.866, -0.0, -0.0, -1.0, 0.0, 0.3536, -0.866, -0.3536, 0.3536, -0.866, -0.3536, -0.0, -1.0, 0.0, -0.0, -1.0, 0.0, 0.3536, -0.866, -0.3536, -0.0, -1.0, 0.0, -0.0, -0.866, -0.5, -0.0, -0.866, -0.5, -0.0, -1.0, 0.0, 0.0, -1.0, 0.0, -0.0, -0.866, -0.5, 0.0, -1.0, 0.0, -0.3536, -0.866, -0.3536, -0.3536, -0.866, -0.3536, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, -0.3536, -0.866, -0.3536, 0.0, -1.0, 0.0, -0.5, -0.866, 0.0, -0.5, -0.866, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, -0.0, -0.5, -0.866, 0.0, 0.0, -1.0, -0.0, -0.3536, -0.866, 0.3536, -0.3536, -0.866, 0.3536, 0.0, -1.0, -0.0, 0.0, -1.0, -0.0, -0.3536, -0.866, 0.3536, 0.0, -1.0, -0.0, 0.0, -0.866, 0.5, 0.0, -0.866, 0.5, 0.0, -1.0, -0.0, -0.0, -1.0, -0.0 ]\"))\n(define sphere-texcoords (js \"[0.0, 0.0, 0.0, 0.0, 0.1667, 0.0, 0.125, 0.0, 0.0, 0.125, 0.0, 0.0, 0.0, 0.1667, 0.0, 0.125, 0.1667, 0.0, 0.125, 0.0, 0.0, 0.125, 0.1667, 0.0, 0.25, 0.0, 0.0, 0.25, 0.0, 0.0, 0.125, 0.1667, 0.0, 0.25, 0.1667, 0.0, 0.25, 0.0, 0.0, 0.25, 0.1667, 0.0, 0.375, 0.0, 0.0, 0.375, 0.0, 0.0, 0.25, 0.1667, 0.0, 0.375, 0.1667, 0.0, 0.375, 0.0, 0.0, 0.375, 0.1667, 0.0, 0.5, 0.0, 0.0, 0.5, 0.0, 0.0, 0.375, 0.1667, 0.0, 0.5, 0.1667, 0.0, 0.5, 0.0, 0.0, 0.5, 0.1667, 0.0, 0.625, 0.0, 0.0, 0.625, 0.0, 0.0, 0.5, 0.1667, 0.0, 0.625, 0.1667, 0.0, 0.625, 0.0, 0.0, 0.625, 0.1667, 0.0, 0.75, 0.0, 0.0, 0.75, 0.0, 0.0, 0.625, 0.1667, 0.0, 0.75, 0.1667, 0.0, 0.75, 0.0, 0.0, 0.75, 0.1667, 0.0, 0.875, 0.0, 0.0, 0.875, 0.0, 0.0, 0.75, 0.1667, 0.0, 0.875, 0.1667, 0.0, 0.875, 0.0, 0.0, 0.875, 0.1667, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.875, 0.1667, 0.0, 1.0, 0.1667, 0.0, 0.0, 0.1667, 0.0, 0.0, 0.3333, 0.0, 0.125, 0.1667, 0.0, 0.125, 0.1667, 0.0, 0.0, 0.3333, 0.0, 0.125, 0.3333, 0.0, 0.125, 0.1667, 0.0, 0.125, 0.3333, 0.0, 0.25, 0.1667, 0.0, 0.25, 0.1667, 0.0, 0.125, 0.3333, 0.0, 0.25, 0.3333, 0.0, 0.25, 0.1667, 0.0, 0.25, 0.3333, 0.0, 0.375, 0.1667, 0.0, 0.375, 0.1667, 0.0, 0.25, 0.3333, 0.0, 0.375, 0.3333, 0.0, 0.375, 0.1667, 0.0, 0.375, 0.3333, 0.0, 0.5, 0.1667, 0.0, 0.5, 0.1667, 0.0, 0.375, 0.3333, 0.0, 0.5, 0.3333, 0.0, 0.5, 0.1667, 0.0, 0.5, 0.3333, 0.0, 0.625, 0.1667, 0.0, 0.625, 0.1667, 0.0, 0.5, 0.3333, 0.0, 0.625, 0.3333, 0.0, 0.625, 0.1667, 0.0, 0.625, 0.3333, 0.0, 0.75, 0.1667, 0.0, 0.75, 0.1667, 0.0, 0.625, 0.3333, 0.0, 0.75, 0.3333, 0.0, 0.75, 0.1667, 0.0, 0.75, 0.3333, 0.0, 0.875, 0.1667, 0.0, 0.875, 0.1667, 0.0, 0.75, 0.3333, 0.0, 0.875, 0.3333, 0.0, 0.875, 0.1667, 0.0, 0.875, 0.3333, 0.0, 1.0, 0.1667, 0.0, 1.0, 0.1667, 0.0, 0.875, 0.3333, 0.0, 1.0, 0.3333, 0.0, 0.0, 0.3333, 0.0, 0.0, 0.5, 0.0, 0.125, 0.3333, 0.0, 0.125, 0.3333, 0.0, 0.0, 0.5, 0.0, 0.125, 0.5, 0.0, 0.125, 0.3333, 0.0, 0.125, 0.5, 0.0, 0.25, 0.3333, 0.0, 0.25, 0.3333, 0.0, 0.125, 0.5, 0.0, 0.25, 0.5, 0.0, 0.25, 0.3333, 0.0, 0.25, 0.5, 0.0, 0.375, 0.3333, 0.0, 0.375, 0.3333, 0.0, 0.25, 0.5, 0.0, 0.375, 0.5, 0.0, 0.375, 0.3333, 0.0, 0.375, 0.5, 0.0, 0.5, 0.3333, 0.0, 0.5, 0.3333, 0.0, 0.375, 0.5, 0.0, 0.5, 0.5, 0.0, 0.5, 0.3333, 0.0, 0.5, 0.5, 0.0, 0.625, 0.3333, 0.0, 0.625, 0.3333, 0.0, 0.5, 0.5, 0.0, 0.625, 0.5, 0.0, 0.625, 0.3333, 0.0, 0.625, 0.5, 0.0, 0.75, 0.3333, 0.0, 0.75, 0.3333, 0.0, 0.625, 0.5, 0.0, 0.75, 0.5, 0.0, 0.75, 0.3333, 0.0, 0.75, 0.5, 0.0, 0.875, 0.3333, 0.0, 0.875, 0.3333, 0.0, 0.75, 0.5, 0.0, 0.875, 0.5, 0.0, 0.875, 0.3333, 0.0, 0.875, 0.5, 0.0, 1.0, 0.3333, 0.0, 1.0, 0.3333, 0.0, 0.875, 0.5, 0.0, 1.0, 0.5, 0.0, 0.0, 0.5, 0.0, 0.0, 0.6667, 0.0, 0.125, 0.5, 0.0, 0.125, 0.5, 0.0, 0.0, 0.6667, 0.0, 0.125, 0.6667, 0.0, 0.125, 0.5, 0.0, 0.125, 0.6667, 0.0, 0.25, 0.5, 0.0, 0.25, 0.5, 0.0, 0.125, 0.6667, 0.0, 0.25, 0.6667, 0.0, 0.25, 0.5, 0.0, 0.25, 0.6667, 0.0, 0.375, 0.5, 0.0, 0.375, 0.5, 0.0, 0.25, 0.6667, 0.0, 0.375, 0.6667, 0.0, 0.375, 0.5, 0.0, 0.375, 0.6667, 0.0, 0.5, 0.5, 0.0, 0.5, 0.5, 0.0, 0.375, 0.6667, 0.0, 0.5, 0.6667, 0.0, 0.5, 0.5, 0.0, 0.5, 0.6667, 0.0, 0.625, 0.5, 0.0, 0.625, 0.5, 0.0, 0.5, 0.6667, 0.0, 0.625, 0.6667, 0.0, 0.625, 0.5, 0.0, 0.625, 0.6667, 0.0, 0.75, 0.5, 0.0, 0.75, 0.5, 0.0, 0.625, 0.6667, 0.0, 0.75, 0.6667, 0.0, 0.75, 0.5, 0.0, 0.75, 0.6667, 0.0, 0.875, 0.5, 0.0, 0.875, 0.5, 0.0, 0.75, 0.6667, 0.0, 0.875, 0.6667, 0.0, 0.875, 0.5, 0.0, 0.875, 0.6667, 0.0, 1.0, 0.5, 0.0, 1.0, 0.5, 0.0, 0.875, 0.6667, 0.0, 1.0, 0.6667, 0.0, 0.0, 0.6667, 0.0, 0.0, 0.8333, 0.0, 0.125, 0.6667, 0.0, 0.125, 0.6667, 0.0, 0.0, 0.8333, 0.0, 0.125, 0.8333, 0.0, 0.125, 0.6667, 0.0, 0.125, 0.8333, 0.0, 0.25, 0.6667, 0.0, 0.25, 0.6667, 0.0, 0.125, 0.8333, 0.0, 0.25, 0.8333, 0.0, 0.25, 0.6667, 0.0, 0.25, 0.8333, 0.0, 0.375, 0.6667, 0.0, 0.375, 0.6667, 0.0, 0.25, 0.8333, 0.0, 0.375, 0.8333, 0.0, 0.375, 0.6667, 0.0, 0.375, 0.8333, 0.0, 0.5, 0.6667, 0.0, 0.5, 0.6667, 0.0, 0.375, 0.8333, 0.0, 0.5, 0.8333, 0.0, 0.5, 0.6667, 0.0, 0.5, 0.8333, 0.0, 0.625, 0.6667, 0.0, 0.625, 0.6667, 0.0, 0.5, 0.8333, 0.0, 0.625, 0.8333, 0.0, 0.625, 0.6667, 0.0, 0.625, 0.8333, 0.0, 0.75, 0.6667, 0.0, 0.75, 0.6667, 0.0, 0.625, 0.8333, 0.0, 0.75, 0.8333, 0.0, 0.75, 0.6667, 0.0, 0.75, 0.8333, 0.0, 0.875, 0.6667, 0.0, 0.875, 0.6667, 0.0, 0.75, 0.8333, 0.0, 0.875, 0.8333, 0.0, 0.875, 0.6667, 0.0, 0.875, 0.8333, 0.0, 1.0, 0.6667, 0.0, 1.0, 0.6667, 0.0, 0.875, 0.8333, 0.0, 1.0, 0.8333, 0.0, 0.0, 0.8333, 0.0, 0.0, 1.0, 0.0, 0.125, 0.8333, 0.0, 0.125, 0.8333, 0.0, 0.0, 1.0, 0.0, 0.125, 1.0, 0.0, 0.125, 0.8333, 0.0, 0.125, 1.0, 0.0, 0.25, 0.8333, 0.0, 0.25, 0.8333, 0.0, 0.125, 1.0, 0.0, 0.25, 1.0, 0.0, 0.25, 0.8333, 0.0, 0.25, 1.0, 0.0, 0.375, 0.8333, 0.0, 0.375, 0.8333, 0.0, 0.25, 1.0, 0.0, 0.375, 1.0, 0.0, 0.375, 0.8333, 0.0, 0.375, 1.0, 0.0, 0.5, 0.8333, 0.0, 0.5, 0.8333, 0.0, 0.375, 1.0, 0.0, 0.5, 1.0, 0.0, 0.5, 0.8333, 0.0, 0.5, 1.0, 0.0, 0.625, 0.8333, 0.0, 0.625, 0.8333, 0.0, 0.5, 1.0, 0.0, 0.625, 1.0, 0.0, 0.625, 0.8333, 0.0, 0.625, 1.0, 0.0, 0.75, 0.8333, 0.0, 0.75, 0.8333, 0.0, 0.625, 1.0, 0.0, 0.75, 1.0, 0.0, 0.75, 0.8333, 0.0, 0.75, 1.0, 0.0, 0.875, 0.8333, 0.0, 0.875, 0.8333, 0.0, 0.75, 1.0, 0.0, 0.875, 1.0, 0.0, 0.875, 0.8333, 0.0, 0.875, 1.0, 0.0, 1.0, 0.8333, 0.0, 1.0, 0.8333, 0.0, 0.875, 1.0, 0.0, 1.0, 1.0, 0.0]\"))\n(define torus-vertices (js \"[0.7, 0.0, 0.0, 0.495, 0.495, 0.0, 0.4243, 0.4243, 0.1732, 0.7, 0.0, 0.0, 0.4243, 0.4243, 0.1732, 0.6, 0.0, 0.1732, 0.6, 0.0, 0.1732, 0.4243, 0.4243, 0.1732, 0.2828, 0.2828, 0.1732, 0.6, 0.0, 0.1732, 0.2828, 0.2828, 0.1732, 0.4, 0.0, 0.1732, 0.4, 0.0, 0.1732, 0.2828, 0.2828, 0.1732, 0.2121, 0.2121, -0.0, 0.4, 0.0, 0.1732, 0.2121, 0.2121, -0.0, 0.3, 0.0, -0.0, 0.3, 0.0, -0.0, 0.2121, 0.2121, -0.0, 0.2828, 0.2828, -0.1732, 0.3, 0.0, -0.0, 0.2828, 0.2828, -0.1732, 0.4, 0.0, -0.1732, 0.4, 0.0, -0.1732, 0.2828, 0.2828, -0.1732, 0.4243, 0.4243, -0.1732, 0.4, 0.0, -0.1732, 0.4243, 0.4243, -0.1732, 0.6, 0.0, -0.1732, 0.6, 0.0, -0.1732, 0.4243, 0.4243, -0.1732, 0.495, 0.495, 0.0, 0.6, 0.0, -0.1732, 0.495, 0.495, 0.0, 0.7, 0.0, 0.0, 0.495, 0.495, 0.0, -0.0, 0.7, 0.0, -0.0, 0.6, 0.1732, 0.495, 0.495, 0.0, -0.0, 0.6, 0.1732, 0.4243, 0.4243, 0.1732, 0.4243, 0.4243, 0.1732, -0.0, 0.6, 0.1732, -0.0, 0.4, 0.1732, 0.4243, 0.4243, 0.1732, -0.0, 0.4, 0.1732, 0.2828, 0.2828, 0.1732, 0.2828, 0.2828, 0.1732, -0.0, 0.4, 0.1732, -0.0, 0.3, -0.0, 0.2828, 0.2828, 0.1732, -0.0, 0.3, -0.0, 0.2121, 0.2121, -0.0, 0.2121, 0.2121, -0.0, -0.0, 0.3, -0.0, -0.0, 0.4, -0.1732, 0.2121, 0.2121, -0.0, -0.0, 0.4, -0.1732, 0.2828, 0.2828, -0.1732, 0.2828, 0.2828, -0.1732, -0.0, 0.4, -0.1732, -0.0, 0.6, -0.1732, 0.2828, 0.2828, -0.1732, -0.0, 0.6, -0.1732, 0.4243, 0.4243, -0.1732, 0.4243, 0.4243, -0.1732, -0.0, 0.6, -0.1732, -0.0, 0.7, 0.0, 0.4243, 0.4243, -0.1732, -0.0, 0.7, 0.0, 0.495, 0.495, 0.0, -0.0, 0.7, 0.0, -0.495, 0.495, 0.0, -0.4243, 0.4243, 0.1732, -0.0, 0.7, 0.0, -0.4243, 0.4243, 0.1732, -0.0, 0.6, 0.1732, -0.0, 0.6, 0.1732, -0.4243, 0.4243, 0.1732, -0.2828, 0.2828, 0.1732, -0.0, 0.6, 0.1732, -0.2828, 0.2828, 0.1732, -0.0, 0.4, 0.1732, -0.0, 0.4, 0.1732, -0.2828, 0.2828, 0.1732, -0.2121, 0.2121, -0.0, -0.0, 0.4, 0.1732, -0.2121, 0.2121, -0.0, -0.0, 0.3, -0.0, -0.0, 0.3, -0.0, -0.2121, 0.2121, -0.0, -0.2828, 0.2828, -0.1732, -0.0, 0.3, -0.0, -0.2828, 0.2828, -0.1732, -0.0, 0.4, -0.1732, -0.0, 0.4, -0.1732, -0.2828, 0.2828, -0.1732, -0.4243, 0.4243, -0.1732, -0.0, 0.4, -0.1732, -0.4243, 0.4243, -0.1732, -0.0, 0.6, -0.1732, -0.0, 0.6, -0.1732, -0.4243, 0.4243, -0.1732, -0.495, 0.495, 0.0, -0.0, 0.6, -0.1732, -0.495, 0.495, 0.0, -0.0, 0.7, 0.0, -0.495, 0.495, 0.0, -0.7, -0.0, 0.0, -0.6, -0.0, 0.1732, -0.495, 0.495, 0.0, -0.6, -0.0, 0.1732, -0.4243, 0.4243, 0.1732, -0.4243, 0.4243, 0.1732, -0.6, -0.0, 0.1732, -0.4, -0.0, 0.1732, -0.4243, 0.4243, 0.1732, -0.4, -0.0, 0.1732, -0.2828, 0.2828, 0.1732, -0.2828, 0.2828, 0.1732, -0.4, -0.0, 0.1732, -0.3, -0.0, -0.0, -0.2828, 0.2828, 0.1732, -0.3, -0.0, -0.0, -0.2121, 0.2121, -0.0, -0.2121, 0.2121, -0.0, -0.3, -0.0, -0.0, -0.4, -0.0, -0.1732, -0.2121, 0.2121, -0.0, -0.4, -0.0, -0.1732, -0.2828, 0.2828, -0.1732, -0.2828, 0.2828, -0.1732, -0.4, -0.0, -0.1732, -0.6, -0.0, -0.1732, -0.2828, 0.2828, -0.1732, -0.6, -0.0, -0.1732, -0.4243, 0.4243, -0.1732, -0.4243, 0.4243, -0.1732, -0.6, -0.0, -0.1732, -0.7, -0.0, 0.0, -0.4243, 0.4243, -0.1732, -0.7, -0.0, 0.0, -0.495, 0.495, 0.0, -0.7, -0.0, 0.0, -0.495, -0.495, 0.0, -0.4243, -0.4243, 0.1732, -0.7, -0.0, 0.0, -0.4243, -0.4243, 0.1732, -0.6, -0.0, 0.1732, -0.6, -0.0, 0.1732, -0.4243, -0.4243, 0.1732, -0.2828, -0.2828, 0.1732, -0.6, -0.0, 0.1732, -0.2828, -0.2828, 0.1732, -0.4, -0.0, 0.1732, -0.4, -0.0, 0.1732, -0.2828, -0.2828, 0.1732, -0.2121, -0.2121, -0.0, -0.4, -0.0, 0.1732, -0.2121, -0.2121, -0.0, -0.3, -0.0, -0.0, -0.3, -0.0, -0.0, -0.2121, -0.2121, -0.0, -0.2828, -0.2828, -0.1732, -0.3, -0.0, -0.0, -0.2828, -0.2828, -0.1732, -0.4, -0.0, -0.1732, -0.4, -0.0, -0.1732, -0.2828, -0.2828, -0.1732, -0.4243, -0.4243, -0.1732, -0.4, -0.0, -0.1732, -0.4243, -0.4243, -0.1732, -0.6, -0.0, -0.1732, -0.6, -0.0, -0.1732, -0.4243, -0.4243, -0.1732, -0.495, -0.495, 0.0, -0.6, -0.0, -0.1732, -0.495, -0.495, 0.0, -0.7, -0.0, 0.0, -0.495, -0.495, 0.0, 0.0, -0.7, 0.0, 0.0, -0.6, 0.1732, -0.495, -0.495, 0.0, 0.0, -0.6, 0.1732, -0.4243, -0.4243, 0.1732, -0.4243, -0.4243, 0.1732, 0.0, -0.6, 0.1732, 0.0, -0.4, 0.1732, -0.4243, -0.4243, 0.1732, 0.0, -0.4, 0.1732, -0.2828, -0.2828, 0.1732, -0.2828, -0.2828, 0.1732, 0.0, -0.4, 0.1732, 0.0, -0.3, -0.0, -0.2828, -0.2828, 0.1732, 0.0, -0.3, -0.0, -0.2121, -0.2121, -0.0, -0.2121, -0.2121, -0.0, 0.0, -0.3, -0.0, 0.0, -0.4, -0.1732, -0.2121, -0.2121, -0.0, 0.0, -0.4, -0.1732, -0.2828, -0.2828, -0.1732, -0.2828, -0.2828, -0.1732, 0.0, -0.4, -0.1732, 0.0, -0.6, -0.1732, -0.2828, -0.2828, -0.1732, 0.0, -0.6, -0.1732, -0.4243, -0.4243, -0.1732, -0.4243, -0.4243, -0.1732, 0.0, -0.6, -0.1732, 0.0, -0.7, 0.0, -0.4243, -0.4243, -0.1732, 0.0, -0.7, 0.0, -0.495, -0.495, 0.0, 0.0, -0.7, 0.0, 0.495, -0.495, 0.0, 0.4243, -0.4243, 0.1732, 0.0, -0.7, 0.0, 0.4243, -0.4243, 0.1732, 0.0, -0.6, 0.1732, 0.0, -0.6, 0.1732, 0.4243, -0.4243, 0.1732, 0.2828, -0.2828, 0.1732, 0.0, -0.6, 0.1732, 0.2828, -0.2828, 0.1732, 0.0, -0.4, 0.1732, 0.0, -0.4, 0.1732, 0.2828, -0.2828, 0.1732, 0.2121, -0.2121, -0.0, 0.0, -0.4, 0.1732, 0.2121, -0.2121, -0.0, 0.0, -0.3, -0.0, 0.0, -0.3, -0.0, 0.2121, -0.2121, -0.0, 0.2828, -0.2828, -0.1732, 0.0, -0.3, -0.0, 0.2828, -0.2828, -0.1732, 0.0, -0.4, -0.1732, 0.0, -0.4, -0.1732, 0.2828, -0.2828, -0.1732, 0.4243, -0.4243, -0.1732, 0.0, -0.4, -0.1732, 0.4243, -0.4243, -0.1732, 0.0, -0.6, -0.1732, 0.0, -0.6, -0.1732, 0.4243, -0.4243, -0.1732, 0.495, -0.495, 0.0, 0.0, -0.6, -0.1732, 0.495, -0.495, 0.0, 0.0, -0.7, 0.0, 0.495, -0.495, 0.0, 0.7, 0.0, 0.0, 0.6, 0.0, 0.1732, 0.495, -0.495, 0.0, 0.6, 0.0, 0.1732, 0.4243, -0.4243, 0.1732, 0.4243, -0.4243, 0.1732, 0.6, 0.0, 0.1732, 0.4, 0.0, 0.1732, 0.4243, -0.4243, 0.1732, 0.4, 0.0, 0.1732, 0.2828, -0.2828, 0.1732, 0.2828, -0.2828, 0.1732, 0.4, 0.0, 0.1732, 0.3, 0.0, -0.0, 0.2828, -0.2828, 0.1732, 0.3, 0.0, -0.0, 0.2121, -0.2121, -0.0, 0.2121, -0.2121, -0.0, 0.3, 0.0, -0.0, 0.4, 0.0, -0.1732, 0.2121, -0.2121, -0.0, 0.4, 0.0, -0.1732, 0.2828, -0.2828, -0.1732, 0.2828, -0.2828, -0.1732, 0.4, 0.0, -0.1732, 0.6, 0.0, -0.1732, 0.2828, -0.2828, -0.1732, 0.6, 0.0, -0.1732, 0.4243, -0.4243, -0.1732, 0.4243, -0.4243, -0.1732, 0.6, 0.0, -0.1732, 0.7, 0.0, 0.0, 0.4243, -0.4243, -0.1732, 0.7, 0.0, 0.0, 0.495, -0.495, 0.0]\"))\n(define torus-normals (js \"[1.0, 0.0, 0.0, 0.7071, 0.7071, 0.0, 0.3536, 0.3536, 0.866, 1.0, 0.0, 0.0, 0.3536, 0.3536, 0.866, 0.5, 0.0, 0.866, 0.5, 0.0, 0.866, 0.3536, 0.3536, 0.866, -0.3536, -0.3536, 0.866, 0.5, 0.0, 0.866, -0.3536, -0.3536, 0.866, -0.5, -0.0, 0.866, -0.5, -0.0, 0.866, -0.3536, -0.3536, 0.866, -0.7071, -0.7071, -0.0, -0.5, -0.0, 0.866, -0.7071, -0.7071, -0.0, -1.0, -0.0, -0.0, -1.0, -0.0, -0.0, -0.7071, -0.7071, -0.0, -0.3536, -0.3536, -0.866, -1.0, -0.0, -0.0, -0.3536, -0.3536, -0.866, -0.5, -0.0, -0.866, -0.5, -0.0, -0.866, -0.3536, -0.3536, -0.866, 0.3536, 0.3536, -0.866, -0.5, -0.0, -0.866, 0.3536, 0.3536, -0.866, 0.5, 0.0, -0.866, 0.5, 0.0, -0.866, 0.3536, 0.3536, -0.866, 0.7071, 0.7071, 0.0, 0.5, 0.0, -0.866, 0.7071, 0.7071, 0.0, 1.0, 0.0, 0.0, 0.7071, 0.7071, 0.0, -0.0, 1.0, 0.0, -0.0, 0.5, 0.866, 0.7071, 0.7071, 0.0, -0.0, 0.5, 0.866, 0.3536, 0.3536, 0.866, 0.3536, 0.3536, 0.866, -0.0, 0.5, 0.866, 0.0, -0.5, 0.866, 0.3536, 0.3536, 0.866, 0.0, -0.5, 0.866, -0.3536, -0.3536, 0.866, -0.3536, -0.3536, 0.866, 0.0, -0.5, 0.866, 0.0, -1.0, -0.0, -0.3536, -0.3536, 0.866, 0.0, -1.0, -0.0, -0.7071, -0.7071, -0.0, -0.7071, -0.7071, -0.0, 0.0, -1.0, -0.0, 0.0, -0.5, -0.866, -0.7071, -0.7071, -0.0, 0.0, -0.5, -0.866, -0.3536, -0.3536, -0.866, -0.3536, -0.3536, -0.866, 0.0, -0.5, -0.866, -0.0, 0.5, -0.866, -0.3536, -0.3536, -0.866, -0.0, 0.5, -0.866, 0.3536, 0.3536, -0.866, 0.3536, 0.3536, -0.866, -0.0, 0.5, -0.866, -0.0, 1.0, 0.0, 0.3536, 0.3536, -0.866, -0.0, 1.0, 0.0, 0.7071, 0.7071, 0.0, -0.0, 1.0, 0.0, -0.7071, 0.7071, 0.0, -0.3536, 0.3536, 0.866, -0.0, 1.0, 0.0, -0.3536, 0.3536, 0.866, -0.0, 0.5, 0.866, -0.0, 0.5, 0.866, -0.3536, 0.3536, 0.866, 0.3536, -0.3536, 0.866, -0.0, 0.5, 0.866, 0.3536, -0.3536, 0.866, 0.0, -0.5, 0.866, 0.0, -0.5, 0.866, 0.3536, -0.3536, 0.866, 0.7071, -0.7071, -0.0, 0.0, -0.5, 0.866, 0.7071, -0.7071, -0.0, 0.0, -1.0, -0.0, 0.0, -1.0, -0.0, 0.7071, -0.7071, -0.0, 0.3536, -0.3536, -0.866, 0.0, -1.0, -0.0, 0.3536, -0.3536, -0.866, 0.0, -0.5, -0.866, 0.0, -0.5, -0.866, 0.3536, -0.3536, -0.866, -0.3536, 0.3536, -0.866, 0.0, -0.5, -0.866, -0.3536, 0.3536, -0.866, -0.0, 0.5, -0.866, -0.0, 0.5, -0.866, -0.3536, 0.3536, -0.866, -0.7071, 0.7071, 0.0, -0.0, 0.5, -0.866, -0.7071, 0.7071, 0.0, -0.0, 1.0, 0.0, -0.7071, 0.7071, 0.0, -1.0, -0.0, 0.0, -0.5, -0.0, 0.866, -0.7071, 0.7071, 0.0, -0.5, -0.0, 0.866, -0.3536, 0.3536, 0.866, -0.3536, 0.3536, 0.866, -0.5, -0.0, 0.866, 0.5, 0.0, 0.866, -0.3536, 0.3536, 0.866, 0.5, 0.0, 0.866, 0.3536, -0.3536, 0.866, 0.3536, -0.3536, 0.866, 0.5, 0.0, 0.866, 1.0, 0.0, -0.0, 0.3536, -0.3536, 0.866, 1.0, 0.0, -0.0, 0.7071, -0.7071, -0.0, 0.7071, -0.7071, -0.0, 1.0, 0.0, -0.0, 0.5, 0.0, -0.866, 0.7071, -0.7071, -0.0, 0.5, 0.0, -0.866, 0.3536, -0.3536, -0.866, 0.3536, -0.3536, -0.866, 0.5, 0.0, -0.866, -0.5, -0.0, -0.866, 0.3536, -0.3536, -0.866, -0.5, -0.0, -0.866, -0.3536, 0.3536, -0.866, -0.3536, 0.3536, -0.866, -0.5, -0.0, -0.866, -1.0, -0.0, 0.0, -0.3536, 0.3536, -0.866, -1.0, -0.0, 0.0, -0.7071, 0.7071, 0.0, -1.0, -0.0, 0.0, -0.7071, -0.7071, 0.0, -0.3536, -0.3536, 0.866, -1.0, -0.0, 0.0, -0.3536, -0.3536, 0.866, -0.5, -0.0, 0.866, -0.5, -0.0, 0.866, -0.3536, -0.3536, 0.866, 0.3536, 0.3536, 0.866, -0.5, -0.0, 0.866, 0.3536, 0.3536, 0.866, 0.5, 0.0, 0.866, 0.5, 0.0, 0.866, 0.3536, 0.3536, 0.866, 0.7071, 0.7071, -0.0, 0.5, 0.0, 0.866, 0.7071, 0.7071, -0.0, 1.0, 0.0, -0.0, 1.0, 0.0, -0.0, 0.7071, 0.7071, -0.0, 0.3536, 0.3536, -0.866, 1.0, 0.0, -0.0, 0.3536, 0.3536, -0.866, 0.5, 0.0, -0.866, 0.5, 0.0, -0.866, 0.3536, 0.3536, -0.866, -0.3536, -0.3536, -0.866, 0.5, 0.0, -0.866, -0.3536, -0.3536, -0.866, -0.5, -0.0, -0.866, -0.5, -0.0, -0.866, -0.3536, -0.3536, -0.866, -0.7071, -0.7071, 0.0, -0.5, -0.0, -0.866, -0.7071, -0.7071, 0.0, -1.0, -0.0, 0.0, -0.7071, -0.7071, 0.0, 0.0, -1.0, 0.0, 0.0, -0.5, 0.866, -0.7071, -0.7071, 0.0, 0.0, -0.5, 0.866, -0.3536, -0.3536, 0.866, -0.3536, -0.3536, 0.866, 0.0, -0.5, 0.866, -0.0, 0.5, 0.866, -0.3536, -0.3536, 0.866, -0.0, 0.5, 0.866, 0.3536, 0.3536, 0.866, 0.3536, 0.3536, 0.866, -0.0, 0.5, 0.866, -0.0, 1.0, -0.0, 0.3536, 0.3536, 0.866, -0.0, 1.0, -0.0, 0.7071, 0.7071, -0.0, 0.7071, 0.7071, -0.0, -0.0, 1.0, -0.0, -0.0, 0.5, -0.866, 0.7071, 0.7071, -0.0, -0.0, 0.5, -0.866, 0.3536, 0.3536, -0.866, 0.3536, 0.3536, -0.866, -0.0, 0.5, -0.866, 0.0, -0.5, -0.866, 0.3536, 0.3536, -0.866, 0.0, -0.5, -0.866, -0.3536, -0.3536, -0.866, -0.3536, -0.3536, -0.866, 0.0, -0.5, -0.866, 0.0, -1.0, 0.0, -0.3536, -0.3536, -0.866, 0.0, -1.0, 0.0, -0.7071, -0.7071, 0.0, 0.0, -1.0, 0.0, 0.7071, -0.7071, 0.0, 0.3536, -0.3536, 0.866, 0.0, -1.0, 0.0, 0.3536, -0.3536, 0.866, 0.0, -0.5, 0.866, 0.0, -0.5, 0.866, 0.3536, -0.3536, 0.866, -0.3536, 0.3536, 0.866, 0.0, -0.5, 0.866, -0.3536, 0.3536, 0.866, -0.0, 0.5, 0.866, -0.0, 0.5, 0.866, -0.3536, 0.3536, 0.866, -0.7071, 0.7071, -0.0, -0.0, 0.5, 0.866, -0.7071, 0.7071, -0.0, -0.0, 1.0, -0.0, -0.0, 1.0, -0.0, -0.7071, 0.7071, -0.0, -0.3536, 0.3536, -0.866, -0.0, 1.0, -0.0, -0.3536, 0.3536, -0.866, -0.0, 0.5, -0.866, -0.0, 0.5, -0.866, -0.3536, 0.3536, -0.866, 0.3536, -0.3536, -0.866, -0.0, 0.5, -0.866, 0.3536, -0.3536, -0.866, 0.0, -0.5, -0.866, 0.0, -0.5, -0.866, 0.3536, -0.3536, -0.866, 0.7071, -0.7071, 0.0, 0.0, -0.5, -0.866, 0.7071, -0.7071, 0.0, 0.0, -1.0, 0.0, 0.7071, -0.7071, 0.0, 1.0, 0.0, 0.0, 0.5, 0.0, 0.866, 0.7071, -0.7071, 0.0, 0.5, 0.0, 0.866, 0.3536, -0.3536, 0.866, 0.3536, -0.3536, 0.866, 0.5, 0.0, 0.866, -0.5, -0.0, 0.866, 0.3536, -0.3536, 0.866, -0.5, -0.0, 0.866, -0.3536, 0.3536, 0.866, -0.3536, 0.3536, 0.866, -0.5, -0.0, 0.866, -1.0, -0.0, -0.0, -0.3536, 0.3536, 0.866, -1.0, -0.0, -0.0, -0.7071, 0.7071, -0.0, -0.7071, 0.7071, -0.0, -1.0, -0.0, -0.0, -0.5, -0.0, -0.866, -0.7071, 0.7071, -0.0, -0.5, -0.0, -0.866, -0.3536, 0.3536, -0.866, -0.3536, 0.3536, -0.866, -0.5, -0.0, -0.866, 0.5, 0.0, -0.866, -0.3536, 0.3536, -0.866, 0.5, 0.0, -0.866, 0.3536, -0.3536, -0.866, 0.3536, -0.3536, -0.866, 0.5, 0.0, -0.866, 1.0, 0.0, 0.0, 0.3536, -0.3536, -0.866, 1.0, 0.0, 0.0, 0.7071, -0.7071, 0.0]\"))\n(define torus-texcoords (js \"[0.0, 0.0, 0.0, 0.0, 0.1667, 0.0, 0.125, 0.1667, 0.0, 0.0, 0.0, 0.0, 0.125, 0.1667, 0.0, 0.125, 0.0, 0.0, 0.125, 0.0, 0.0, 0.125, 0.1667, 0.0, 0.25, 0.1667, 0.0, 0.125, 0.0, 0.0, 0.25, 0.1667, 0.0, 0.25, 0.0, 0.0, 0.25, 0.0, 0.0, 0.25, 0.1667, 0.0, 0.375, 0.1667, 0.0, 0.25, 0.0, 0.0, 0.375, 0.1667, 0.0, 0.375, 0.0, 0.0, 0.375, 0.0, 0.0, 0.375, 0.1667, 0.0, 0.5, 0.1667, 0.0, 0.375, 0.0, 0.0, 0.5, 0.1667, 0.0, 0.5, 0.0, 0.0, 0.5, 0.0, 0.0, 0.5, 0.1667, 0.0, 0.625, 0.1667, 0.0, 0.5, 0.0, 0.0, 0.625, 0.1667, 0.0, 0.625, 0.0, 0.0, 0.625, 0.0, 0.0, 0.625, 0.1667, 0.0, 0.75, 0.1667, 0.0, 0.625, 0.0, 0.0, 0.75, 0.1667, 0.0, 0.75, 0.0, 0.0, 0.0, 0.1667, 0.0, 0.0, 0.3333, 0.0, 0.125, 0.3333, 0.0, 0.0, 0.1667, 0.0, 0.125, 0.3333, 0.0, 0.125, 0.1667, 0.0, 0.125, 0.1667, 0.0, 0.125, 0.3333, 0.0, 0.25, 0.3333, 0.0, 0.125, 0.1667, 0.0, 0.25, 0.3333, 0.0, 0.25, 0.1667, 0.0, 0.25, 0.1667, 0.0, 0.25, 0.3333, 0.0, 0.375, 0.3333, 0.0, 0.25, 0.1667, 0.0, 0.375, 0.3333, 0.0, 0.375, 0.1667, 0.0, 0.375, 0.1667, 0.0, 0.375, 0.3333, 0.0, 0.5, 0.3333, 0.0, 0.375, 0.1667, 0.0, 0.5, 0.3333, 0.0, 0.5, 0.1667, 0.0, 0.5, 0.1667, 0.0, 0.5, 0.3333, 0.0, 0.625, 0.3333, 0.0, 0.5, 0.1667, 0.0, 0.625, 0.3333, 0.0, 0.625, 0.1667, 0.0, 0.625, 0.1667, 0.0, 0.625, 0.3333, 0.0, 0.75, 0.3333, 0.0, 0.625, 0.1667, 0.0, 0.75, 0.3333, 0.0, 0.75, 0.1667, 0.0, 0.0, 0.3333, 0.0, 0.0, 0.5, 0.0, 0.125, 0.5, 0.0, 0.0, 0.3333, 0.0, 0.125, 0.5, 0.0, 0.125, 0.3333, 0.0, 0.125, 0.3333, 0.0, 0.125, 0.5, 0.0, 0.25, 0.5, 0.0, 0.125, 0.3333, 0.0, 0.25, 0.5, 0.0, 0.25, 0.3333, 0.0, 0.25, 0.3333, 0.0, 0.25, 0.5, 0.0, 0.375, 0.5, 0.0, 0.25, 0.3333, 0.0, 0.375, 0.5, 0.0, 0.375, 0.3333, 0.0, 0.375, 0.3333, 0.0, 0.375, 0.5, 0.0, 0.5, 0.5, 0.0, 0.375, 0.3333, 0.0, 0.5, 0.5, 0.0, 0.5, 0.3333, 0.0, 0.5, 0.3333, 0.0, 0.5, 0.5, 0.0, 0.625, 0.5, 0.0, 0.5, 0.3333, 0.0, 0.625, 0.5, 0.0, 0.625, 0.3333, 0.0, 0.625, 0.3333, 0.0, 0.625, 0.5, 0.0, 0.75, 0.5, 0.0, 0.625, 0.3333, 0.0, 0.75, 0.5, 0.0, 0.75, 0.3333, 0.0, 0.0, 0.5, 0.0, 0.0, 0.6667, 0.0, 0.125, 0.6667, 0.0, 0.0, 0.5, 0.0, 0.125, 0.6667, 0.0, 0.125, 0.5, 0.0, 0.125, 0.5, 0.0, 0.125, 0.6667, 0.0, 0.25, 0.6667, 0.0, 0.125, 0.5, 0.0, 0.25, 0.6667, 0.0, 0.25, 0.5, 0.0, 0.25, 0.5, 0.0, 0.25, 0.6667, 0.0, 0.375, 0.6667, 0.0, 0.25, 0.5, 0.0, 0.375, 0.6667, 0.0, 0.375, 0.5, 0.0, 0.375, 0.5, 0.0, 0.375, 0.6667, 0.0, 0.5, 0.6667, 0.0, 0.375, 0.5, 0.0, 0.5, 0.6667, 0.0, 0.5, 0.5, 0.0, 0.5, 0.5, 0.0, 0.5, 0.6667, 0.0, 0.625, 0.6667, 0.0, 0.5, 0.5, 0.0, 0.625, 0.6667, 0.0, 0.625, 0.5, 0.0, 0.625, 0.5, 0.0, 0.625, 0.6667, 0.0, 0.75, 0.6667, 0.0, 0.625, 0.5, 0.0, 0.75, 0.6667, 0.0, 0.75, 0.5, 0.0, 0.0, 0.6667, 0.0, 0.0, 0.8333, 0.0, 0.125, 0.8333, 0.0, 0.0, 0.6667, 0.0, 0.125, 0.8333, 0.0, 0.125, 0.6667, 0.0, 0.125, 0.6667, 0.0, 0.125, 0.8333, 0.0, 0.25, 0.8333, 0.0, 0.125, 0.6667, 0.0, 0.25, 0.8333, 0.0, 0.25, 0.6667, 0.0, 0.25, 0.6667, 0.0, 0.25, 0.8333, 0.0, 0.375, 0.8333, 0.0, 0.25, 0.6667, 0.0, 0.375, 0.8333, 0.0, 0.375, 0.6667, 0.0, 0.375, 0.6667, 0.0, 0.375, 0.8333, 0.0, 0.5, 0.8333, 0.0, 0.375, 0.6667, 0.0, 0.5, 0.8333, 0.0, 0.5, 0.6667, 0.0, 0.5, 0.6667, 0.0, 0.5, 0.8333, 0.0, 0.625, 0.8333, 0.0, 0.5, 0.6667, 0.0, 0.625, 0.8333, 0.0, 0.625, 0.6667, 0.0, 0.625, 0.6667, 0.0, 0.625, 0.8333, 0.0, 0.75, 0.8333, 0.0, 0.625, 0.6667, 0.0, 0.75, 0.8333, 0.0, 0.75, 0.6667, 0.0, 0.0, 0.8333, 0.0, 0.0, 1.0, 0.0, 0.125, 1.0, 0.0, 0.0, 0.8333, 0.0, 0.125, 1.0, 0.0, 0.125, 0.8333, 0.0, 0.125, 0.8333, 0.0, 0.125, 1.0, 0.0, 0.25, 1.0, 0.0, 0.125, 0.8333, 0.0, 0.25, 1.0, 0.0, 0.25, 0.8333, 0.0, 0.25, 0.8333, 0.0, 0.25, 1.0, 0.0, 0.375, 1.0, 0.0, 0.25, 0.8333, 0.0, 0.375, 1.0, 0.0, 0.375, 0.8333, 0.0, 0.375, 0.8333, 0.0, 0.375, 1.0, 0.0, 0.5, 1.0, 0.0, 0.375, 0.8333, 0.0, 0.5, 1.0, 0.0, 0.5, 0.8333, 0.0, 0.5, 0.8333, 0.0, 0.5, 1.0, 0.0, 0.625, 1.0, 0.0, 0.5, 0.8333, 0.0, 0.625, 1.0, 0.0, 0.625, 0.8333, 0.0, 0.625, 0.8333, 0.0, 0.625, 1.0, 0.0, 0.75, 1.0, 0.0, 0.625, 0.8333, 0.0, 0.75, 1.0, 0.0, 0.75, 0.8333, 0.0, 0.0, 1.0, 0.0, 0.0, 1.1667, 0.0, 0.125, 1.1667, 0.0, 0.0, 1.0, 0.0, 0.125, 1.1667, 0.0, 0.125, 1.0, 0.0, 0.125, 1.0, 0.0, 0.125, 1.1667, 0.0, 0.25, 1.1667, 0.0, 0.125, 1.0, 0.0, 0.25, 1.1667, 0.0, 0.25, 1.0, 0.0, 0.25, 1.0, 0.0, 0.25, 1.1667, 0.0, 0.375, 1.1667, 0.0, 0.25, 1.0, 0.0, 0.375, 1.1667, 0.0, 0.375, 1.0, 0.0, 0.375, 1.0, 0.0, 0.375, 1.1667, 0.0, 0.5, 1.1667, 0.0, 0.375, 1.0, 0.0, 0.5, 1.1667, 0.0, 0.5, 1.0, 0.0, 0.5, 1.0, 0.0, 0.5, 1.1667, 0.0, 0.625, 1.1667, 0.0, 0.5, 1.0, 0.0, 0.625, 1.1667, 0.0, 0.625, 1.0, 0.0, 0.625, 1.0, 0.0, 0.625, 1.1667, 0.0, 0.75, 1.1667, 0.0, 0.625, 1.0, 0.0, 0.75, 1.1667, 0.0, 0.75, 1.0, 0.0, 0.0, 1.1667, 0.0, 0.0, 1.3333, 0.0, 0.125, 1.3333, 0.0, 0.0, 1.1667, 0.0, 0.125, 1.3333, 0.0, 0.125, 1.1667, 0.0, 0.125, 1.1667, 0.0, 0.125, 1.3333, 0.0, 0.25, 1.3333, 0.0, 0.125, 1.1667, 0.0, 0.25, 1.3333, 0.0, 0.25, 1.1667, 0.0, 0.25, 1.1667, 0.0, 0.25, 1.3333, 0.0, 0.375, 1.3333, 0.0, 0.25, 1.1667, 0.0, 0.375, 1.3333, 0.0, 0.375, 1.1667, 0.0, 0.375, 1.1667, 0.0, 0.375, 1.3333, 0.0, 0.5, 1.3333, 0.0, 0.375, 1.1667, 0.0, 0.5, 1.3333, 0.0, 0.5, 1.1667, 0.0, 0.5, 1.1667, 0.0, 0.5, 1.3333, 0.0, 0.625, 1.3333, 0.0, 0.5, 1.1667, 0.0, 0.625, 1.3333, 0.0, 0.625, 1.1667, 0.0, 0.625, 1.1667, 0.0, 0.625, 1.3333, 0.0, 0.75, 1.3333, 0.0, 0.625, 1.1667, 0.0, 0.75, 1.3333, 0.0, 0.75, 1.1667, 0.0]\"))\n\n(define wing-vertices (js \"[0.2454, -0.0, 0.7892, 0.9568, -0.0, 0.7842, 0.536, -0.0, 0.9044, 0.2454, -0.0, 0.7892, 1.1471, -0.0, 0.5287, 0.9568, -0.0, 0.7842, 0.2454, -0.0, 0.7892, 0.01, -0.0, 0.4686, 1.1471, -0.0, 0.5287, 0.01, -0.0, 0.4686, 1.2573, -0.0, 0.2883, 1.1471, -0.0, 0.5287, 0.01, -0.0, 0.4686, -0.0, -0.0, 0.2131, 1.2573, -0.0, 0.2883, -0.0, -0.0, 0.2131, 1.1872, -0.0, 0.168, 1.2573, -0.0, 0.2883, -0.0, -0.0, 0.2131, -0.0251, -0.0, 0.1029, 1.1872, -0.0, 0.168, -0.0251, -0.0, 0.1029, 0.2605, -0.0, -0.2377, 1.1872, -0.0, 0.168, 0.2605, -0.0, -0.2377, 1.3926, -0.0, 0.0628, 1.1872, -0.0, 0.168, 0.2605, -0.0, -0.2377, 0.8466, -0.0, -0.6886, 1.3926, -0.0, 0.0628, 0.8466, -0.0, -0.6886, 1.6781, -0.0, -0.3229, 1.3926, -0.0, 0.0628, 0.8466, -0.0, -0.6886, 1.2573, -0.0, -0.8589, 1.6781, -0.0, -0.3229, 1.2573, -0.0, -0.8589, 1.7533, -0.0, -0.6485, 1.6781, -0.0, -0.3229, 1.2573, -0.0, -0.8589, 1.628, -0.0, -0.8639, 1.7533, -0.0, -0.6485, ]\"))\n(define wing-normals (js \"[0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, ]\"))\n(define wing-texcoords (js \"[0.8073, 0.1097, 0.0, 0.4862, 0.0992, 0.0, 0.6752, 0.0493, 0.0, 0.8073, 0.1097, 0.0, 0.4021, 0.218, 0.0, 0.4862, 0.0992, 0.0, 0.8073, 0.1097, 0.0, 0.9373, 0.2673, 0.0, 0.4021, 0.218, 0.0, 0.9373, 0.2673, 0.0, 0.3375, 0.3569, 0.0, 0.4021, 0.218, 0.0, 0.9373, 0.2673, 0.0, 0.9452, 0.3788, 0.0, 0.3375, 0.3569, 0.0, 0.9452, 0.3788, 0.0, 0.3636, 0.4094, 0.0, 0.3375, 0.3569, 0.0, 0.9452, 0.3788, 0.0, 0.9545, 0.4621, 0.0, 0.3636, 0.4094, 0.0, 0.9545, 0.4621, 0.0, 0.8035, 0.6238, 0.0, 0.3636, 0.4094, 0.0, 0.8035, 0.6238, 0.0, 0.3027, 0.4468, 0.0, 0.3636, 0.4094, 0.0, 0.8035, 0.6238, 0.0, 0.5339, 0.8287, 0.0, 0.3027, 0.4468, 0.0, 0.5339, 0.8287, 0.0, 0.1433, 0.6399, 0.0, 0.3027, 0.4468, 0.0, 0.5339, 0.8287, 0.0, 0.3303, 0.9123, 0.0, 0.1433, 0.6399, 0.0, 0.3303, 0.9123, 0.0, 0.0996, 0.8069, 0.0, 0.1433, 0.6399, 0.0, 0.3303, 0.9123, 0.0, 0.1544, 0.9162, 0.0, 0.0996, 0.8069, 0.0, ]\"))\n\n(define body-vertices  (js \"[-0.0, 0.0, -0.921, -0.0, 0.0, -0.921, 0.0061, 0.0211, -0.4399, -0.015, 0.0, -0.4394, -0.0, 0.0, -0.921, 0.0061, 0.0211, -0.4399, 0.0061, -0.0211, -0.4399, -0.0, 0.0, -0.921, -0.015, 0.0, -0.4394, 0.0061, -0.0211, -0.4399, -0.0, 0.0, -0.921, -0.0, 0.0, -0.921, 0.0272, 0.0, -0.4404, -0.0, 0.0, -0.921, 0.0061, -0.0211, -0.4399, 0.0272, 0.0, -0.4404, -0.0, 0.0, -0.921, -0.0, 0.0, -0.921, -0.0, 0.0, -0.921, -0.0, 0.0, -0.921, 0.0272, 0.0, -0.4404, 0.0061, 0.0211, -0.4399, -0.0, 0.0, -0.921, 0.0272, 0.0, -0.4404, -0.0065, 0.0, -0.0029, 0.0061, 0.0211, -0.4399, 0.0194, 0.0259, -0.0037, -0.0065, 0.0, -0.0029, -0.015, 0.0, -0.4394, 0.0061, 0.0211, -0.4399, 0.0061, -0.0211, -0.4399, -0.015, 0.0, -0.4394, -0.0065, 0.0, -0.0029, 0.0194, -0.0259, -0.0037, 0.0061, -0.0211, -0.4399, -0.0065, 0.0, -0.0029, 0.0272, 0.0, -0.4404, 0.0061, -0.0211, -0.4399, 0.0194, -0.0259, -0.0037, 0.0453, 0.0, -0.0046, 0.0272, 0.0, -0.4404, 0.0194, -0.0259, -0.0037, 0.0194, 0.0259, -0.0037, 0.0272, 0.0, -0.4404, 0.0453, 0.0, -0.0046, 0.0194, 0.0259, -0.0037, 0.0061, 0.0211, -0.4399, 0.0272, 0.0, -0.4404, 0.0064, -0.0, 0.3776, 0.0194, 0.0259, -0.0037, 0.0328, 0.0264, 0.3769, 0.0064, -0.0, 0.3776, -0.0065, 0.0, -0.0029, 0.0194, 0.0259, -0.0037, 0.0194, -0.0259, -0.0037, -0.0065, 0.0, -0.0029, 0.0064, -0.0, 0.3776, 0.0328, -0.0264, 0.3769, 0.0194, -0.0259, -0.0037, 0.0064, -0.0, 0.3776, 0.0453, 0.0, -0.0046, 0.0194, -0.0259, -0.0037, 0.0328, -0.0264, 0.3769, 0.0592, -0.0, 0.3761, 0.0453, 0.0, -0.0046, 0.0328, -0.0264, 0.3769, 0.0328, 0.0264, 0.3769, 0.0453, 0.0, -0.0046, 0.0592, -0.0, 0.3761, 0.0328, 0.0264, 0.3769, 0.0194, 0.0259, -0.0037, 0.0453, 0.0, -0.0046, 0.0125, -0.0, 0.691, 0.0328, 0.0264, 0.3769, 0.0389, 0.0263, 0.6913, 0.0125, -0.0, 0.691, 0.0064, -0.0, 0.3776, 0.0328, 0.0264, 0.3769, 0.0328, -0.0264, 0.3769, 0.0064, -0.0, 0.3776, 0.0125, -0.0, 0.691, 0.0389, -0.0263, 0.6913, 0.0328, -0.0264, 0.3769, 0.0125, -0.0, 0.691, 0.0592, -0.0, 0.3761, 0.0328, -0.0264, 0.3769, 0.0389, -0.0263, 0.6913, 0.0652, -0.0, 0.6915, 0.0592, -0.0, 0.3761, 0.0389, -0.0263, 0.6913, 0.0389, 0.0263, 0.6913, 0.0592, -0.0, 0.3761, 0.0652, -0.0, 0.6915, 0.0389, 0.0263, 0.6913, 0.0328, 0.0264, 0.3769, 0.0592, -0.0, 0.3761, -0.0296, -0.0, 0.9218, 0.0389, 0.0263, 0.6913, 0.0304, 0.0601, 0.9289, -0.0296, -0.0, 0.9218, 0.0125, -0.0, 0.691, 0.0389, 0.0263, 0.6913, 0.0389, -0.0263, 0.6913, 0.0125, -0.0, 0.691, -0.0296, -0.0, 0.9218, 0.0304, -0.0601, 0.9289, 0.0389, -0.0263, 0.6913, -0.0296, -0.0, 0.9218, 0.0652, -0.0, 0.6915, 0.0389, -0.0263, 0.6913, 0.0304, -0.0601, 0.9289, 0.0903, -0.0, 0.9359, 0.0652, -0.0, 0.6915, 0.0304, -0.0601, 0.9289, 0.0304, 0.0601, 0.9289, 0.0652, -0.0, 0.6915, 0.0903, -0.0, 0.9359, 0.0304, 0.0601, 0.9289, 0.0389, 0.0263, 0.6913, 0.0652, -0.0, 0.6915, -0.0296, -0.0, 0.9218, 0.0304, 0.0601, 0.9289, 0.0, -0.002, 1.079, 0.002, -0.0, 1.0793, -0.0296, -0.0, 0.9218, 0.0, -0.002, 1.079, 0.0, 0.002, 1.079, -0.0296, -0.0, 0.9218, 0.002, -0.0, 1.0793, 0.0, 0.002, 1.079, 0.0304, -0.0601, 0.9289, -0.0296, -0.0, 0.9218, 0.0304, -0.0601, 0.9289, -0.002, -0.0, 1.0788, 0.0903, -0.0, 0.9359, 0.0304, -0.0601, 0.9289, 0.0, 0.002, 1.079, -0.002, -0.0, 1.0788, 0.0304, 0.0601, 0.9289, 0.0903, -0.0, 0.9359, -0.002, -0.0, 1.0788, 0.0, -0.002, 1.079, 0.0304, 0.0601, 0.9289, -0.002, -0.0, 1.0788, 0.3868, -0.2394, 1.1734, 0.0643, -0.0224, 0.9367, 0.3926, -0.2359, 1.1688, 0.3868, -0.2394, 1.1734, 0.0587, -0.026, 0.9413, 0.0643, -0.0224, 0.9367, 0.3862, -0.2454, 1.1679, 0.0587, -0.026, 0.9413, 0.3868, -0.2394, 1.1734, 0.3862, -0.2454, 1.1679, 0.058, -0.0318, 0.9358, 0.0587, -0.026, 0.9413, 0.0635, -0.0282, 0.9313, 0.058, -0.0318, 0.9358, 0.3862, -0.2454, 1.1679, 0.392, -0.2419, 1.1634, 0.0635, -0.0282, 0.9313, 0.3862, -0.2454, 1.1679, 0.0643, -0.0224, 0.9367, 0.0635, -0.0282, 0.9313, 0.392, -0.2419, 1.1634, 0.3926, -0.2359, 1.1688, 0.0643, -0.0224, 0.9367, 0.392, -0.2419, 1.1634, 0.3976, -0.2518, 1.2178, 0.3926, -0.2359, 1.1688, 0.4354, -0.2324, 1.1921, 0.3976, -0.2518, 1.2178, 0.3868, -0.2394, 1.1734, 0.3926, -0.2359, 1.1688, 0.3862, -0.2454, 1.1679, 0.3868, -0.2394, 1.1734, 0.3976, -0.2518, 1.2178, 0.3965, -0.2905, 1.1866, 0.3862, -0.2454, 1.1679, 0.3976, -0.2518, 1.2178, 0.392, -0.2419, 1.1634, 0.3862, -0.2454, 1.1679, 0.3965, -0.2905, 1.1866, 0.4343, -0.271, 1.1609, 0.392, -0.2419, 1.1634, 0.3965, -0.2905, 1.1866, 0.4354, -0.2324, 1.1921, 0.392, -0.2419, 1.1634, 0.4343, -0.271, 1.1609, 0.4354, -0.2324, 1.1921, 0.3926, -0.2359, 1.1688, 0.392, -0.2419, 1.1634, 0.3976, -0.2518, 1.2178, 0.4354, -0.2324, 1.1921, 0.4449, -0.2829, 1.2166, 0.4453, -0.2827, 1.2163, 0.3976, -0.2518, 1.2178, 0.4449, -0.2829, 1.2166, 0.4454, -0.2822, 1.2167, 0.3976, -0.2518, 1.2178, 0.4453, -0.2827, 1.2163, 0.4454, -0.2822, 1.2167, 0.3965, -0.2905, 1.1866, 0.3976, -0.2518, 1.2178, 0.3965, -0.2905, 1.1866, 0.4449, -0.2824, 1.217, 0.4343, -0.271, 1.1609, 0.3965, -0.2905, 1.1866, 0.4454, -0.2822, 1.2167, 0.4449, -0.2824, 1.217, 0.4354, -0.2324, 1.1921, 0.4343, -0.271, 1.1609, 0.4449, -0.2824, 1.217, 0.4449, -0.2829, 1.2166, 0.4354, -0.2324, 1.1921, 0.4449, -0.2824, 1.217, 0.2788, 0.3996, 1.0633, 0.0473, 0.0266, 0.943, 0.2812, 0.3959, 1.0701, 0.2788, 0.3996, 1.0633, 0.0451, 0.0304, 0.9363, 0.0473, 0.0266, 0.943, 0.2721, 0.4021, 1.067, 0.0451, 0.0304, 0.9363, 0.2788, 0.3996, 1.0633, 0.2721, 0.4021, 1.067, 0.0383, 0.0327, 0.9399, 0.0451, 0.0304, 0.9363, 0.0406, 0.029, 0.9466, 0.0383, 0.0327, 0.9399, 0.2721, 0.4021, 1.067, 0.2745, 0.3985, 1.0738, 0.0406, 0.029, 0.9466, 0.2721, 0.4021, 1.067, 0.0473, 0.0266, 0.943, 0.0406, 0.029, 0.9466, 0.2745, 0.3985, 1.0738, 0.2812, 0.3959, 1.0701, 0.0473, 0.0266, 0.943, 0.2745, 0.3985, 1.0738, 0.3067, 0.433, 1.0446, 0.2812, 0.3959, 1.0701, 0.3232, 0.4141, 1.0874, 0.3067, 0.433, 1.0446, 0.2788, 0.3996, 1.0633, 0.2812, 0.3959, 1.0701, 0.2721, 0.4021, 1.067, 0.2788, 0.3996, 1.0633, 0.3067, 0.433, 1.0446, 0.2671, 0.4517, 1.0682, 0.2721, 0.4021, 1.067, 0.3067, 0.433, 1.0446, 0.2745, 0.3985, 1.0738, 0.2721, 0.4021, 1.067, 0.2671, 0.4517, 1.0682, 0.2837, 0.4327, 1.1111, 0.2745, 0.3985, 1.0738, 0.2671, 0.4517, 1.0682, 0.3232, 0.4141, 1.0874, 0.2745, 0.3985, 1.0738, 0.2837, 0.4327, 1.1111, 0.3232, 0.4141, 1.0874, 0.2812, 0.3959, 1.0701, 0.2745, 0.3985, 1.0738, 0.3067, 0.433, 1.0446, 0.3232, 0.4141, 1.0874, 0.3186, 0.4708, 1.085, 0.3188, 0.4706, 1.0856, 0.3067, 0.433, 1.0446, 0.3186, 0.4708, 1.085, 0.3193, 0.4704, 1.0853, 0.3067, 0.433, 1.0446, 0.3188, 0.4706, 1.0856, 0.3193, 0.4704, 1.0853, 0.2671, 0.4517, 1.0682, 0.3067, 0.433, 1.0446, 0.2671, 0.4517, 1.0682, 0.3191, 0.4706, 1.0847, 0.2837, 0.4327, 1.1111, 0.2671, 0.4517, 1.0682, 0.3193, 0.4704, 1.0853, 0.3191, 0.4706, 1.0847, 0.3232, 0.4141, 1.0874, 0.2837, 0.4327, 1.1111, 0.3191, 0.4706, 1.0847, 0.3186, 0.4708, 1.085, 0.3232, 0.4141, 1.0874, 0.3191, 0.4706, 1.0847, ]\"))\n(define body-normals (js \"[-0.9995, 0.0055, -0.0312, 0.7062, 0.7069, -0.0399, -0.0159, 0.9998, -0.0115, -1.0, 0.0, -0.0058, -0.9995, 0.0055, -0.0312, -0.0159, 0.9998, -0.0115, -0.0106, -0.9999, -0.0114, -0.9995, 0.0055, -0.0312, -1.0, 0.0, -0.0058, -0.0106, -0.9999, -0.0114, 0.7062, -0.7069, -0.0399, -0.9995, 0.0055, -0.0312, 0.9991, 0.0054, -0.0418, 0.7062, -0.7069, -0.0399, -0.0106, -0.9999, -0.0114, 0.9991, 0.0054, -0.0418, 0.0, 0.0, 0.0, 0.7062, -0.7069, -0.0399, 0.7062, 0.7069, -0.0399, 0.0, 0.0, 0.0, 0.9991, 0.0054, -0.0418, -0.0159, 0.9998, -0.0115, 0.7062, 0.7069, -0.0399, 0.9991, 0.0054, -0.0418, -0.9996, 0.0, 0.0266, -0.0159, 0.9998, -0.0115, -0.0021, 1.0, -0.0061, -0.9996, 0.0, 0.0266, -1.0, 0.0, -0.0058, -0.0159, 0.9998, -0.0115, -0.0106, -0.9999, -0.0114, -1.0, 0.0, -0.0058, -0.9996, 0.0, 0.0266, -0.0021, -1.0, -0.0061, -0.0106, -0.9999, -0.0114, -0.9996, 0.0, 0.0266, 0.9991, 0.0054, -0.0418, -0.0106, -0.9999, -0.0114, -0.0021, -1.0, -0.0061, 0.9992, 0.0, -0.039, 0.9991, 0.0054, -0.0418, -0.0021, -1.0, -0.0061, -0.0021, 1.0, -0.0061, 0.9991, 0.0054, -0.0418, 0.9992, 0.0, -0.039, -0.0021, 1.0, -0.0061, -0.0159, 0.9998, -0.0115, 0.9991, 0.0054, -0.0418, -0.9996, 0.0, 0.0267, -0.0021, 1.0, -0.0061, 0.0007, 1.0, -0.0005, -0.9996, 0.0, 0.0267, -0.9996, 0.0, 0.0266, -0.0021, 1.0, -0.0061, -0.0021, -1.0, -0.0061, -0.9996, 0.0, 0.0266, -0.9996, 0.0, 0.0267, 0.0007, -1.0, -0.0005, -0.0021, -1.0, -0.0061, -0.9996, 0.0, 0.0267, 0.9992, 0.0, -0.039, -0.0021, -1.0, -0.0061, 0.0007, -1.0, -0.0005, 0.9996, 0.0, -0.0277, 0.9992, 0.0, -0.039, 0.0007, -1.0, -0.0005, 0.0007, 1.0, -0.0005, 0.9992, 0.0, -0.039, 0.9996, 0.0, -0.0277, 0.0007, 1.0, -0.0005, -0.0021, 1.0, -0.0061, 0.9992, 0.0, -0.039, -0.9968, 0.0, -0.0803, 0.0007, 1.0, -0.0005, -0.0229, 0.9972, -0.0708, -0.9968, 0.0, -0.0803, -0.9996, 0.0, 0.0267, 0.0007, 1.0, -0.0005, 0.0007, -1.0, -0.0005, -0.9996, 0.0, 0.0267, -0.9968, 0.0, -0.0803, -0.0229, -0.9972, -0.0708, 0.0007, -1.0, -0.0005, -0.9968, 0.0, -0.0803, 0.9996, 0.0, -0.0277, 0.0007, -1.0, -0.0005, -0.0229, -0.9972, -0.0708, 0.9981, 0.0, -0.0608, 0.9996, 0.0, -0.0277, -0.0229, -0.9972, -0.0708, -0.0229, 0.9972, -0.0708, 0.9996, 0.0, -0.0277, 0.9981, 0.0, -0.0608, -0.0229, 0.9972, -0.0708, 0.0007, 1.0, -0.0005, 0.9996, 0.0, -0.0277, -0.6951, 0.0, -0.7189, -0.0229, 0.9972, -0.0708, -0.4938, 0.8565, -0.1502, -0.6951, 0.0, -0.7189, -0.9968, 0.0, -0.0803, -0.0229, 0.9972, -0.0708, -0.0229, -0.9972, -0.0708, -0.9968, 0.0, -0.0803, -0.6951, 0.0, -0.7189, -0.4938, -0.8565, -0.1502, -0.0229, -0.9972, -0.0708, -0.6951, 0.0, -0.7189, 0.9981, 0.0, -0.0608, -0.0229, -0.9972, -0.0708, -0.4938, -0.8565, -0.1502, 0.9724, 0.0, 0.2331, 0.9981, 0.0, -0.0608, -0.4938, -0.8565, -0.1502, -0.4938, 0.8565, -0.1502, 0.9981, 0.0, -0.0608, 0.9724, 0.0, 0.2331, -0.4938, 0.8565, -0.1502, -0.0229, 0.9972, -0.0708, 0.9981, 0.0, -0.0608, -0.6951, 0.0, -0.7189, -0.4938, 0.8565, -0.1502, -0.9805, 0.0048, -0.1962, 0.9804, 0.0, -0.1967, -0.6951, 0.0, -0.7189, -0.9805, 0.0048, -0.1962, -0.9805, -0.0048, -0.1962, -0.6951, 0.0, -0.7189, 0.9804, 0.0, -0.1967, -0.9805, -0.0048, -0.1962, -0.4938, -0.8565, -0.1502, -0.6951, 0.0, -0.7189, -0.4938, -0.8565, -0.1502, 0.8398, 0.0, 0.5428, 0.9724, 0.0, 0.2331, -0.4938, -0.8565, -0.1502, -0.9805, -0.0048, -0.1962, 0.8398, 0.0, 0.5428, -0.4938, 0.8565, -0.1502, 0.9724, 0.0, 0.2331, 0.8398, 0.0, 0.5428, -0.9805, 0.0048, -0.1962, -0.4938, 0.8565, -0.1502, 0.8398, 0.0, 0.5428, -0.6778, 0.3701, 0.6353, 0.5177, 0.8538, 0.053, 0.2823, 0.9559, -0.0806, -0.6778, 0.3701, 0.6353, -0.4603, 0.2258, 0.8585, 0.5177, 0.8538, 0.053, -0.7445, -0.6327, -0.2128, -0.4603, 0.2258, 0.8585, -0.6778, 0.3701, 0.6353, -0.7445, -0.6327, -0.2128, -0.518, -0.8537, -0.0531, -0.4603, 0.2258, 0.8585, 0.4591, -0.2274, -0.8588, -0.518, -0.8537, -0.0531, -0.7445, -0.6327, -0.2128, 0.2234, -0.0834, -0.9711, 0.4591, -0.2274, -0.8588, -0.7445, -0.6327, -0.2128, 0.5177, 0.8538, 0.053, 0.4591, -0.2274, -0.8588, 0.2234, -0.0834, -0.9711, 0.2823, 0.9559, -0.0806, 0.5177, 0.8538, 0.053, 0.2234, -0.0834, -0.9711, -0.8321, 0.528, 0.17, 0.2823, 0.9559, -0.0806, 0.0782, 0.9574, 0.278, -0.8321, 0.528, 0.17, -0.6778, 0.3701, 0.6353, 0.2823, 0.9559, -0.0806, -0.7445, -0.6327, -0.2128, -0.6778, 0.3701, 0.6353, -0.8321, 0.528, 0.17, -0.8767, -0.461, 0.1375, -0.7445, -0.6327, -0.2128, -0.8321, 0.528, 0.17, 0.2234, -0.0834, -0.9711, -0.7445, -0.6327, -0.2128, -0.8767, -0.461, 0.1375, 0.523, -0.278, -0.8057, 0.2234, -0.0834, -0.9711, -0.8767, -0.461, 0.1375, 0.0782, 0.9574, 0.278, 0.2234, -0.0834, -0.9711, 0.523, -0.278, -0.8057, 0.0782, 0.9574, 0.278, 0.2823, 0.9559, -0.0806, 0.2234, -0.0834, -0.9711, -0.8321, 0.528, 0.17, 0.0782, 0.9574, 0.278, -0.5394, 0.2834, 0.7929, 0.0181, 0.0769, -0.9969, -0.8321, 0.528, 0.17, -0.5394, 0.2834, 0.7929, -0.5364, 0.2877, 0.7934, -0.8321, 0.528, 0.17, 0.0181, 0.0769, -0.9969, -0.5364, 0.2877, 0.7934, -0.8767, -0.461, 0.1375, -0.8321, 0.528, 0.17, -0.8767, -0.461, 0.1375, 0.8156, -0.5171, -0.2593, 0.523, -0.278, -0.8057, -0.8767, -0.461, 0.1375, -0.5364, 0.2877, 0.7934, 0.8156, -0.5171, -0.2593, 0.0782, 0.9574, 0.278, 0.523, -0.278, -0.8057, 0.8156, -0.5171, -0.2593, -0.5394, 0.2834, 0.7929, 0.0782, 0.9574, 0.278, 0.8156, -0.5171, -0.2593, 0.174, -0.1953, -0.9651, 0.7737, -0.5787, 0.2579, 0.6006, -0.7849, 0.1519, 0.174, -0.1953, -0.9651, 0.3707, 0.0834, -0.925, 0.7737, -0.5787, 0.2579, -0.8978, 0.2608, -0.3548, 0.3707, 0.0834, -0.925, 0.174, -0.1953, -0.9651, -0.8978, 0.2608, -0.3548, -0.7738, 0.5785, -0.258, 0.3707, 0.0834, -0.925, -0.3724, -0.0825, 0.9244, -0.7738, 0.5785, -0.258, -0.8978, 0.2608, -0.3548, -0.5112, -0.315, 0.7996, -0.3724, -0.0825, 0.9244, -0.8978, 0.2608, -0.3548, 0.7737, -0.5787, 0.2579, -0.3724, -0.0825, 0.9244, -0.5112, -0.315, 0.7996, 0.6006, -0.7849, 0.1519, 0.7737, -0.5787, 0.2579, -0.5112, -0.315, 0.7996, -0.1281, -0.5799, -0.8045, 0.6006, -0.7849, 0.1519, 0.7017, -0.6735, -0.2323, -0.1281, -0.5799, -0.8045, 0.174, -0.1953, -0.9651, 0.6006, -0.7849, 0.1519, -0.8978, 0.2608, -0.3548, 0.174, -0.1953, -0.9651, -0.1281, -0.5799, -0.8045, -0.6729, 0.2405, -0.6995, -0.8978, 0.2608, -0.3548, -0.1281, -0.5799, -0.8045, -0.5112, -0.315, 0.7996, -0.8978, 0.2608, -0.3548, -0.6729, 0.2405, -0.6995, -0.3265, 0.0008, 0.9452, -0.5112, -0.315, 0.7996, -0.6729, 0.2405, -0.6995, 0.7017, -0.6735, -0.2323, -0.5112, -0.315, 0.7996, -0.3265, 0.0008, 0.9452, 0.7017, -0.6735, -0.2323, 0.6006, -0.7849, 0.1519, -0.5112, -0.315, 0.7996, -0.1281, -0.5799, -0.8045, 0.7017, -0.6735, -0.2323, 0.3113, -0.0151, -0.9502, -0.5698, -0.5146, 0.6407, -0.1281, -0.5799, -0.8045, 0.3113, -0.0151, -0.9502, 0.316, -0.018, -0.9486, -0.1281, -0.5799, -0.8045, -0.5698, -0.5146, 0.6407, 0.316, -0.018, -0.9486, -0.6729, 0.2405, -0.6995, -0.1281, -0.5799, -0.8045, -0.6729, 0.2405, -0.6995, 0.0683, 0.5262, 0.8476, -0.3265, 0.0008, 0.9452, -0.6729, 0.2405, -0.6995, 0.316, -0.018, -0.9486, 0.0683, 0.5262, 0.8476, 0.7017, -0.6735, -0.2323, -0.3265, 0.0008, 0.9452, 0.0683, 0.5262, 0.8476, 0.3113, -0.0151, -0.9502, 0.7017, -0.6735, -0.2323, 0.0683, 0.5262, 0.8476, ]\"))\n(define body-texcoords (js \"[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ]\"))\n", "flx/scm/renderer.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n \n(define (frustum ortho top near far) (list ortho top near far))\n(define (frustum-ortho? f) (list-ref f 0))\n(define (frustum-top f) (list-ref f 1))\n(define (frustum-near f) (list-ref f 2))\n(define (frustum-far f) (list-ref f 3))\n\n(define (renderer gl)\n  (shader-cache-add gl \"main\" (list \"p\" \"n\" \"t\" \"c\") vertex-shader fragment-shader)\n  (list\n   gl\n   ()\n   (mat4.identity (mat4.create))\n   (mat4.identity (mat4.create))\n   (mat4.identity (mat4.create))\n   (list (state gl))\n   ()\n   #f\n   ()\n   (scenenode 0 (state gl) 0 \'())\n   ()\n   (vector 1 1 1)\n   45\n   (frustum #f 20 0.1 1000.0)))\n\n(define (renderer-gl r) (list-ref r 0))\n(define (renderer-list r) (list-ref r 1))\n(define (renderer-modify-list r v) (list-replace r 1 v))\n(define (renderer-view r) (list-ref r 2))\n(define (renderer-camera r) (list-ref r 3))\n(define (renderer-modify-camera r v) (list-replace r 3 v))\n(define (renderer-world-to-screen r) (list-ref r 4))\n(define (renderer-stack r) (list-ref r 5))\n(define (renderer-modify-stack r v) (list-replace r 5 v))\n(define (renderer-immediate-prims r) (list-ref r 6))\n(define (renderer-modify-immediate-prims r v) (list-replace r 6 v))\n(define (renderer-hook r) (list-ref r 7))\n(define (renderer-modify-hook r v) (list-replace r 7 v))\n(define (renderer-prefab r) (list-ref r 8))\n(define (renderer-modify-prefab r v) (list-replace r 8 v))\n(define (renderer-scenegraph r) (list-ref r 9))\n(define (renderer-modify-scenegraph r v) (list-replace r 9 v))\n(define (renderer-grab-stack r) (list-ref r 10))\n(define (renderer-modify-grab-stack r v) (list-replace r 10 v))\n(define (renderer-clear-colour r) (list-ref r 11))\n(define (renderer-modify-clear-colour r v) (list-replace r 11 v))\n(define (renderer-view-angle r) (list-ref r 12))\n(define (renderer-modify-view-angle r v) (list-replace r 12 v))\n(define (renderer-frustum r) (list-ref r 13))\n(define (renderer-modify-frustum r v) (list-replace r 13 v))\n\n(define (renderer-add r p)\n  (renderer-modify-list r (cons p (renderer-list r))))\n\n(define (renderer-stack-dup r)\n  (renderer-modify-stack\n   r (cons (state-clone (car (renderer-stack r)))\n\t   (renderer-stack r))))\n\n(define (renderer-stack-pop r)\n  (renderer-modify-stack\n   r (cdr (renderer-stack r))))\n\n(define (renderer-stack-top r)\n  (car (renderer-stack r)))\n\n(define (renderer-top-tx r)\n  (state-tx (renderer-stack-top r)))\n\n(define (renderer-current-tx r)\n  (let ((grabbed (renderer-grab-stack-top r)))\n    ;; either modify the grabbed primitive or the stack top\n    (if grabbed\n\t(state-tx (scenenode-state grabbed))\n\t(state-tx (renderer-stack-top r)))))\n\n(define (renderer-global-tx r)\n  (let ((grabbed (renderer-grab-stack-top r)))\n    (if grabbed\n\t(scenenode-global-tx grabbed)\n\t(state-tx (renderer-stack-top r)))))\n\n(define (renderer-modify-current-state r fn)\n  (let ((grabbed (renderer-grab-stack-top r)))\n    ;; either modify the grabbed primitive or the stack top\n    (if grabbed\n\t(begin \n\t  (scenenode-modify-state! grabbed (fn (scenenode-state grabbed)))\n\t  r) ;; need to return the unchanged renderer\n\t(renderer-modify-stack\n\t r (cons (fn (car (renderer-stack r)))\n\t\t (cdr (renderer-stack r)))))))\n\n(define (renderer-immediate-add r p)\n  (renderer-modify-immediate-prims\n   r (cons\n      ;; state, and a primitive to render in\n      (list (state-clone (renderer-stack-top r)) p)\n      (renderer-immediate-prims r))))\n\n(define (renderer-immediate-clear r)\n  (renderer-modify-immediate-prims r ()))\n\n(define (renderer-grab-stack-push r id)\n  (let ((node (scenegraph-find (renderer-scenegraph r) id))) \n    (if node\n\t(renderer-modify-grab-stack\n\t r (cons node\n\t\t (renderer-grab-stack r)))\n\tr)))\n    \n(define (renderer-grabbed? r)\n  (> (length (renderer-grab-stack r)) 0))\n\n(define (renderer-grab-stack-pop r)\n  (renderer-modify-grab-stack r (cdr (renderer-grab-stack r))))\n\n(define (renderer-grab-stack-top r)\n  (if (null? (renderer-grab-stack r))\n      #f\n      (car (renderer-grab-stack r))))\n\n(define (renderer-frustum-apply gl r)\n  (let ((aspect (/ gl.viewportWidth gl.viewportHeight))\n\t(frustum (renderer-frustum r)))\n    (if (frustum-ortho? frustum)\n\t(mat4.ortho (* (frustum-top frustum) aspect -1) \n\t\t    (* (frustum-top frustum) aspect) \n\t\t    (- (frustum-top frustum)) (frustum-top frustum) \n\t\t    (frustum-near frustum) \n\t\t    (frustum-far frustum) \n\t\t    (renderer-view r))\n\t(mat4.perspective \n\t (renderer-view-angle r) \n\t aspect\n\t (frustum-near frustum) \n\t (frustum-far frustum) \n\t (renderer-view r)))))\n\n(define (renderer-render r)\n  (let ((gl (renderer-gl r))\n\t(hook (renderer-hook r))\n\t(view-camera (mat4.create))\n\t(camera-pos (vector 0 0 0)))\n    \n    (gl.viewport 0 0 gl.viewportWidth gl.viewportHeight)\n    (gl.clearColor (vx (renderer-clear-colour r)) \n\t\t   (vy (renderer-clear-colour r))\n\t\t   (vz (renderer-clear-colour r))\n\t\t   (list-ref (renderer-clear-colour r) 3))\n    (gl.clear (js \"gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT\"))\n\n    (renderer-frustum-apply gl r)\n    \n    (gl.enable gl.BLEND)\n    (gl.blendFunc gl.SRC_ALPHA gl.ONE_MINUS_SRC_ALPHA)\n\n    ;; for scene inspection purposes...\n    (mat4.multiply (renderer-view r) (renderer-camera r) (renderer-world-to-screen r))\n    (mat4.multiply (renderer-view r) (renderer-camera r) view-camera)\n    (mat4.multiplyVec3 view-camera (vector 0 0 0) camera-pos)\n\n    (mat4.identity (renderer-top-tx r))\n\n    (when hook (js \"try{\") (hook) (js \"} catch(e) { \") (display e) (js \"}\"))\n\n    ;; immediate mode\n    (let ((ident (mat4.identity (mat4.create))))\n      (for-each\n       (lambda (p)\n\t (let ((state (car p))\n\t       (prim (cadr p)))\n\t   (primitive-render prim gl view-camera camera-pos state ident)))\n       (renderer-immediate-prims r))\n      \n      ;; retained mode\n      (scenegraph-render (renderer-scenegraph r) gl view-camera camera-pos ident))\n    (renderer-immediate-clear r)))\n\n(define (assemble-polyprim gl vertices normals texcoords)\n  (primitive\n   \'polyprim\n   (build-polyprim\n    gl \'triangles\n    (make-pdata \n     (list \"p\" \"n\" \"t\" \"c\") \n     (/ (length vertices) 4)\n     (pdata-interleave-pdata-util \n      (list vertices normals texcoords \n\t    (build-list (* (length vertices) 3) (lambda (_) 1)))))\n    )))\n\n;; todo - probably replace these with the import code path to simplify things...\n(define (renderer-build-prefab r)\n  (let ((gl (renderer-gl r)))\n    (renderer-modify-prefab\n     r\n     (list\n      (assemble-polyprim gl unit-cube-vertices unit-cube-normals unit-cube-texcoords)\n      (assemble-polyprim gl sphere-vertices sphere-normals sphere-texcoords)\n      (assemble-polyprim gl torus-vertices torus-normals torus-texcoords)\n      ))))\n\n(define (renderer-print r)\n  (scenegraph-print (renderer-scenegraph r) 0))\n", "flx/scm/fluxus.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(load \"flx/scm/base.jscm\")\n(load \"flx/scm/texture.jscm\")\n(load \"flx/scm/maths.jscm\")\n(load \"flx/scm/glsl.jscm\")\n(load \"flx/scm/state.jscm\")\n(load \"flx/scm/pdata.jscm\")\n(load \"flx/scm/scenegraph.jscm\")\n(load \"flx/scm/primitive.jscm\")\n(load \"flx/scm/data.jscm\")\n(load \"flx/scm/shaders.jscm\")\n(load \"flx/scm/renderer.jscm\")\n(load \"flx/scm/instanceprim.jscm\")\n(load \"flx/scm/polyprim.jscm\")\n(load \"flx/scm/geometry.jscm\")\n(load \"flx/scm/meshcache.jscm\")\n(load \"flx/scm/shadercache.jscm\")\n\n(define the-renderer 0)\n\n(define flx-start-time (js \"new Date().getTime()/1000\"))\n \n(define (time) \n  (let ((time-now (js \"new Date()\")))\n    (- (/ (time-now.getTime) 1000) \n       flx_start_time)))\n\n(define (push) (set! the-renderer (renderer-stack-dup the-renderer)))\n(define (pop) (set! the-renderer (renderer-stack-pop the-renderer)))\n\n;; due to the way with-primitive macro works, an unknown/bad\n;; primitive id with cause following state modifications to \n;; happen to the global state!!!\n(define (grab id) (set! the-renderer (renderer-grab-stack-push the-renderer id)))\n(define (ungrab) (set! the-renderer (renderer-grab-stack-pop the-renderer)))\n\n(define (identity)\n  (mat4.identity (renderer-current-tx the-renderer)))\n\n(define (translate v)\n  (mat4.translate (renderer-current-tx the-renderer) v))\n\n(define (rotate v)\n  (mat4.rotate (renderer-current-tx the-renderer) (* (vx v) 0.0174532925) (list 1 0 0))\n  (mat4.rotate (renderer-current-tx the-renderer) (* (vy v) 0.0174532925) (list 0 1 0))\n  (mat4.rotate (renderer-current-tx the-renderer) (* (vz v) 0.0174532925) (list 0 0 1)))\n\n(define aim-matrix (mat4.create))\n\n(define (maim v up)\n  (let ((l (vector 0 0 0))\n\t(u (vector 0 0 0)))\n    (vec3.cross v up l)\n    (vec3.cross v l u)\n\n    (js \"aim_matrix[0]=vx(v);\")\n    (js \"aim_matrix[1]=vy(v);\")\n    (js \"aim_matrix[2]=vz(v);\")\n    (js \"aim_matrix[3]=0;\")\n\n    (js \"aim_matrix[4]=vx(l);\")\n    (js \"aim_matrix[5]=vy(l);\")\n    (js \"aim_matrix[6]=vz(l);\")\n    (js \"aim_matrix[7]=0;\")\n\n    (js \"aim_matrix[8]=vx(u);\")\n    (js \"aim_matrix[9]=vy(u);\")\n    (js \"aim_matrix[10]=vz(u);\")\n    (js \"aim_matrix[11]=0;\")\n\n    (js \"aim_matrix[12]=0;\")\n    (js \"aim_matrix[13]=0;\")\n    (js \"aim_matrix[14]=0;\")\n    (js \"aim_matrix[15]=1;\")\n\n    (mat4.multiply (renderer-current-tx the-renderer) aim-matrix)))\n\n(define (concat m)\n    (mat4.multiply (renderer-current-tx the-renderer) m))\n\n(define (get-transform)\n  (renderer-current-tx the-renderer))\n\n(define (get-global-transform)\n  (renderer-global-tx the-renderer))\n\n(define (camera-transform)\n  (renderer-camera the-renderer))\n\n(define (set-camera-transform tx)\n  (set! the-renderer (renderer-modify-camera the-renderer tx)))\n\n(define (set-camera-angle a)\n  (set! the-renderer (renderer-modify-view-angle the-renderer a)))\n\n(define (get-camera-angle a)\n  (renderer-view-angle the-renderer))\n\n;;(define (vtransform m v)\n;; (mat4.multiplyVec3 m v))\n\n(define (clear-colour col)\n  (set! the-renderer (renderer-modify-clear-colour the-renderer col)))\n\n(define (view-transform)\n  (renderer-view the-renderer))\n\n;; returns the 2D screen coordinate of a 3D world space one\n(define (project-point p)\n  (let ((ret (list (vx p) (vy p) (vz p) 1))\n        (gl (renderer-gl the-renderer)))\n    (mat4.multiplyVec4 (renderer-world-to-screen the-renderer) ret)\n    (let ((z (list-ref ret 3)))\n      (vec3.create \n       (list (* (+ (/ (vx ret) z) 1) gl.viewportWidth 0.5)\n\t     (* (+ (/ (- 0 (vy ret)) z) 1) gl.viewportHeight 0.5)\n\t     0)))))\n\n(define (ndc-coords gl v z)\n  (list\n   (* 2 (- (/ (vx v) gl.viewportWidth) 1))\n   (* -2 (- (/ (vy v) gl.viewportHeight) 1))\n   z\n   1))\n\n(define (divide-w v)\n  (vector \n   (/ (vx v) (list-ref v 3))\n   (/ (vy v) (list-ref v 3))\n   (/ (vz v) (list-ref v 3))))\n\n;; returns the 3D line representing a screen space coordinate\n;; not yet working...\n(define (unproject-point p)\n  (let ((gl (renderer-gl the-renderer))\n\t(screen-to-world (minverse (renderer-world-to-screen the-renderer))))\n    (divide-w (mat4.multiplyVec4 screen-to-world (ndc-coords gl (list (vx p) (vy p)) 0)))))\n\n;; screen point to world coordinate\n(define (unproject-point-ortho pos)\n  ;; pos is in screen pixel space\n  ;; so divide to normalise (0 - 1)\n  (let ((scr-aspect (/ screen-width screen-height))\n\t(norm (vector (/ (vx pos) screen-width)\n\t\t      (/ (vy pos) screen-height)\n\t\t      0)))\n    ;; convert into ortho world coordinates but account for half scale\n    (let ((top (frustum-top (renderer-frustum the-renderer))))\n      (vector\n       (* (/ (- (vx pos) (/ screen-width 2)) screen-width) (* top scr-aspect 2))\n       (* (/ (- (/ screen-height 2) (vy pos)) screen-height) (* top 2)) \n       (* (vy norm) 0.1)))))\n\n(define (primitive-screen-pos p)\n  (project-point\n   (with-primitive p (mtransform (get-transform) (vector 0 0 0)))))\n\n(define (primitive-global-screen-pos p)\n  (project-point\n   (with-primitive p (mtransform (get-global-transform) (vector 0 0 0)))))\n\n(define (scale v)\n  (mat4.scale (renderer-current-tx the-renderer) v))\n\n(define (load-texture name)\n  (load-texture-impl!\n   (renderer-gl the-renderer)\n   (+ \"textures/\" name)))\n\n(define (texture name)\n  (set! the-renderer (renderer-modify-current-state\n           the-renderer\n           (lambda (state)\n             (state-modify-texture state name)))))\n\n(define (shader-compile name attrib-names vert frag)\n  (internal-load-shader-cache (renderer-gl the-renderer) name attrib-names vert frag))\n\n(define (shader-assign-compiled name)\n  (set! the-renderer \n\t(renderer-modify-current-state\n\t the-renderer\n           (lambda (state)\n             (state-modify-shader\n              state\n              (shader-cache-search name))))))\n\n(define (shader vert frag)\n  (set! the-renderer \n\t(renderer-modify-current-state\n\t the-renderer\n           (lambda (state)\n             (state-modify-shader\n              state\n              (build-shader (renderer-gl the-renderer) \n\t\t\t    (list \"p\" \"n\" \"t\" \"c\") vert frag))))))\n\n(define (shader-attrib-names names vert frag)\n  (set! the-renderer \n\t(renderer-modify-current-state\n\t the-renderer\n\t (lambda (state)\n\t   (state-modify-shader\n\t    state\n\t    (build-shader (renderer-gl the-renderer) names vert frag))))))\n\n;; setting uniforms - this one sets the unform for this shader program\n;; affecting all primitives using it\n(define (shader-shared-uniform! name type value)\n  (set! the-renderer \n\t(renderer-modify-current-state\n\t the-renderer\n           (lambda (state)\n\t     (let ((gl (renderer-gl the-renderer))\n\t\t   (shader (state-shader state)))\n\t       (gl.useProgram shader) \n\t       (internal-uniform! gl shader name type value)\n\t       state)))))\n\n;; setting uniforms - locally to this primitive state only\n(define (shader-uniform! name type value)\n  (set! the-renderer \n\t(renderer-modify-current-state\n\t the-renderer\n           (lambda (state)\n\t     (let ((gl (renderer-gl the-renderer)))\n\t       (state-modify-uniform-items\n\t\tstate (set-uniform-item\n\t\t       (make-uniform-item name type value)\n\t\t       (state-uniform-items state))))))))\n\n(define (colour col)\n  (set! the-renderer (renderer-modify-current-state\n           the-renderer\n           (lambda (state)\n             (state-modify-colour state col)))))\n\n(define (every-frame-impl hook)\n  (set! the-renderer (renderer-modify-hook the-renderer hook)))\n\n(define (draw-cube)\n  (set! the-renderer (renderer-immediate-add\n\t   the-renderer (list-ref (renderer-prefab the-renderer) 0))))\n\n(define (draw-sphere)\n  (set! the-renderer (renderer-immediate-add\n\t   the-renderer (list-ref (renderer-prefab the-renderer) 1))))\n\n(define (draw-torus)\n  (set! the-renderer (renderer-immediate-add\n\t   the-renderer (list-ref (renderer-prefab the-renderer) 2))))\n\n(define (draw-obj obj)\n  (set! the-renderer (renderer-immediate-add\n\t   the-renderer (list-ref (renderer-prefab the-renderer) obj))))\n\n(define (build-polygons type size-verts)\n  (let ((gl (renderer-gl the-renderer)))\n    (add-to-scenegraph!     \n     (primitive\n      \'polyprim\n      (build-empty-polyprim gl type size-verts)))))\n\n(define (set-hint! hint)\n  (set! the-renderer \n\t(renderer-modify-current-state\n\t the-renderer (lambda (state)\n\t     (state-modify-hints state (bitwise-or (state-hints state) hint))))))\n\n(define (clear-hints!)\n  (set! the-renderer \n\t(renderer-modify-current-state\n\t the-renderer (lambda (state)\n\t     (state-modify-hints state 0)))))\n\n(define (hint-none) (clear-hints!))\n(define (hint-solid) (set-hint! FLX_HINT_SOLID))\n(define (hint-wire) (set-hint! FLX_HINT_WIRE))\n(define (hint-ignore-depth) (set-hint! FLX_HINT_IGNORE_DEPTH))\n(define (hint-nozwrite) (set-hint! FLX_HINT_NOZWRITE))\n(define (hint-cullface) (set-hint! FLX_HINT_CULL_FACE))\n(define (hint-cullccw) (set-hint! FLX_HINT_CULL_CCW))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; loading meshes\n\n(define (load-primitive url)\n  (let ((gl (renderer-gl the-renderer))\n\t(raw (mesh-cache-search url)))\n    (add-to-scenegraph!     \n     (primitive\n      \'polyprim\n      (build-polyprim gl \'triangles raw)))))\n\n(define (load-ply-primitive url)\n  (let ((gl (renderer-gl the-renderer))\n\t(raw (mesh-cache-search url)))\n    (add-to-scenegraph!     \n     (primitive\n      \'polyprim\n      (build-polyprim gl \'triangles raw)))))\n\n;; (list\n;; \t(buffer gl \"p\" (list-ref raw 0) 3)\n;; \t(buffer gl \"n\" (list-ref raw 1) 3)\n;; \t(buffer gl \"t\" (list-ref raw 0) 3)\n;; \t))))))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; retained mode\n\n(define next-id 0)\n(define (new-id) \n  (set! next-id (+ next-id 1))\n  next-id)\n\n(define (parent id)\n  (set! the-renderer (renderer-modify-current-state\n           the-renderer\n           (lambda (state)\n             (state-modify-parent state id)))))\n\n(define (hide v)\n  (set! the-renderer (renderer-modify-current-state\n           the-renderer\n           (lambda (state)\n             (state-modify-hidden state v)))))\n\n(define (add-to-scenegraph! prim)\n  (let ((id (new-id)))\n    (set! the-renderer (renderer-modify-scenegraph\n\t     the-renderer \n\t     (scenegraph-add \n\t      (renderer-scenegraph the-renderer) \n\t      (state-parent (renderer-stack-top the-renderer)) ;; parent from state \n\t      (scenenode\n\t       id \n\t       (state-clone (renderer-stack-top the-renderer)) ;; stack\n\t       prim\n\t       \'() ;; children\n\t       ))))\n    id))\n\n(define (destroy id)\n  (set! the-renderer \n\t(renderer-modify-scenegraph\n\t the-renderer (scenegraph-remove \n\t\t       (renderer-scenegraph the-renderer) \n\t\t       id))))\n\n(define (apply-transform!)\n  (let ((tx (get-transform)))\n    (pdata-map!\n     (lambda (p)\n       (mtransform tx p))\n     \"p\"))\n  (identity))\n\n(define (build-cube)\n  (add-to-scenegraph! (list-ref (renderer-prefab the-renderer) 0)))\n\n(define (build-instance polyref)\n  (add-to-scenegraph! \n   (primitive \n    \'instanceprim \n    (instanceprim \n     (primitive-inner\n      (scenenode-primitive \n       (scenegraph-find \n\t(renderer-scenegraph the-renderer) \n\tpolyref)))))))\n\n(define (build-locator)\n  ;; locator is an empty primitive for positioning things \n  ;; in the scenegraph - we might want to add axis rendering\n  ;; for debugging\n  (add-to-scenegraph! \n   (primitive \'locatorprim 0)))\n\n(define (pdata-map! fn name)\n  (when (renderer-grabbed? the-renderer)\n\t(pdata-internal-map!\n\t (renderer-gl the-renderer) \n\t ;; todo: check type is polyprim\n\t (polyprim-pdata \n\t  (primitive-inner\n\t   (scenenode-primitive (renderer-grab-stack-top the-renderer))))\n\t fn name)))\n\n(define (pdata-index-map! fn name)\n  (when (renderer-grabbed? the-renderer)\n\t(pdata-internal-index-map!\n\t (renderer-gl the-renderer) \n\t ;; todo: check type is polyprim\n\t (polyprim-pdata \n\t  (primitive-inner\n\t   (scenenode-primitive (renderer-grab-stack-top the-renderer))))\n\t fn name)))\n\n(define (pdata-add! name)\n  (when (renderer-grabbed? the-renderer)\n\t ;; todo: check type is polyprim\n\t(let ((pp (primitive-inner\n\t\t   (scenenode-primitive (renderer-grab-stack-top the-renderer)))))\n\t  (pdata-internal-add!\n\t   (renderer-gl the-renderer) \n\t   (polyprim-pdata pp)\n\t   name))))\n\n(define (pdata-size)\n  (when (renderer-grabbed? the-renderer)\n\t;; todo: check type is polyprim\n\t(let ((pp (primitive-inner\n\t\t   (scenenode-primitive (renderer-grab-stack-top the-renderer)))))\n\t  (pdata-size-verts  \n\t   (polyprim-pdata pp)))))\n\n(define (pdata-set! name pos value)\n  (when (renderer-grabbed? the-renderer)\n\t ;; todo: check type is polyprim\n\t(let ((pp (primitive-inner\n\t\t   (scenenode-primitive (renderer-grab-stack-top the-renderer)))))\n\t  (pdata-internal-set!\n\t   (renderer-gl the-renderer) \n\t   (polyprim-pdata pp)\n\t   name (modulo pos (polyprim-size pp)) value))))\n\n(define (pdata-ref name pos)\n  (when (renderer-grabbed? the-renderer)\n\t ;; todo: check type is polyprim\n\t(let ((pp (primitive-inner\n\t\t   (scenenode-primitive (renderer-grab-stack-top the-renderer)))))\n\t  (pdata-internal-ref\n\t   (renderer-gl the-renderer) \n\t   (polyprim-pdata pp)\n\t   name (modulo pos (polyprim-size pp))))))\n\n;; new command to upload the vbo from the modified data - use for \n;; pdata-set! (maybe pdata-map! in the future???)\n(define (pdata-upload!)\n  (let ((grabbed (renderer-grab-stack-top the-renderer)))\n    (when grabbed\n\t  (pdata-update-vbo! \n\t   (renderer-gl the-renderer)\n\t   (polyprim-pdata\n\t    (primitive-inner\n\t     (scenenode-primitive grabbed)))))))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define t 0)\n(define stat-period 60)\n(define last-stat 0)\n\n(define (crank)\n  (outer-render))\n\n(define (debug-renderer)\n  (renderer-print the-renderer))\n\n(define (set-framerate-divide! v)\n  (set! framerate-divide v))\n\n(define framerate-divide 1)\n\n(define (outer-render timestamp)\n  (set! t (+ t 1))  \n  (when (zero? (modulo t framerate-divide))\n\t(set! the-renderer (renderer-render the-renderer))\n\t(set! stat-period (- stat-period 1))            \n\t(when (zero? stat-period)\n\t      (set! stat-period 60)\n\t      (set! current-fps (/ (- (Date.now) last-stat) stat-period))\n\t      ;;(console.log (+ \"FPS: \" (trunc (/ 1 (/ current-fps 1000)))))\n\t      (set! last-stat (Date.now))))\n  (window.requestAnimationFrame outer-render))\n\n(define (print-renderer-top)\n  (msg (renderer-stack-top the-renderer)))\n\n(define (ortho top)\n  (set! the-renderer \n\t(renderer-modify-frustum \n\t the-renderer \n\t (frustum #t top \n\t\t  (frustum-near (renderer-frustum the-renderer))\n\t\t  (frustum-far (renderer-frustum the-renderer))))))  \n\n(define (persp)\n  (set! the-renderer \n\t(renderer-modify-frustum \n\t the-renderer \n\t (frustum #f\n\t\t  (frustum-top frustum)\n\t\t  (frustum-near (renderer-frustum the-renderer))\n\t\t  (frustum-far (renderer-frustum the-renderer))))))\n\n\n(define (frustum-clip near far)\n  (set! the-renderer \n\t(renderer-modify-frustum \n\t the-renderer \n\t (frustum (frustum-ortho? (renderer-frustum the-renderer))\n\t\t  (frustum-top (renderer-frustum the-renderer))\n\t\t  near\n\t\t  far))))\n\n\n(define (clear)\n  (let ((canvas (document.getElementById \"webgl-canvas\")))\n    (let ((gl (canvas.getContext \"experimental-webgl\")))\n      (set! gl.viewportWidth canvas.width)\n      (set! gl.viewportHeight canvas.height)\n      (set! the-renderer (renderer gl))\n      ;; set up camera transform\n      (mat4.translate (renderer-camera the-renderer) (list 0 0 0))\n      (set! the-renderer (renderer-build-prefab the-renderer))\n      (gl.clearColor 0.0 0.0 0.0 1.0)\n      (gl.enable gl.DEPTH_TEST)\n      (gl.disable gl.CULL_FACE)\n      ;; make sure the default texture is loaded\n      (texture (load-texture \"white.png\"))\n      )))\n\n(define (resize-glcanvas canvas) \n  ;; ;; Lookup the size the browser is displaying the canvas.\n  ;; (let ((displayWidth canvas.clientWidth)\n  ;; \t(displayHeight canvas.clientHeight)) \n  ;;   ;; Check if the canvas is not the same size.\n  ;;   (when (or (not (eq? canvas.width displayWidth))\n  ;; \t      (not (eq? canvas.height displayHeight)))\n  ;; \t  ;; Make the canvas the same size\n  ;; \t  (set! canvas.width displayWidth)\n  ;; \t  (set! canvas.height displayHeight)\n  ;; \t  (let ((gl (canvas.getContext \"experimental-webgl\")))\n  ;; \t    (set! gl.viewportWidth canvas.width)\n  ;; \t    (set! gl.viewportHeight canvas.height))))\n  0\n  )\n\n(define (size-glcanvas canvas displayWidth displayHeight) \n  ;; Make the canvas the same size\n  (set! canvas.width displayWidth)\n  (set! canvas.height displayHeight)\n  (let ((gl (canvas.getContext \"experimental-webgl\")))\n    (set! gl.viewportWidth canvas.width)\n    (set! gl.viewportHeight canvas.height)))\n\n\n\n", "flx/scm/shadercache.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2018 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define shader-cache ())\n(define shaders-load-outstanding 0)\n(define shaders-total-load 0)\n\n(define (shaders-loaded?)\n  (eq? shaders-load-outstanding 0))\n\n(define (internal-load-shader-cache gl name attrib-names vert frag)\n  (set! shaders-load-outstanding (+ shaders-load-outstanding 1))\n  (set! shaders-total-load (+ shaders-total-load 1))\n  (load-resource-txt \n   vert\n   (lambda (vert-code)\n     (load-resource-txt\n      frag\n      (lambda (frag-code)\t\t\n\t(set! shaders-load-outstanding (- shaders-load-outstanding 1))\n\t(shader-cache-add gl name attrib-names vert-code frag-code))))))\n\n(define (shader-cache-add gl name attrib-names vert-code frag-code)\n  (set! shader-cache \n\t(cons \n\t (list name (build-shader gl attrib-names vert-code frag-code))\n\t shader-cache)))\n\n(define (shader-cache-search name)\n  (let ((shader (assoc name shader-cache)))\n    (cond \n     (shader (cadr shader)) ;; deep copy!?\n     (else \n      (msg (+ \"shader not loaded into cache in preload: \" name))\n      (wewe)))))\n\t\n", "flx/scm/base.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n;; basic scheme stuff we need, and some tests\n\n(define display (lambda (str) (console.log str)))\n(define newline (lambda () (console.log \"\\n\")))\n\n(define (ditto-print-list a)\n  (let ((str \"\"))\n    (set! str (+ str \"[\"))\n    (js \"for (var i=0; i<a.length; i++) {\")\n    (set! str (+ str (ditto-pretty-print (list-ref a i))))\n    (when (not (eq? i (- a.length 1))) (set! str (+ str \" \")))\n    (js \"}\")\n    (set! str (+ str \"]\"))\n    str))\n\n(define (ditto-pretty-print a)\n  (cond\n   ((list? a) (ditto-print-list a))\n   (else (+ \"\" a))))\n\n(define (msg a) \n  (console.log (ditto-pretty-print a)))\n\n(define (dbg a) (msg a) a)\n(define (error a) (msg a))\n\n(define (zero? n) (js \"n===0\"))\n(define (eqv? a b) (eq? a b))\n(define (equal? a b) (eq? a b))\n(define (floor n) (Math.floor n))\n(define (fmod a b) (js \"Number((a - (Math.floor(a / b) * b)).toPrecision(8));\"))\n(define (fabs x) (Math.abs x))\n(define (string->number x) (parseFloat x))\n\n(define (random n)\n  (Math.floor (* (Math.random) n)))\n\n(define (random-range a b)\n  (+ a (Math.floor (* (Math.random) (- b a)))))\n\n(define (rndf) (Math.random))\n\n(define (max a b) (if (> a b) a b))\n(define (min a b) (if (< a b) a b))\n\n(define (substring str s e)\n  (js \"str.substring(s, e);\"))\n\n(define (string-length str)\n  (js \"str.length\"))\n\n(define (string->list str)\n  (str.split \"\"))\n\n(define (string-ref str i)\n  (js \"str[i]\"))\n\n;; replaced by underlying iterative version\n;;(define foldl\n;;  (lambda (fn v l)\n;;    (cond\n;;     ((null? l) v)\n;;     (else (foldl fn (fn (car l) v) (cdr l))))))\n\n;; replaced by underlying iterative version\n;; (define (list-contains? l v)\n;;   (cond\n;;     ((null? l) #f)\n;;     ((eq? (car l) v) #t)\n;;     (else (list-contains? (cdr l) v))))\n\n(define map\n  (lambda (fn l)\n    (foldl\n     (lambda (i r)\n       (append r (list (fn i))))\n     () l)))\n\n(define map2\n  (lambda (fn l l2)\n    (foldl\n     (lambda (a b r)\n       (append r (list (fn a b))))\n     () l l2)))\n\n(define filter\n  (lambda (fn l)\n    (foldl\n     (lambda (i r)\n       (if (fn i) (append r (list i)) r))\n     \'() l)))\n\n(define (list-remove l i)\n  (filter (lambda (a) (not (eq? a i))) l))\n\n(define for-each\n  (lambda (fn l)\n    (foldl\n     (lambda (i r)\n       (fn i))\n     ()\n     l) #f))\n\n(define (assoc k l)\n  (foldl\n   (lambda (i r)\n     (if (eq? (car i) k) i r))\n   #f l))\n\n;; index versions provide count for first argument\n\n(define index-foldl\n  (lambda (fn s l)\n    (cadr (foldl\n           (lambda (e r)\n             (list\n              (+ (car r) 1)\n              (fn (car r) e (cadr r))))\n           (list 0 s)\n           l))))\n\n\n(define index-map\n  (lambda (fn l)\n    (cadr (foldl\n           (lambda (e r)\n             (list\n              (+ (car r) 1)\n              (append (cadr r) (list (fn (car r) e)))))\n           (list 0 ())\n           l))))\n\n(define index-for-each\n  (lambda (fn l)\n    (foldl\n     (lambda (e r)\n       (fn r e)\n       (+ r 1))\n     0 l)))\n\n;; fix js modulo irt negative numbers\n(define (modulo m n) (js \"((m%n)+n)%n\"))\n(define (quotient m n) (Math.floor (/ m n)))\n\n(define (sin a) (Math.sin a))\n(define (cos a) (Math.cos a))\n\n(define list-equal?\n  (lambda (a b)\n    (define _\n      (lambda (a b)\n        (cond\n         ((null? a) #t)\n         ((not (eq? (car a) (car b))) #f)\n         (else (_ (cdr a) (cdr b))))))\n    (if (eq? (length a) (length b))\n        (_ a b) #f)))\n\n;; replaced by js version\n;;(define build-list\n;;  (lambda (n fn)\n;;    (define _\n;;      (lambda (i)\n;;        (cond\n;;         ((eq? i (- n 1)) ())\n;;         (else\n;;          (cons (fn n) (_ (+ i 1) fn))))))\n;;    (_ 0)))\n\n(define print-list\n  (lambda (l)\n    (when (not (null? l))\n          (console.log (car l))\n          (print-list (cdr l)))))\n\n(define reverse\n  (lambda (l)\n    (cond\n     ((null? l) ())\n     (else\n      (append (reverse (cdr l)) (list (car l)))))))\n\n(define (choose l)\n  (list-ref l (random (length l))))\n\n(define (delete-n l n)\n  (if (eq? n 0)\n      (cdr l)\n      (append (list (car l)) (delete-n (cdr l) (- n 1)))))\n\n(define (shuffle l)\n  (cond ((null? l) ())\n        ((< (length l) 2)\n         (list (car l)))\n        (else\n         (let ((item (random (length l))))\n           (cons (list-ref l item)\n                 (shuffle (delete-n l item)))))))\n\n(define (crop l n)\n  (cond\n   ((null? l) ())\n   ((zero? n) ())\n   (else (cons (car l) (crop (cdr l) (- n 1))))))\n\n;; return (picked left-over)\n(define (pick-out-of l n)\n  (define (_ p l n)\n    (cond\n      ((or (null? l) (zero? n))\n       (list p l))\n      (else\n       (let ((item (random (length l))))\n         (_\n          (cons (list-ref l item) p)\n          (delete-n l item)\n          (- n 1))))))\n  (_ () l n))\n\n(define factorial\n  (lambda (n)\n    (if (= n 0) 1\n        (* n (factorial (- n 1))))))\n\n\n(define (symbol->string sym)\n  sym);; (ditto.symbol_string sym))\n\n(define (string->symbol str)\n  ;(ditto.find_symbol str)\n  str)\n\n;; convert code to text form\n; (define (scheme-txt v)\n;  (cond\n;   ((number? v) v)\n;   ((string? v) (string-append \"\\\"\" v \"\\\"\"))\n;   ((boolean? v) (if v \"#t\" \"#f\"))\n;   ((list? v)\n;    (cond\n;     ((null? v) \"()\")\n;     (else\n;      (list-txt v))))\n;   (else (msg (+ \"scheme->txt, unsupported type for \" v)))))\n;\n;(define (list-txt l)\n;  (define (_ l s)\n;    (cond\n;     ((null? l) s)\n;     (else\n;      (_ (cdr l)\n;         (string-append\n;          s\n;          (if (not (eq? s \"\")) \" \" \"\")\n;          (scheme-txt (car l)))))))\n;  (string-append \"(list \" (_ l \"\") \")\"))\n\n(define (assert condition message) \n  (when (not condition) \n\t(js \"; throw message || \'assertion failed\';\")))\n\n(define unit-test\n  (lambda ()\n    (define a 0)\n    (set! a 10)\n    (when (not (eq? 4 4)) (display \"eq? failed\"))\n    (when (eq? 2 4) (display \"eq?(2) failed\"))\n    (when (not (eq? (car (list 3 2 1)) 3)) (display \"car failed\"))\n    (when (not (eq? (cadr (list 3 2 1)) 2)) (display \"cadr failed\"))\n    (when (not (eq? (caddr (list 3 2 1)) 1)) (display \"caddr failed\"))\n\n    (when (not (eq? (begin 1 2 3) 3)) (display \"begin failed\"))\n    (when (not (eq? (list-ref (list 1 2 3) 2) 3)) (display \"list-ref failed\"))\n    (when (not (list? (list 1 2 3))) (display \"list? failed\"))\n    (when (list? 3) (display \"list?(2) failed\"))\n    (when (null? (list 1 2 3)) (display \"null? failed\"))\n    (when (not (null? (list))) (display \"null?(2) failed\"))\n    (when (not (eq? (length (list 1 2 3 4)) 4)) (display \"length failed\"))\n    (when (not (list-equal? (list 1 2 3 4) (list 1 2 3 4))) (display \"list-equal failed\"))\n    (when (list-equal? (list 1 2 3 4) (list 1 4 3 4)) (display \"list-equal(2) failed\"))\n    (when (not (list-equal? (append (list 1 2 3) (list 4 5 6)) (list 1 2 3 4 5 6)))\n          (display \"append failed\"))\n    (when (not (list-equal? (cdr (list 3 2 1)) (list 2 1))) (display \"cdr failed\"))\n    (when (not (list-equal? (cons 1 (list 2 3)) (list 1 2 3))) (display \"cons failed\"))\n    (when (not (eq? (foldl (lambda (a r) (+ a r)) 0 (list 1 2 1 1)) 5))\n          (display \"fold failed\"))\n    (when (not (eq? (foldl (lambda (a b r) (+ a b r)) 0 (list 1 2 1 1) (list 2 2 5 5)) 19))\n          (display \"fold multiple failed\"))\n    (when (not (list-equal? (map (lambda (i) (+ i 1)) (list 1 2 3 4)) (list 2 3 4 5)))\n          (display \"map failed\"))\n    (when (not (eq? (let ((a 1) (b 2) (c 3)) (+ a b c)) 6)) (display \"let failed\"))\n    (when (not (eq? (let ((a 1) (b 2) (c 3)) (list 2 3) (+ a b c)) 6)) (display \"let(2) failed\"))\n    (when (not (eq? a 10)) (display \"set! failed\"))\n    (when (not (eq? (factorial 10) 3628800)) (display \"factorial test failed\"))\n    (when (not (eq? (list-ref (list-replace (list 1 2 3) 2 4) 2) 4)) (display \"list-replace failed\"))\n    (when (not (list-equal? (build-list 10 (lambda (n) n)) (list 0 1 2 3 4 5 6 7 8 9)))\n          (display \"build-list failed\"))\n    (when (eq? (not (+ 200 3)) 203) (display \"+ failed\"))\n    (when (not (eq? (cond (#t (+ 3 2) (+ 100 1)) (else (+ 4 3))) 101)) (display \"cond test failed\"))\n    (when (not (eq? (when #t (+ 3 2) (+ 100 1)) 101)) (display \"when test failed\"))\n    (when (not (eq? (cadr (assoc 2 (list (list 3 \"one\") (list 2 \"three\")))) \"three\")) (display \"assoc test failed\"))\n    (when (not (eq? (symbol->string \'one) \"one\")) (display \"symbol->string failed\"))\n    ;;(when (not (eq? (string->symbol \"one\") \'one)) (display \"string->symbol failed\"))\n    ;;(msg (string->symbol \"one\"))\n    ;;(msg \'one)\n    ))\n\n(unit-test)\n", "shaders/default.frag": "precision highp float;\nuniform sampler2D texture;\nuniform vec3 DiffuseColour;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 C;\nvarying vec3 N;\nvarying vec3 L;\n\nvoid main() {\n    vec3 l = normalize(L);\n    vec3 n = normalize(N);\n    float diffuse = 1.0; //dot(vec3(0,0,1),n);\n\n    if(texture2D(texture, vec2(T.s, T.t)).a == 0.0) {\n        discard;\n    }\n\n    gl_FragColor = vec4(0.0,1.0,0.0,1.0);\n    \t\t //vec4(texture2D(texture, vec2(T.s, T.t)).xyz *\n                 //           DiffuseColour*C*diffuse, \n                 //       texture2D(texture, vec2(T.s, T.t)).a);\n}\n", "flx/scm/shaders.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n (define vertex-shader\n  \"\nprecision highp float;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 C;\nvarying vec3 N;\nvarying vec3 L;\nuniform mat4 ModelViewMatrix;\nuniform mat4 NormalMatrix;\nuniform vec3 CameraPos;\nattribute vec3 p;\nattribute vec3 t;\nattribute vec3 n;\nattribute vec3 c;\n\nvoid main()\n{\n    P = p.xyz;\n    T = t;\n    C = c;\n    L = vec3(vec3(-50,-150,-100)-p); \n    N = normalize(vec3(NormalMatrix*vec4(n,1)));\t\n    gl_Position = ModelViewMatrix * vec4(p,1);\n}\")\n\n(define fragment-shader\n  \"\nprecision highp float;\nuniform sampler2D texture;\nuniform float Ambient;\nuniform vec3 DiffuseColour;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 C;\nvarying vec3 N;\nvarying vec3 L;\n\nvoid main() {\n    vec3 l = normalize(L);\n    vec3 n = normalize(N);\n    float diffuse = Ambient+dot(l,n)*(1.0-Ambient);\n\n    if(texture2D(texture, vec2(T.s, T.t)).a == 0.0) {\n        discard;\n    }\n\n    gl_FragColor = vec4(texture2D(texture, vec2(T.s, T.t)).xyz *\n                            DiffuseColour*C*diffuse, \n                        texture2D(texture, vec2(T.s, T.t)).a);\n}\n\")\n\n\n\n\n\n\n\n(define fragment-shader-spec\n  \"\nprecision mediump float;\nuniform sampler2D texture;\nuniform vec3 DiffuseColour;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 N;\nvarying vec3 L;\n\nvoid main() {\n    vec3 l = normalize(L);\n    vec3 n = normalize(N);\n    float diffuse = min(1.0,dot(vec3(0.8,0.8,0),n));\n    float diffuse2 = max(0.1,dot(vec3(0,1,0),n));\n    gl_FragColor = vec4(texture2D(texture, vec2(T.s, T.t)).xyz *\n                                (DiffuseColour*diffuse + \n\t\t\t\tvec3(1,0.5,0.2)*diffuse2*0.1), 1.0);\n\t\t\t\t\n}\n\")\n\n;;                        (vec3(0,0,1) + \n;;                        step(1.0,length(P))*vec3(0,0.5,0)+\n;;                        step(1.005,length(P))*vec3(0.5,0,0)+\n;;                        step(1.02,length(P))*vec3(1,1,1))*0.75\n\n\n\n (define vertex-organism\n  \"\nprecision mediump float;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 N;\nvarying vec3 L;\nuniform mat4 ModelViewMatrix;\nuniform mat4 NormalMatrix;\nuniform vec3 CameraPos;\nattribute vec3 p;\nattribute vec3 t;\nattribute vec3 n;\n\nvoid main()\n{\n    P = p.xyz;\n    T = t;\n    L = vec3(0,1,0); /* vec3(ModelViewMatrix*vec4((vec3(0,10,0)-p),1)); */\n    N = normalize(vec3(NormalMatrix*vec4(n,1)));\t\n    gl_Position = ModelViewMatrix * vec4(p,1);\n}\")\n\n(define fragment-organism\n  \"\nprecision mediump float;\nuniform sampler2D texture;\nuniform vec3 DiffuseColour;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 N;\nvarying vec3 L;\n\nvoid main() {\n\n    vec3 l = normalize(L);\n    vec3 n = normalize(N);\n    float diffuse = clamp(dot(vec3(0,1,0),n),0.5,1.0); \n\n    gl_FragColor = vec4(texture2D(texture, vec2(T.s, T.t)).xyz *\n                            DiffuseColour*diffuse, 1.0);\n\n/*    gl_FragColor = vec4(texture2D(texture, vec2(T.s, T.t)).xyz *\n                            DiffuseColour, 1.0);\n*/\n}\n\")\n\n\n (define vertex-disc\n  \"\nprecision mediump float;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 N;\nvarying vec3 L;\nvarying vec3 C;\nuniform mat4 ModelViewMatrix;\nuniform mat4 NormalMatrix;\nuniform vec3 CameraPos;\nattribute vec3 p;\nattribute vec3 t;\nattribute vec3 n;\nattribute vec3 c;\n\nvoid main()\n{\n    P = p.xyz;\n    T = t;\n    C = c;\n    L = vec3(0,1,0); /* vec3(ModelViewMatrix*vec4((vec3(0,10,0)-p),1)); */\n    N = normalize(vec3(NormalMatrix*vec4(n,1)));\t\n    gl_Position = ModelViewMatrix * vec4(p,1);\n}\")\n\n(define fragment-disc\n  \"\nprecision mediump float;\nuniform sampler2D texture;\nuniform vec3 DiffuseColour;\nvarying vec3 P;\nvarying vec3 T;\nvarying vec3 N;\nvarying vec3 L;\nvarying vec3 C;\n\nvoid main() {\n    vec3 l = normalize(L);\n    vec3 n = normalize(N);\n    float diffuse = min(1.0,dot(vec3(0,1,0),n)+1.5);\n    gl_FragColor = vec4(texture2D(texture, vec2(T.s, T.t)).xyz *\n                            C*DiffuseColour*diffuse, 1.0);\n\n}\n\")\n", "flx/scm/canvas.jscm": ";; -*- mode: scheme; -*-\n;; Viruscraft Copyright (C) 2018 FoAM Kernow\n\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define screen-width 0)\n(define screen-height 0)\n\n(define canvas-mouse-x 0)\n(define canvas-mouse-y 0)\n(define canvas-mouse-state 0)\n(define canvas-mouse-zoom 0)\n(define canvas-mouse-zoom-delta 0)\n(define canvas-drag-x 0)\n(define canvas-drag-y 0)\n(define canvas-is-dragging #f)\n(define canvas-drag-fn (lambda () 0))\n(define canvas-mouse-clicked #f)\n\n(define canvas-event-occurred #f)\n\n(define webgl-canvas (document.getElementById \"webgl-canvas\"))\n;;(define canvas (document.getElementById \"canvas\"))\n;;(define ctx (canvas.getContext \"2d\"))\n\n(define canvas-timeout-trigger (* 2 60))\n(define canvas-timeout-time 0)\n(define canvas-delta 0)\n(define canvas-time (js \"new Date()\"))\n\n(define (canvas-update-time)\n  ;;(set! canvas-timeout-time (+ canvas-timeout-time canvas-delta))\n  ;;(when (> timeout-time timeout-trigger)\n  ;;\t(window.location.reload))\n  (let ((delta (/ (- (js \"new Date()\") canvas-time) 1000.0)))\n    ;; cap delta in case window, and rendering is paused for a while\n    (set! canvas-delta (min 0.5 delta)))\n\t      \n  (set! canvas-time (js \"new Date()\")))\n\n(define (set-canvas-drag-fn fn)\n  (set! canvas-drag-fn fn))\n\n(define canvas-font \"Arial\")\n(define (set-font! f) (set! canvas-font f))\n\n(define (canvas-init-defaults)\n  (set! ctx.fillStyle \"#000\")\n  (set! ctx.font (string-append \"30pt \" canvas-font)))\n\n(define (resize-canvas canvas) \n  ;; Lookup the size the browser is displaying the canvas.\n  ;; (let ((displayWidth canvas.clientWidth)\n  ;; \t(displayHeight canvas.clientHeight)) \n  ;;   ;; Check if the canvas is not the same size.\n  ;;   (when (or (not (eq? canvas.width displayWidth))\n  ;; \t      (not (eq? canvas.height displayHeight))\n  ;; \t      (zero? screen-width)\n  ;; \t      (zero? screen-height))\n  ;; \t  ;; Make the canvas the same size\n  ;; \t  (set! canvas.width displayWidth)\n  ;; \t  (set! canvas.height displayHeight)\n  ;; \t  (set! screen-width canvas.width)\n  ;; \t  (set! screen-height canvas.height)\n  ;; \t  (canvas-init-defaults)))\n  \n  (set! screen-width canvas.width)\n  (set! screen-height canvas.height)\n\n  )\n\n(set! window.onresize \n      (lambda ()\n\t(resize-canvas canvas)))\n\n(define (mouse-from-event canvas e state)\n  (let ((rect (canvas.getBoundingClientRect)))\n    (let ((sx (/ rect.width screen-width))\n          (sy (/ rect.height screen-height)))\n      (let ((nx (/ (- e.clientX rect.left) sx))\n\t    (ny (/ (- e.clientY rect.top) sy)))\n\t\n\t;; deal with dragging\n\t(when (and canvas-is-dragging (not canvas-event-occurred))\n\t      (set! canvas-drag-x (- nx canvas-mouse-x))\n\t      (set! canvas-drag-y (- ny canvas-mouse-y))\n\t      (canvas-drag-fn))      \n\n\t(set! canvas-event-occurred #f)\n\n\t(cond \n\t ((and (eq? state \"move\") (eq? canvas-mouse-state \"down\"))\n\t  ;; starting drag\n\t  (set! canvas-is-dragging #t))\n\t ((and canvas-is-dragging (eq? state \"up\"))\n\t  ;; ending drag\n\t  (set! canvas-is-dragging #f))\n\t (else 0))\n\t\n\t(set! canvas-mouse-x nx)\n\t(set! canvas-mouse-y ny)\n\n\t(if (and (eq? state \"down\") (not (eq? canvas-mouse-state \"down\")))\n\t    (set! canvas-mouse-clicked #t)\n\t    (set! canvas-mouse-clicked #f))\n\n\t(set! canvas-mouse-state state)))))\n\n(define (touch-from-event canvas e state)\n  (let ((e (car e.targetTouches)))\n    (mouse-from-event canvas e state)))\n\n(define (canvas-zoom e)\n  (let ((delta (if e.wheelDelta (/ e.wheelDelta 40) \n\t\t   (if e.detail (- e.detail) 0))))\n    (set! canvas-mouse-zoom-delta delta)\n    (set! canvas-mouse-zoom (+ canvas-mouse-zoom delta))\n    (e.preventDefault)))\n\n(define image-lib ())\n(define loaded-images #f)\n\n(define (canvas-loaded?)\n  loaded-images)\n\n(define (find-image fn l)\n  (cond\n   ((null? l) #f)\n   ((eq? (car (car l)) fn) (cadr (car l)))\n   (else (find-image fn (cdr l)))))\n\n(define (load-image! fn finished images)\n  (let ((image (js \"new Image()\")))\n    (set! image.onload\n          (lambda ()\t    \n\t    (console.log (+ \"loaded \" (+ \"images/\" fn)))\n            (set! image-lib (cons (list fn image) image-lib))\n            (when (eq? (length image-lib)\n                       (length images))\n\t\t  (set! loaded-images #t)\n                  (finished))))\n    (set! image.src (+ \"images/\" fn))))\n\n(define (load-images! l finished)\n  (for-each\n   (lambda (fn)\n     (load-image! fn finished l))\n   l))\n\n(define sound-lib ())\n\n(define (load-sounds! l)\n  (for-each\n   (lambda (fn)\n     (set! sound-lib\n           (cons (list fn (new Audio (string-append \"sounds/\" fn)))\n                 sound-lib)))\n   l))\n\n(define (inner_find-sound fn l)\n  (cond\n   ((null? l) #f)\n   ((eq? (car (car l)) fn) (cadr (car l)))\n   (else (inner_find-sound fn (cdr l)))))\n\n(define (find-sound fn)\n  (inner_find-sound fn sound-lib))\n\n(define game-mute #f)\n\n(define (play-sound sound)\n  (when (not game-mute) \n        (let ((snd (find-sound sound)))\n          (snd.play))))\n\n(define (play-sound-looped sound)\n  (when (not game-mute)\n        (let ((snd (find-sound sound)))\n          (if (eq? (js \"typeof snd.loop\") \"boolean\")\n              (set! snd.loop true)\n              (snd.addEventListener\n               \"ended\" (lambda ()\n                         (set! snd.currentTime 0)\n                         (snd.play)) #f))\n          (snd.play))))\n\n(define (stop-sound sound)\n  (when (game-mute game)\n        (let ((snd (find-sound sound)))\n          (snd.pause))))\n\n\n(define (mousedown-handler e) (mouse-from-event canvas e \"down\"))\n(define (touchstart-handler e) (touch-from-event canvas e \"down\"))\n(define (mousemove-handler e) (mouse-from-event canvas e \"move\"))\n(define (touchmove-handler e) \n  (e.preventDefault)\n  (touch-from-event canvas e \"move\"))\n(define (mouseup-handler e) (mouse-from-event canvas e \"up\"))\n(define (DOMMouseWheel-handler e) (mouse-from-event canvas e \"down\"))\n(define (mousewheel-handler e) (mouse-from-event canvas e \"down\"))\n\n(define (canvas-setup)\n  (canvas.addEventListener \"mousedown\" mousedown-handler)\n  (canvas.addEventListener \"touchstart\" touchstart-handler)\n  (canvas.addEventListener \"mousemove\" mousemove-handler)\n  (canvas.addEventListener \"touchmove\" touchmove-handler)      \n  (canvas.addEventListener \"mouseup\" mouseup-handler)\n;;  (canvas.addEventListener\n;;   \"touchend\" (lambda (e) (mouse-from-event canvas e \"up\")))\n;;  (canvas.addEventListener\n;;   \"touchcancel\" (lambda (e) (mouse-from-event canvas e \"up\")))\n  (canvas.addEventListener \"DOMMouseScroll\" canvas-zoom)\n  (canvas.addEventListener \"mousewheel\" canvas-zoom)\n\n  )\n\n", "flx/scm/geometry.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define (point2-in-triangle? point a b c)\n  (define (sign2 a b c)\n    (- (* (- (vx a) (vx c)) \n\t  (- (vy b) (vy c))) \n       (* (- (vx b) (vx c)) \n\t  (- (vy a) (vy c)))))\n  (let ((b1 (< (sign2 point a b) 0))\n\t(b2 (< (sign2 point b c) 0))\n\t(b3 (< (sign2 point c a) 0)))\n    (and (eq? b1 b2) (eq? b2 b3))))\n\n(define (point3->barycentric point a b c)\n  (let ((v0 (vsub b a))\n\t(v1 (vsub c a))\n\t(v2 (vsub point a)))\n    (let ((d00 (vdot v0 v0))\n\t  (d01 (vdot v0 v1))\n\t  (d11 (vdot v1 v1))\n\t  (d20 (vdot v2 v0))\n\t  (d21 (vdot v2 v1)))\n      (let ((denom (- (* d00 d11) (* d01 d01))))\n\t(let ((v (/ (- (* d11 d20) (* d01 d21)) denom))\n\t      (w (/ (- (* d00 d21) (* d01 d20)) denom)))\n\t  (list v w (- 1 v w)))))))\n\n(define (barycentric->trilinear point a b c)\n  (vector\n   (/ (vx point) (vdist b c))\n   (/ (vy point) (vdist c a))\n   (/ (vz point) (vdist a b))))\n\n(define (geometry-unit-test)\n  (assert (point2-in-triangle? (vector 0.5 0.5 0) (vector 0 0 0) (vector 3 0 0) (vector 0 3 0)) \"point in triangle 1\")\n  (assert (not \n\t   (point2-in-triangle? (vector 5 0.5 0) (vector 0 0 0) (vector 3 0 0) (vector 0 3 0))) \"point in triangle 2\")\n  (assert (veq? (vector 0.3333333333333333 -0.3333333333333333 1)\n\t\t(point3->barycentric (vector 0 0 0) (vector 1 0 0) (vector 0 3 0) (vector 3 3 0))) \"barycentric 1\")\n  (assert (veq? (vector 1 0 0)\n\t\t(point3->barycentric (vector 0 0 0) (vector 0 0 0) (vector 3 0 0) (vector 0 3 0))) \"barycentric 2\")  \n  )\n\n(geometry-unit-test)\n", "scm/generators.jscm": ";; -*- mode: scheme; -*-\n\n;; Penelope Project Software Copyright (C) 2020 FoAM Kernow\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(define (make-tabby-draft w h)\n  (define (r x y)\n    (if (zero? x)\n        \'()\n        (cons\n         (if (if (zero? (modulo y 2))\n                 (zero? (modulo x 2))\n                 (zero? (modulo (+ x 1) 2))) 1 0)\n         (r (- x 1) y))))\n  (if (zero? h)\n      \'()\n      (cons\n       (r w h)\n       (make-tabby-draft w (- h 1)))))\n\n(define (make-basket-draft w h)\n  (define (r x y)\n    (if (zero? x)\n        \'()\n        (cons\n         (if (if (<= x (/ w 2))\n                 (<= y (/ h 2))\n                 (> y (/ h 2)))\n             1 0)\n         (r (- x 1) y))))\n  (define (c x y)\n    (if (zero? y)\n        \'()\n        (cons\n         (r x y)\n         (c x (- y 1)))))\n  (c w h))\n\n(define (make-twill-draft w h)\n  (define (r x y)\n    (if (zero? x)\n        \'()\n        (cons\n         (if (and (< x (+ (/ w 2) y))\n                  (>= x y)) 1 0)\n         (r (- x 1) y))))\n  (define (c x y)\n    (if (zero? y)\n        \'()\n        (cons\n         (r x y)\n         (c x (- y 1)))))\n  (c w h))\n\n(define (make-random-draft w h)\n  (define (r x y)\n    (if (zero? x)\n        \'()\n        (cons\n         (random 2)\n         (r (- x 1) y))))\n  (if (zero? h)\n      \'()\n      (cons\n       (r w h)\n       (make-random-draft w (- h 1)))))\n\n(define (generate type)\n  (msg type)\n  (cond\n   ((eq? type \"tabby\")\n    (make-tabby-draft (read-number \"warp-threads\")\n\t\t      (read-number \"weft-threads\")))\n   ((eq? type \"basket\")\n    (make-basket-draft (read-number \"warp-threads\")\n\t\t      (read-number \"weft-threads\")))\n   ((eq? type \"twill\")\n    (make-twill-draft (read-number \"warp-threads\")\n\t\t      (read-number \"weft-threads\")))\n   ((eq? type \"random\")\n    (make-random-draft (read-number \"warp-threads\")\n\t\t       (read-number \"weft-threads\")))\n   (else\n    (make-tabby-draft (read-number \"warp-threads\")\n\t\t      (read-number \"weft-threads\")))))\n", "flx/scm/maths.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n(js \"var sin=Math.sin\")\n(js \"var cos=Math.cos\")\n(js \"var tan=Math.tan\")\n(js \"var pi = Math.PI\")\n(js \"var two_pi = Math.PI*2\")\n\n(define (sqrt a) (Math.sqrt a))\n(define (pow a b) (Math.pow a b))\n(define (square x) (* x x))\n(define (trunc x) (js \"~~x\"))\n(define (feq? a b) (< (Math.abs (- a b)) Number.EPSILON))\n(define (abs x) (Math.abs x))\n(define (exp x) (Math.exp x))\n\n(define (lerp a b t)\n  (+ a (* (- b a) t)))\n\n(define (clamp v min max)\n  (cond\n   ((< v min) min)\n   ((> v max) max)   \n   (else v)))\n\n(define (vector x y z) (list x y z))\n\n(define (vx v) (list-ref v 0))\n(define (vy v) (list-ref v 1))\n(define (vz v) (list-ref v 2))\n(define (vw v) (list-ref v 3))\n\n(define (veq? a b) \n  (and (feq? (vx a) (vx b))\n       (feq? (vy a) (vy b))\n       (feq? (vz a) (vz b))))\n\n(define (vector-clone v)\n  (vector (vx v) (vy v) (vz v)))\n\n(define (vadd a b)\n  (vector (+ (vx a) (vx b))\n          (+ (vy a) (vy b))\n          (+ (vz a) (vz b))))\n\n(define (vmag v)\n  (sqrt (+ (square (vx v))\n           (square (vy v))\n           (square (vz v)))))\n\n(define (vsub a b)\n  (vector (- (vx a) (vx b))\n          (- (vy a) (vy b))\n          (- (vz a) (vz b))))\n\n(define (vneg a)\n  (vector (- 0 (vx a))\n          (- 0 (vy a))\n          (- 0 (vz a))))\n\n(define (vmul v a)\n  (vector (* (vx v) a) (* (vy v) a) (* (vz v) a)))\n\n(define (vdiv v a)\n  (vector (/ (vx v) a) (/ (vy v) a) (/ (vz v) a)))\n\n(define (vdist a b)\n  (vmag (vsub a b)))\n\n(define (vdist-squared a b)\n  (let ((v (vsub a b)))\n    (+ (square (vx v))\n       (square (vy v))\n       (square (vz v)))))\n\n(define (vlerp v1 v2 t)\n\t(vadd v1 (vmul (vsub v2 v1) t)))\n\n(define (vnormalise v)\n  (vdiv v (vmag v)))\n\n(define (vdot a b)\n  (+ (* (vx a) (vx b)) \n     (* (vy a) (vy b))\n     (* (vz a) (vz b))))\n\n(define (vcross a b)\n  (vector (- (* (vy a) (vz b)) (* (vz a) (vy b)))\n\t  (- (* (vz a) (vx b)) (* (vx a) (vz b)))\n\t  (- (* (vx a) (vy b)) (* (vy a) (vx b)))))\n\n(define (rndvec) (vector (rndf) (rndf) (rndf)))\n(define (crndvec) (vsub (rndvec) (vector 0.5 0.5 0.5)))\n(define (crndf) (- (rndf) 0.5))\n\n(define (hcrndvec s)\n  (let ((a (* (rndf) 360)))\n    (vector (* s (sin a)) (* s (cos a)) 0)))\n\n;; steal quats from the gl library\n(define rad-conv 0.017453292)\n\n(define (quat x y z w) (quat4.create (list x y z w)))\n\n(define (qaxisangle axis angle)\n  (let ((angle (* angle 0.017453292)))\n    (let ((axis (vmul (vnormalise axis) (sin (/ angle 2)))))\n      (quat (vx axis) (vy axis) (vz axis) (cos (/ angle 2))))))\n\n(define (qaxisanglerad axis angle)\n  (let ((axis (vmul (vnormalise axis) (sin (/ angle 2)))))\n    (quat (vx axis) (vy axis) (vz axis) (cos (/ angle 2)))))\n\n(define (qnormalise q)  (quat4.normalise q))\n(define (qmul a b) (quat4.multiply a b))\n(define (qmulvec q v) (quat4.multiplyVec3 q v))\n(define (q->m q) (quat4.toMat4 q))\n(define (qslerp a b t) \n  (let ((r (quat 0 0 0 0)))\n    (quat4.slerp a b t r)))\n\n;; note - operations (and above) destructive but faster - todo: fix\n\n(define (midentity) (mat4.identity (mat4.create)))\n(define (minverse m) (mat4.inverse m))\n(define (mmul a b) (mat4.multiply a b))\n(define (mtransform m v) (mat4.multiplyVec3 m v))\n(define (mtranslate m v) (mat4.translate m v))\n(define (mscale m v) (mat4.scale m v))\n(define (mrotate m axis angle) (mat4.rotate m angle axis))\n\n\n(define (maim2 m v up)\n  (let ((l (vector 0 0 0))\n\t(u (vector 0 0 0))\n        (aim-matrix (mat4.create)))\n    (vec3.cross v up l)\n    (vec3.cross v l u)\n\n    (js \"aim_matrix[0]=vx(v);\")\n    (js \"aim_matrix[1]=vy(v);\")\n    (js \"aim_matrix[2]=vz(v);\")\n    (js \"aim_matrix[3]=0;\")\n\n    (js \"aim_matrix[4]=vx(l);\")\n    (js \"aim_matrix[5]=vy(l);\")\n    (js \"aim_matrix[6]=vz(l);\")\n    (js \"aim_matrix[7]=0;\")\n\n    (js \"aim_matrix[8]=vx(u);\")\n    (js \"aim_matrix[9]=vy(u);\")\n    (js \"aim_matrix[10]=vz(u);\")\n    (js \"aim_matrix[11]=0;\")\n\n    (js \"aim_matrix[12]=0;\")\n    (js \"aim_matrix[13]=0;\")\n    (js \"aim_matrix[14]=0;\")\n    (js \"aim_matrix[15]=1;\")\n\n    (mat4.multiply m aim-matrix)))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(define (maths-unit-test)\n  (assert (feq? (sqrt 25) 5) \"sqrt\")\n  (assert (feq? (pow 3 2) 7) \"pow\")\n  (assert (eq? (square 10) 100) \"square\")\n  (assert (eq? (trunc 40.4) 40) \"trunc\")\n  (assert (feq? 20.4 20.4) \"feq? 1\")\n  (assert (not (feq? 20.4 20.42)) \"feq? 2\")\n  (let ((v (vector 1 2 3)))\n    (assert (feq? (vx v) 1) \"vx\")\n    (assert (feq? (vy v) 2) \"vy\")\n    (assert (feq? (vz v) 3) \"vz\")\n    (assert (veq? v (vector 1 2 3)) \"veq? 1\") \n    (assert (not (veq? v (vector 30 20 30))) \"veq? 2\") \n    (let ((vc (vector-clone v)))\n      (assert (veq? vc (vector 1 2 3)) \"vector-clone 1\")\n      (set! vc (vector 0 0 0))\n      (assert (veq? v (vector 1 2 3)) \"vector-clone 2\"))\n    (assert (veq? (vadd v (vector 1 1 1)) (vector 2 3 4)) \"vadd\")\n    (assert (feq? (vmag (vector 10 0 0)) 10) \"vmag\")\n    (assert (veq? (vsub v (vector 2 2 2)) (vector -1 0 1)) \"vsub\")\n    (assert (veq? (vneg v) (vector -1 -2 -3)) \"vneg\")\n    (assert (veq? (vmul v 10) (vector 10 20 30)) \"vmul\")\n    (assert (veq? (vdiv v 2) (vector 0.5 1 1.5)) \"vdiv\")\n    (assert (feq? (vdist (vector 10 0 0) (vector 0 0 0)) 10) \"vdist\")\n    (assert (veq? (vlerp (vector 0 0 0) (vector 10 20 30) 0.5)\n\t\t  (vector 5 10 15)) \"vlerp\")\n    (assert (feq? (vmag (vnormalise (vector 1 4 923))) 1) \"vnormalise\")\n    (assert (feq? (vdot (vector 0 0 0) (vector 10 0 0)) 10) \"vdot\")\n    (assert (feq? (vcross (vector 1 0 0) (vector 0 1 0)) (vector 0 0 1)) \n\t    \"vcross\")\n    ;; todo: add quat and matrix\n    )))\n\n(maths-unit-test)\n", "flx/scm/pdata.jscm": ";; -*- mode: scheme; -*-\n;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n;;\n;; This program is free software: you can redistribute it and/or modify\n;; it under the terms of the GNU Affero General Public License as\n;; published by the Free Software Foundation, either version 3 of the\n;; License, or (at your option) any later version.\n;;\n;; This program is distributed in the hope that it will be useful,\n;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n;; GNU Affero General Public License for more details.\n;;\n;; You should have received a copy of the GNU Affero General Public License\n;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n;; pdata objects store the data so they can be manipulated, then\n;; re-uploaded using the GL VBO handle.\n;; todo:\n;; - choice of separate or interleaved (faster when modifying one type)\n;; - ability to delete CPU copies\n\n(define (make-pdata names size-verts interleaved-data)\n  (list names size-verts interleaved-data 0))\n\n(define (pdata-names v) (list-ref v 0))\n(define (pdata-modify-names! p v) (set! p (list-replace p 0 v)))\n(define (pdata-size-verts v) (list-ref v 1))\n(define (pdata-interleaved-data v) (list-ref v 2))\n(define (pdata-modify-interleaved-data! p v) (set! p (list-replace p 2 v)))\n(define (pdata-vbo v) (list-ref v 3))\n\n(define (pdata-build-vbo gl v)\n  ;;(msg (+ \"building vbo of size \" (length (pdata-interleaved-data v)) \" floats\"))\n  (let ((vb (gl.createBuffer)))\n    (gl.bindBuffer gl.ARRAY_BUFFER vb)\n    (gl.bufferData gl.ARRAY_BUFFER (new Float32Array (length (pdata-interleaved-data v))) gl.STATIC_DRAW)\n    (list-replace v 3 vb)))\n\n(define (pdata-update-vbo! gl v)\n  (gl.bindBuffer gl.ARRAY_BUFFER (pdata-vbo v))\n  (gl.bufferData gl.ARRAY_BUFFER (new Float32Array (pdata-interleaved-data v)) gl.STATIC_DRAW))\n\n(define (pdata-internal-add! gl v name)\n  (let ((oldcount (length (pdata-names v))))\n    (pdata-modify-names! v (append (pdata-names v) name))\n    (pdata-modify-interleaved-data! \n     v (pdata-insert-util (pdata-interleaved-data v) \n\t\t\t  oldcount (vector 0 0 0))))\n  (pdata-build-vbo gl v)\n  (pdata-update-vbo! gl v))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n\n;; take a list of lists of vertex data, and output a \n;; single interleaved list\n(define (pdata-interleave-pdata-util data)\n  (js \"var ret=[];\")\n  (js \"for (var i=0; i<data[0].length; i+=3) {\") \n  (js \"  for (var d=0; d<data.length; d++) {\")\n  (js \"    ret.push(data[d][i]);\")\n  (js \"    ret.push(data[d][i+1]);\")\n  (js \"    ret.push(data[d][i+2]);\")\n  (js \"  }\")\n  (js \"}\")\n  ret)\n\n;; adds a new list to the interleaved data\n(define (pdata-insert-util data oldcount default-vector)\n  (js \"var ret=[];\")\n  (js \"var count=0;\")\n  (js \"for (var i=0; i<data.length; i+=3) {\") \n  (js \"  ret.push(data[i]);\")\n  (js \"  ret.push(data[i+1]);\")\n  (js \"  ret.push(data[i+2]);\")\n  (js \"  if (count===oldcount-1) {\")\n  (js \"    ret.push(default_vector[0]);\")\n  (js \"    ret.push(default_vector[1]);\")\n  (js \"    ret.push(default_vector[2]);\")\n  (js \"    count=-1;\")\n  (js \"  }\")\n  (js \" count++;\")\n  (js \"}\")\n  ret)\n\n(define (stride-map fn interleaved stride offset)\n  (js \"for (var stride_map_i=offset; stride_map_i<interleaved.length; stride_map_i+=stride) {\")\n  (js \"var stride_map_v=fn([interleaved[stride_map_i],interleaved[stride_map_i+1],interleaved[stride_map_i+2]]);\")\n  (js \"interleaved[stride_map_i]=stride_map_v[0];\")\n  (js \"interleaved[stride_map_i+1]=stride_map_v[1];\")\n  (js \"interleaved[stride_map_i+2]=stride_map_v[2];\")\n  (js \"};\")\n  interleaved)\n\n(define (stride-index-map fn interleaved stride offset)\n  (js \"var index_map_pos=0;\")\n  (js \"for (var stride_map_i=offset; stride_map_i<interleaved.length; stride_map_i+=stride) {\")\n  (js \"var stride_map_v=fn(index_map_pos,[interleaved[stride_map_i],interleaved[stride_map_i+1],interleaved[stride_map_i+2]]);\")\n  (js \"index_map_pos+=1;\")\n  (js \"interleaved[stride_map_i]=stride_map_v[0];\")\n  (js \"interleaved[stride_map_i+1]=stride_map_v[1];\")\n  (js \"interleaved[stride_map_i+2]=stride_map_v[2];\")\n  (js \"};\")\n  interleaved)\n\n(define (pdata-offset v name)\n  (define (_ names r)\n    (cond\n     ((null? names) #f)\n     ((eq? name (car names)) r)\n     (else (_ (cdr names) (+ r 3)))))\n  (_ (pdata-names v) 0))\n\n;; old fast hardcoded version - perhaps for default types if slow\n;  (cond ((eq? name \"p\") 0)\n;\t((eq? name \"n\") 3)\n;\t((eq? name \"t\") 6)\n;\t(else 9)))\n\n(define (pdata-internal-map! gl v fn name)\n  (let ((offset (pdata-offset v name)))  \n    (let ((stride (* (length (pdata-names v)) 3))) \n      (pdata-modify-interleaved-data!\n       v (stride-map fn (pdata-interleaved-data v) stride offset))\n      ;; might want to do this separately as it\'s potentially slow\n      (pdata-update-vbo! gl v))))\n\n(define (pdata-internal-index-map! gl v fn name)\n  (let ((offset (pdata-offset v name)))  \n    (let ((stride (* (length (pdata-names v)) 3))) \n      (pdata-modify-interleaved-data!\n       v (stride-index-map fn (pdata-interleaved-data v) stride offset))\n      ;; might want to do this separately as it\'s potentially slow\n      (pdata-update-vbo! gl v))))\n\n(define (pdata-internal-set! gl pdata name pos value)\n  (let ((offset (pdata-offset pdata name)))  \n    (let ((stride (* (length (pdata-names pdata)) 3)))\n      ;; (when (> (+ offset (* pos stride)) \n      ;; \t       (length (pdata-interleaved-data pdata))) \n      ;; \t    (msg (+ offset (* pos stride)))\n      ;; \t    (msg (length (pdata-interleaved-data pdata)))\n      ;; \t    (msg \"WOT\")\n      ;; \t    (welw)\n      ;; \t    )\n      (js \"pdata_interleaved_data(pdata)[offset+pos*stride]=value[0];\")\n      (js \"pdata_interleaved_data(pdata)[offset+pos*stride+1]=value[1];\")\n      (js \"pdata_interleaved_data(pdata)[offset+pos*stride+2]=value[2];\"))))\n\n(define (pdata-internal-ref gl pdata name pos)\n  (let ((offset (pdata-offset pdata name)))  \n    (let ((stride (* (length (pdata-names pdata)) 3))) \n      (vector\n       (js \"pdata_interleaved_data(pdata)[offset+pos*stride]\")\n       (js \"pdata_interleaved_data(pdata)[offset+pos*stride+1]\")\n       (js \"pdata_interleaved_data(pdata)[offset+pos*stride+2]\")))))\n\n;; stick em out here to avoid allocation all the time\n(define model-view (mat4.create))\n(define local (mat4.create))\n(define normal (mat4.create))\n\n(define (pdata-render pdata type gl view-camera camera-pos state tx)\n  (let ((shader (state-shader state))\n\t(texture (state-texture state))\n\t(colour (state-colour state))\n\t(hints (state-hints state)))\n\n    (mat4.multiply tx (state-tx state) local)\n    (mat4.multiply view-camera local model-view)\n    (mat4.toRotationMat local normal)\n    \n    (gl.useProgram shader)\n    (gl.bindBuffer gl.ARRAY_BUFFER (pdata-vbo pdata))\n\n    ;; set uniforms\n    (apply-uniform-items! gl shader (state-uniform-items state))\n    \n    ;; 12 bytes for 3 floats...\n    (define total-bytes (* (length (pdata-names pdata)) 12))\n\n    (index-for-each\n     (lambda (index name)\n       (gl.enableVertexAttribArray index)\n       (gl.vertexAttribPointer \n\tindex 3 gl.FLOAT false total-bytes (* index 12)))\n     (pdata-names pdata))\n\n    (if (eq? texture \"\")\n\t(bind-texture gl shader \"white.png\")\n\t(bind-texture gl shader texture))\n    \n    (gl.uniformMatrix4fv shader.ModelViewMatrix false model-view)\n    (gl.uniformMatrix4fv shader.NormalMatrix false normal)\n\n    (gl.uniform3fv shader.DiffuseColour colour)\n    (gl.uniform3fv shader.CameraPos camera-pos)\n\n    (when (bitwise-and hints FLX_HINT_SOLID)\n\t  (gl.drawArrays\n\t   (cond\n\t    ((eq? type \'lines) gl.LINES)\n\t    ((eq? type \'line-strip) gl.LINE_STRIP)\n\t    ((eq? type \'line-loop) gl.LINE_LOOP)\n\t    ((eq? type \'triangles) gl.TRIANGLES)\n\t    ((eq? type \'triangle-strip) gl.TRIANGLE_STRIP)\n\t    ((eq? type \'triangle-fan) gl.TRIANGLE_FAN)\n\t    (else gl.TRIANGLES))\n\t   0 (pdata-size-verts pdata))) \n    (when (bitwise-and hints FLX_HINT_WIRE)\n\t  (gl.drawArrays gl.LINE_STRIP 0 (pdata-size-verts pdata)))\n    ))\n"});
	init_static(';; -*- mode: scheme; -*-\n\
;; Planet Fluxus Copyright (C) 2013 Dave Griffiths\n\
;;\n\
;; This program is free software: you can redistribute it and/or modify\n\
;; it under the terms of the GNU Affero General Public License as\n\
;; published by the Free Software Foundation, either version 3 of the\n\
;; License, or (at your option) any later version.\n\
;;\n\
;; This program is distributed in the hope that it will be useful,\n\
;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n\
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n\
;; GNU Affero General Public License for more details.\n\
;;\n\
;; You should have received a copy of the GNU Affero General Public License\n\
;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\
\n\
;; todo make data-driven and make define-syntax!\n\
(define ret (lambda (code)\n\
  (cond\n\
   ((not (list? code)) code)\n\
   ((null? code) ())\n\
\n\
   ;; with-state\n\
   ((eq? (car code) "with_state")\n\
    (append\n\
     (list "begin" (list "push"))\n\
      (list (list "let"\n\
                  (list (list "with_state_ret" (append (list "begin") (do-syntax (cdr code)))))\n\
                  (list "pop") "with_state_ret"))))\n\
\n\
   ;; with-primitive\n\
   ((eq? (car code) "with_primitive")\n\
    (append\n\
     (list "begin" (list "grab" (cadr code)))\n\
     (list (list "let"\n\
                 (list (list "with_primitive_ret" (append (list "begin") (do-syntax (cdr code)))))\n\
                 (list "ungrab") "with_primitive_ret"))))\n\
\n\
   ((eq? (car code) "every_frame")\n\
    (append\n\
     (list "every_frame_impl")\n\
     (list\n\
      (list "lambda" (list)\n\
            (do-syntax (cdr code))))))\n\
\n\
\n\
   ;; define a function\n\
   ((and\n\
     (eq? (car code) "define")\n\
     (list? (cadr code)))\n\
    (let ((name (car (cadr code)))\n\
          (args (cdr (cadr code)))\n\
          (body (do-syntax (cdr (cdr code)))))\n\
      (list "define" name (append (list "lambda" args) body))))\n\
\n\
   (else (cons (do-syntax (car code))\n\
               (do-syntax (cdr code)))))))\n\
\n\
ret\n\
',';; -*- mode: scheme; -*-\n\
\n\
;; Penelope Project Software Copyright (C) 2020 FoAM Kernow\n\
;;\n\
;; This program is free software: you can redistribute it and/or modify\n\
;; it under the terms of the GNU Affero General Public License as\n\
;; published by the Free Software Foundation, either version 3 of the\n\
;; License, or (at your option) any later version.\n\
;;\n\
;; This program is distributed in the hope that it will be useful,\n\
;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n\
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n\
;; GNU Affero General Public License for more details.\n\
;;\n\
;; You should have received a copy of the GNU Affero General Public License\n\
;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\
\n\
(load "flx/scm/fluxus.jscm")\n\
(load "flx/scm/canvas.jscm")\n\
(load "scm/loom.jscm")\n\
(load "scm/interface.jscm")\n\
(load "scm/generators.jscm")\n\
\n\
;;---------------------------------------------------------\n\
(clear)\n\
(crank)\n\
\n\
(define l 0)\n\
(define components (init-components))\n\
(define scene-root 0)\n\
(define frame 0)\n\
\n\
;   (list (list 0 0 1 0 1 1)\n\
;		 (list 1 0 0 1 1 0)\n\
;		 (list 0 1 0 1 0 1)\n\
;		 (list 1 0 1 0 1 0)\n\
;		 (list 0 1 1 0 0 1)\n\
;		 (list 1 1 0 1 0 0))\n\
\n\
(define (init)\n\
  (setup-draft-interface\n\
   (read-number "warp-threads")\n\
   (read-number "weft-threads"))\n\
  (setup-colour-interface)  \n\
  (write-draft-interface\n\
   (list (list 0 1 0 1)\n\
		 (list 1 0 1 0)\n\
		 (list 0 1 0 1)\n\
		 (list 1 0 1 0)))\n\
  (build))\n\
\n\
(define (build)  \n\
  (let ((weft-size (make-divisible-by-wefts\n\
					(read-number "fabric-weft-size")\n\
					(length weft-colours))))\n\
\n\
	(set! scene-root (build-locator))\n\
	(update-look)  \n\
	(update-view)  \n\
	(with-state\n\
	 (parent scene-root)\n\
	 (translate (vector 0 (- weft-size 12) 0))\n\
	 (set! l (build-loom\n\
			  (read-draft-interface)\n\
			  (read-number "fabric-warp-size")\n\
			  weft-size\n\
			  warp-colours\n\
			  weft-colours)))))\n\
\n\
(define (update)\n\
  (destroy scene-root)\n\
  (build))\n\
\n\
(define (update-draft)\n\
  (setup-draft-interface\n\
   (read-number "warp-threads")\n\
   (read-number "weft-threads")))\n\
\n\
(define (update-speed)\n\
  (set! weave-time (read-number "loom-speed")))\n\
  \n\
(define (update-look)\n\
  (shader-shared-uniform! "Ambient" "f" (- 1 (read-number "render-contrast")))\n\
  (build-components\n\
   components\n\
   (read-number "weave-depth")\n\
   (read-number "thread-width")\n\
   (is-checked? "render-texture")\n\
   (is-checked? "render-flat")))\n\
  \n\
(define (update-view)\n\
  (set-camera-transform (mtranslate (midentity) (vector 0 1 (- (read-number "camera-distance")))))\n\
  (with-primitive\n\
   scene-root\n\
   (identity)\n\
   (translate (vector -10 5 0))\n\
   (rotate\n\
     (vector\n\
      (read-number "camera-rot-x")\n\
      (read-number "camera-rot-y") 0))))\n\
\n\
(define (generate-draft)  \n\
  (write-draft-interface\n\
   (generate (read-selected "preset"))))\n\
\n\
(define (invert-draft)  \n\
  (let ((draft (kernel-invert (loom-draft l))))\n\
    (write-draft-interface draft)\n\
    ;;(set! l (loom-modify-draft l draft))\n\
    ))\n\
\n\
(define (render)\n\
  (with-state\n\
   (parent scene-root)\n\
   ;; todo: instances don\'t seem to inherit texture state...\n\
   (texture (load-texture\n\
			 (if (is-checked? "render-texture")\n\
				 "thread.png" "white.png")))\n\
   (set! l (loom-update l (/ 1 60) components)))\n\
  (with-primitive\n\
   scene-root\n\
   (rotate (vector 0 0 0)))\n\
  (set! frame (+ frame 1)))\n\
\n\
\n\
;;(canvas-setup)\n\
(clear-colour (vector 1 1 1))\n\
(set-camera-angle 25)\n\
(set-camera-transform (mtranslate (midentity) (vector 0 1 (- (read-number "camera-distance")))))\n\
;;(resize-canvas canvas)\n\
(resize-glcanvas webgl-canvas)\n\
\n\
;; todo: this isn\'t working, it\'s using the default-default shader\n\
(shader-compile "default" (list "p" "n" "t" "c")\n\
				"shaders/default.vert"\n\
				"shaders/default.frag")\n\
\n\
(init)\n\
(every-frame (render))\n\
\n\
\n\
\n\
');

var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
				console.log(content)
				console.log(content.style.display)
	if (content.style.display === "flex") {			
      content.style.display = "none";
    } else {
      content.style.display = "flex";
    }
	var content2 = content.nextElementSibling;
	console.log(content2)			
	console.log(content2.style.display)
	if (content2.style.display === "flex") {
      content2.style.display = "none";
    } else {
      content2.style.display = "flex";
    }
  });
} 
	
    });
  </script>
</body>
</html>
